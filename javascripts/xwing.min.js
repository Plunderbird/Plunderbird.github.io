var DFL_LANGUAGE,GenericAddon,SERIALIZATION_CODE_TO_CLASS,SHOW_DEBUG_OUT_MISSING_TRANSLATIONS,SPEC_URL,SQUAD_DISPLAY_NAME_MAX_LENGTH,SQUAD_TO_XWS_URL,Ship,TYPES,URL_BASE,all,builders,byName,byPoints,conditionToHTML,exportObj,getPrimaryFaction,statAndEffectiveStat,__slice=[].slice,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__indexOf=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},__hasProp={}.hasOwnProperty,__extends=function(t,e){for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};window.iced={Deferrals:function(){function t(t){this.continuation=t,this.count=1,this.ret=null}return t.prototype._fulfill=function(){if(!--this.count)return this.continuation(this.ret)},t.prototype.defer=function(i){return++this.count,n=this,function(){var t,e=1<=arguments.length?__slice.call(arguments,0):[];return null!=i&&null!=(t=i.assign_fn)&&t.apply(null,e),n._fulfill()};var n},t}(),findDeferral:function(){return null},trampoline:function(t){return t()}},window.__iced_k=window.__iced_k_noop=function(){},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).SquadBuilderBackend=function(){function t(t){var e,i,n,a;for(this.getCollectionCheck=__bind(this.getCollectionCheck,this),this.getLanguagePreference=__bind(this.getLanguagePreference,this),this.nameCheck=__bind(this.nameCheck,this),this.maybeAuthenticationChanged=__bind(this.maybeAuthenticationChanged,this),$.ajaxSetup({dataType:"json",xhrFields:{withCredentials:!0}}),this.server=t.server,this.builders=t.builders,this.login_logout_button=$(t.login_logout_button),this.auth_status=$(t.auth_status),this.authenticated=!1,this.ui_ready=!1,this.oauth_window=null,this.method_metadata={google_oauth2:{icon:"fab fa-google",text:"Google"},facebook:{icon:"fab fa-facebook",text:"Facebook"},twitter:{icon:"fab fa-twitter",text:"Twitter"},discord:{icon:"fab fa-discord",text:"Discord"}},this.squad_display_mode="all",this.show_archived=!1,this.collection_save_timer=null,this.setupHandlers(),this.setupUI(),this.authenticate((a=this,function(){return a.auth_status.hide(),a.login_logout_button.removeClass("d-none")})),e=0,i=(n=this.builders).length;e<i;e++)n[e].setBackend(this);this.updateAuthenticationVisibility()}return t.prototype.updateAuthenticationVisibility=function(){return this.authenticated?($(".show-authenticated").show(),$(".hide-authenticated").hide()):($(".show-authenticated").hide(),$(".hide-authenticated").show())},t.prototype.save=function(t,e,i,n,a,s){var l;if(null==e&&(e=null),null==a&&(a={}),""===t)return s({id:null,success:!1,error:"You cannot save an empty squad"});if(""===$.trim(i))return s({id:null,success:!1,error:"Squad name cannot be empty"});if(null==n||""===n)throw"Faction unspecified to save()";return i={name:$.trim(i),faction:$.trim(n),serialized:t,additional_data:a},null!=e?l=this.server+"/squads/"+e:(l=this.server+"/squads/new",i._method="put"),$.post(l,i,function(t,e,i){return s({id:t.id,success:t.success,error:t.error})})},t.prototype.delete=function(t,n){return $.post(this.server+"/squads/"+t,{_method:"delete"},function(t,e,i){return n({success:t.success,error:t.error})})},t.prototype.archive=function(t,e,i){return t.additional_data.archived=!0,this.save(t.serialized,t.id,t.name,e,t.additional_data,i)},t.prototype.list=function(g){var v,x,k,t,y;return this.squad_list_modal.find(".modal-header .squad-list-header-placeholder").text(exportObj.translate("ui","yourXYsquads",g.faction)),(v=$(this.squad_list_modal.find("ul.squad-list"))).text(""),v.hide(),(x=$(this.squad_list_modal.find("p.squad-list-loading"))).show(),this.show_all_squads_button.click(),this.squad_list_modal.modal("show"),this.number_of_selected_squads_to_be_deleted=0,k=[],t=this.server+"/squads/list",$.get(t,(y=this,function(c,u,h){for(var i,t,l,o,e,n,a,s,p,f,r,m=!1,_=c[g.faction],d=0,b=_.length;d<b;d++){if(t=_[d],(i=$(document.createElement("LI"))).addClass("squad-summary"),i.data("squad",t),i.data("builder",g),i.data("selectedForDeletion",!1),v.append(i),null!=(null!=(r=t.additional_data)?r.tag:void 0)&&""!==(null!=(r=t.additional_data)?r.tag:void 0)&&-1===k.indexOf(t.additional_data.tag))for(a=0,p=(o=null!=(r=t.additional_data)?r.tag.split(","):void 0).length;a<p;a++)e=o[a],k.push(e);null!=(null!=(r=t.additional_data)?r.archived:void 0)?i.hide():m=!0,i.append($.trim('<div class="row">\n    <div class="col-md-9">\n        <h4>'+t.name+'</h4>\n    </div>\n    <div class="col-md-3">\n        <h5>'+(null!=(r=t.additional_data)?r.points:void 0)+" "+exportObj.translate("ui","Points")+'</h5>\n    </div>\n</div>\n<div class="row squad-description">\n    <div class="col-md-9">\n        '+(null!=(r=t.additional_data)?r.description:void 0)+'\n    </div>\n    <div class="squad-buttons col-md-3">\n        <button class="btn btn-modal convert-squad"><i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i></button>\n        &nbsp;\n        <button class="btn btn-modal load-squad"><i class="fa fa-download"></i></button>\n        &nbsp;\n        <button class="btn btn-danger delete-squad"><i class="fa fa-times"></i></button>\n    </div>\n</div>\n<div class="row squad-convert-confirm">\n    <div class="col-md-9 translated" defaultText="Convert to Extended?">\n    </div>\n    <div class="squad-buttons col-md-3">\n        <button class="btn btn-danger confirm-convert-squad translated" defaultText="Convert"></button>\n        &nbsp;\n        <button class="btn btn-modal cancel-convert-squad translated" defaultText="Cancel"></button>\n    </div>\n</div>\n<div class="row squad-delete-confirm">\n    <div class="col-md-9">\n        '+exportObj.translate("ui","reallyDeleteSquadXY","<em>"+t.name+"</em>")+'\n    </div>\n    <div class="col-md-3">\n        <button class="btn btn-danger confirm-delete-squad translated" defaultText="Delete"></button>\n        &nbsp;\n        <button class="btn btn-modal cancel-delete-squad translated" defaultText="Cancel"></button>\n    </div>\n</div>')),i.find(".squad-convert-confirm").hide(),i.find(".squad-delete-confirm").hide(),-1===t.serialized.search(/v\d+Zh/)&&i.find("button.convert-squad").hide(),i.find("button.convert-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.data("selectedToConvert",!0),(e=i).find(".squad-description").fadeOut("fast",function(){return e.find(".squad-convert-confirm").fadeIn("fast")})}),i.find("button.cancel-convert-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.data("selectedToConvert",!1),(e=i).find(".squad-convert-confirm").fadeOut("fast",function(){return e.find(".squad-description").fadeIn("fast")})}),i.find("button.confirm-convert-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.find(".cancel-convert-squad").fadeOut("fast"),i.find(".confirm-convert-squad").addClass("disabled"),i.find(".confirm-convert-squad").text("Converting..."),e=i.data("squad").serialized.replace("Zh","Zs"),y.save(e,i.data("squad").id,i.data("squad").name,i.data("builder").faction,i.data("squad").additional_data,function(t){return t.success?(i.data("squad").serialized=e,i.find(".squad-convert-confirm").fadeOut("fast",function(){return i.find(".squad-description").fadeIn("fast"),i.find("button.convert-squad").fadeOut("fast")})):i.html($.trim("Error converting "+i.data("squad").name+": <em>"+t.error+"</em>"))})}),i.find("button.load-squad").click(function(t){return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),y.squad_list_modal.modal("hide"),g.current_squad.dirty?y.warnUnsaved(g,function(){return g.container.trigger("xwing-backend:squadLoadRequested",i.data("squad"))}):g.container.trigger("xwing-backend:squadLoadRequested",i.data("squad"))}),i.find("button.delete-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.data("selectedForDeletion",!0),(e=i).find(".squad-description").fadeOut("fast",function(){return e.find(".squad-delete-confirm").fadeIn("fast")}),y.number_of_selected_squads_to_be_deleted||y.squad_list_modal.find("div.delete-multiple-squads").show(),y.number_of_selected_squads_to_be_deleted+=1}),i.find("button.cancel-delete-squad").click(function(t){t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.data("selectedForDeletion",!1),--y.number_of_selected_squads_to_be_deleted;var e=i;if(e.find(".squad-delete-confirm").fadeOut("fast",function(){return e.find(".squad-description").fadeIn("fast")}),!y.number_of_selected_squads_to_be_deleted)return y.squad_list_modal.find("div.delete-multiple-squads").hide()}),i.find("button.confirm-delete-squad").click(function(t){return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.find(".cancel-delete-squad").fadeOut("fast"),i.find(".confirm-delete-squad").addClass("disabled"),i.find(".confirm-delete-squad").text("Deleting..."),y.delete(i.data("squad").id,function(t){return t.success?(i.slideUp("fast",function(){return $(i).remove()}),--y.number_of_selected_squads_to_be_deleted,y.number_of_selected_squads_to_be_deleted?void 0:y.squad_list_modal.find("div.delete-multiple-squads").hide()):i.html($.trim("Error deleting "+i.data("squad").name+": <em>"+t.error+"</em>"))})})}for(m||v.append($.trim('<li class="translated" defaultText="No saved squads"></li>')),y.squad_list_tags.empty(),s=0,f=k.length;s<f;s++)n=(l=k[s]).toLowerCase().replace(/[^a-z0-9]/g,"").replace(/\s+/g,"-"),y.squad_list_tags.append($.trim(' \n<button class="btn '+n+'">'+l+"</button>")),$(y.squad_list_tags.find("."+n)).click(function(t){var t=$(t.target),s=t.attr("class").replace("btn ","").replace("btn-inverse ","");return y.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),y.squad_list_tags.find(".btn").removeClass("btn-inverse"),t.addClass("btn-inverse"),y.squad_list_modal.find(".squad-list li").each(function(t,e){var i,n,a;if(null==$(e).data().squad.additional_data.tag)return $(e).hide();for(i=!1,n=0,a=(o=$(e).data().squad.additional_data.tag.split(",")).length;n<a;n++)l=o[n],s===l.toLowerCase().replace(/[^a-z0-9]/g,"").replace(/\s+/g,"-")&&(i=!0);return i?$(e).show():$(e).hide()})});return exportObj.translateUIElements(v),x.fadeOut("fast"),v.fadeIn("fast")}))},t.prototype.authenticate=function(n){var a,s,e;return null==n&&(n=$.noop),$(this.auth_status.find(".payload")).text(exportObj.translate("ui","Checking auth status...")),this.auth_status.show(),a=this.authenticated,$.ajax({url:this.server+"/ping",success:function(t){return null!=t&&t.success?e.authenticated=!0:e.authenticated=!1,e.maybeAuthenticationChanged(a,n)},error:(s=e=this,function(t,e,i){return s.authenticated=!1,s.maybeAuthenticationChanged(a,n)})})},t.prototype.maybeAuthenticationChanged=function(t,e){return t!==this.authenticated&&$(window).trigger("xwing-backend:authenticationChanged",[this.authenticated,this]),this.oauth_window=null,this.auth_status.hide(),e(this.authenticated),this.authenticated},t.prototype.login=function(){if(this.ui_ready)return this.login_modal.modal("show")},t.prototype.logout=function(n){return null==n&&(n=$.noop),$(this.auth_status.find(".payload")).text(exportObj.translate("ui","Logging out...")),this.auth_status.show(),$.get(this.server+"/auth/logout",(a=this,function(t,e,i){return a.authenticated=!1,$(window).trigger("xwing-backend:authenticationChanged",[a.authenticated,a]),a.auth_status.hide(),n()}));var a},t.prototype.showSaveAsModal=function(t){return this.save_as_modal.data("builder",t),this.save_as_input.val(t.current_squad.name),this.save_as_save_button.addClass("disabled"),this.nameCheck(),this.save_as_modal.modal("show")},t.prototype.showDeleteModal=function(t){return this.delete_modal.data("builder",t),this.delete_name_container.text(t.current_squad.name),this.delete_modal.modal("show")},t.prototype.nameCheck=function(){var t,e;return window.clearInterval(this.save_as_modal.data("timer")),0===(t=$.trim(this.save_as_input.val())).length?(this.name_availability_container.text(""),this.name_availability_container.append($.trim('<i class="fa fa-thumbs-down"></i> '+exportObj.translate("ui","name required")))):$.post(this.server+"/squads/namecheck",{name:t},(e=this,function(t){return e.name_availability_container.text(""),t.available?(e.name_availability_container.append($.trim('<i class="fa fa-thumbs-up"></i> '+exportObj.translate("ui","Name is available"))),e.save_as_save_button.removeClass("disabled")):(e.name_availability_container.append($.trim('<i class="fa fa-thumbs-down"></i> '+exportObj.translate("ui","Name in use"))),e.save_as_save_button.addClass("disabled"))}))},t.prototype.warnUnsaved=function(t,e){return this.unsaved_modal.data("builder",t),this.unsaved_modal.data("callback",e),this.unsaved_modal.modal("show")},t.prototype.setupUI=function(){var u,d,l,h,p,f,e,i,n,a,s,o,t,r,c,m,_;return this.auth_status.addClass("disabled"),this.auth_status.click(function(t){return!1}),this.login_modal=$(document.createElement("DIV")),this.login_modal.addClass("modal fade d-print-none"),this.login_modal.tabindex="-1",this.login_modal.role="dialog",$(document.body).append(this.login_modal),this.login_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Log in with OAuth"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p>\n                <span class="translated" defaultText="select OAuth provider"></span>\n                <a class="login-help translated" href="#" defaultText="What\'s this?"></a>\n            </p>\n            <div class="well well-small oauth-explanation">\n                <span class="translated" defaultText="OAuth explanation"></span>\n                <button class="btn btn-modal translated" defaultText="Got it!"></button>\n            </div>\n            <ul class="login-providers inline"></ul>\n            <p class="translated" defaultText="Continue to OAuth provider"></p>\n            <p class="translated" defaultText="iOS requires cross-site control"></p>\n            <p class="login-in-progress">\n                <em class="translated" defaultText="login in progress"></em>\n            </p>\n        </div>\n    </div>\n</div>')),(u=$(this.login_modal.find(".oauth-explanation"))).hide(),this.login_modal.find(".login-in-progress").hide(),this.login_modal.find("a.login-help").click(function(t){if(t.preventDefault(),!u.is(":visible"))return u.slideDown("fast")}),u.find("button").click(function(t){return t.preventDefault(),u.slideUp("fast")}),$.get(this.server+"/methods",(d=this,function(t,e,i){for(var n,a,s=$(d.login_modal.find("ul.login-providers")),l=t.methods,o=0,r=l.length;o<r;o++)a=l[o],(n=$(document.createElement("A"))).addClass("btn btn-modal"),n.data("url",d.server+"/auth/"+a),n.append('<i class="'+d.method_metadata[a].icon+'"></i>&nbsp;'+d.method_metadata[a].text),n.click(function(t){return t.preventDefault(),s.slideUp("fast"),d.login_modal.find(".login-in-progress").slideDown("fast"),d.oauth_window=window.open($(t.target).data("url"),"xwing_login")}),(a=$(document.createElement("LI"))).append(n),s.append(a);return d.ui_ready=!0})),exportObj.translateUIElements(this.login_modal),this.reload_done_modal=$(document.createElement("DIV")),this.reload_done_modal.addClass("modal fade d-print-none"),this.reload_done_modal.tabindex="-1",this.reload_done_modal.role="dialog",$(document.body).append(this.reload_done_modal),this.reload_done_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3>Reload Done</h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Squads reloaded"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-modal btn-primary translated" aria-hidden="true" data-dismiss="modal" defaultText="Well done!"></button>\n        </div>\n    </div>\n</div>')),exportObj.translateUIElements(this.reload_done_modal),this.squad_list_modal=$(document.createElement("DIV")),this.squad_list_modal.addClass("modal fade d-print-none squad-list"),this.squad_list_modal.tabindex="-1",this.squad_list_modal.role="dialog",$(document.body).append(this.squad_list_modal),this.squad_list_modal.append($.trim('<div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="squad-list-header-placeholder d-none d-lg-block"></h3>\n            <h4 class="squad-list-header-placeholder d-lg-none"></h4>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <ul class="squad-list"></ul>\n            <p class="pagination-centered squad-list-loading">\n                <i class="fa fa-spinner fa-spin fa-3x"></i>\n                <br />\n                <span class="translated" defaultText="Fetching squads..."></span>\n            </p>\n        </div>\n        <div class="modal-footer">\n            <div class="btn-group delete-multiple-squads full-row">\n                <button class="btn btn-modal select-all translated" defaultText="Select All"></button>\n                <button class="btn btn-modal archive-selected translated" defaultText="Archive Selected"></button>\n                <button class="btn btn-modal btn-danger delete-selected translated" defaultText="Delete Selected"></button>\n            </div>\n            <div class="btn-group squad-display-mode full-row">\n                <button class="btn btn-modal btn-inverse show-all-squads translated" defaultText="All"></button>\n                <button class="btn btn-modal show-standard-squads"><span class="d-none d-lg-block translated" defaultText="Standard"></span><span class="d-lg-none translated" defaultText="Hyper"></span></button>\n                <button class="btn btn-modal show-extended-squads"><span class="d-none d-lg-block translated" defaultText="Extended"></span><span class="d-lg-none translated" defaultText="Ext"></span></button>\n                <button class="btn btn-modal show-quickbuild-squads"><span class="d-none d-lg-block translated" defaultText="Quickbuild"></span><span class="d-lg-none translated" defaultText="QB"></span></button>\n                <button class="btn btn-modal show-epic-squads translated" defaultText="Epic"></button>\n                <button class="btn btn-modal show-archived-squads translated" defaultText="Archived"></button>\n                <button class="btn btn-modal reload-all translated" defaultText="Recalculate Points"></button>\n            </div>\n            <div class="btn-group tags-display full-row">\n            </div>\n        </div>\n    </div>\n</div>')),this.squad_list_modal.find("ul.squad-list").hide(),this.squad_list_tags=$(this.squad_list_modal.find("div.tags-display")),this.squad_list_modal.find("div.delete-multiple-squads").hide(),exportObj.translateUIElements(this.squad_list_modal),this.delete_selected_button=$(this.squad_list_modal.find("button.delete-selected")),this.delete_selected_button.click((l=this,function(t){for(var e,i=l.squad_list_modal.find("ul.squad-list").find("li"),n=[],a=0,s=i.length;a<s;a++)e=i[a],(e=$(e)).data("selectedForDeletion")?n.push(function(e){return e.find(".cancel-delete-squad").fadeOut("fast"),e.find(".confirm-delete-squad").addClass("disabled"),e.find(".confirm-delete-squad").text(exportObj.translate("ui","Deleting...")),l.delete(e.data("squad").id,function(t){return t.success?(e.slideUp("fast",function(){return $(e).remove()}),--l.number_of_selected_squads_to_be_deleted,l.number_of_selected_squads_to_be_deleted?void 0:l.squad_list_modal.find("div.delete-multiple-squads").hide()):e.html($.trim("Error deleting "+e.data("squad").name+": <em>"+t.error+"</em>"))})}(e)):n.push(void 0);return n})),this.archive_selected_button=$(this.squad_list_modal.find("button.archive-selected")),this.archive_selected_button.click((h=this,function(t){for(var e,i=h.squad_list_modal.find("ul.squad-list").find("li"),n=[],a=0,s=i.length;a<s;a++)e=i[a],(e=$(e)).data("selectedForDeletion")?n.push(function(e){return e.find(".confirm-delete-squad").addClass("disabled"),e.find(".confirm-delete-squad").text(exportObj.translate("ui","Archiving...")),h.archive(e.data("squad"),e.data("builder").faction,function(t){return t.success?(e.slideUp("fast",function(){return $(e).hide(),$(e).find(".confirm-delete-squad").removeClass("disabled"),$(e).find(".confirm-delete-squad").text(exportObj.translate("ui","Delete")),$(e).data("selectedForDeletion",!1),$(e).find(".squad-delete-confirm").fadeOut("fast",function(){return $(e).find(".squad-description").fadeIn("fast")})}),--h.number_of_selected_squads_to_be_deleted,h.number_of_selected_squads_to_be_deleted?void 0:h.squad_list_modal.find("div.delete-multiple-squads").hide()):e.html($.trim("Error archiving "+e.data("squad").name+": <em>"+t.error+"</em>"))})}(e)):n.push(void 0);return n})),this.squad_list_modal.find("button.reload-all").click((p=this,function(t){for(var e,i,n=p.squad_list_modal.find("ul.squad-list"),a=[function(){return p.reload_done_modal.modal("show")}],s=[],l=n.find("li"),o=0,r=l.length;o<r;o++)i=l[o],i=$(i),s.push(i.data("squad")),e=i.data("builder"),a.push(function(){var t=s.pop();return e.container.trigger("xwing-backend:squadLoadRequested",[t,function(){var t={points:e.total_points,description:e.describeSquad(),cards:e.listCards(),notes:e.notes.val().substr(0,1024),obstacles:e.getObstacles(),tag:e.tag.val().substr(0,1024)};return p.save(e.serialize(),e.current_squad.id,e.current_squad.name,e.faction,t,a.pop())}])});return p.squad_list_modal.modal("hide"),e.current_squad.dirty?p.warnUnsaved(e,a.pop()):a.pop()()})),this.select_all_button=$(this.squad_list_modal.find("button.select-all")),this.select_all_button.click((f=this,function(t){for(var e,i=f.squad_list_modal.find("ul.squad-list").find("li"),n=[],a=0,s=i.length;a<s;a++)e=i[a],(e=$(e)).data("selectedForDeletion")?n.push(void 0):(e.data("selectedForDeletion",!0),function(t){t.find(".squad-description").fadeOut("fast",function(){return t.find(".squad-delete-confirm").fadeIn("fast")})}(e),n.push(f.number_of_selected_squads_to_be_deleted+=1));return n})),this.show_all_squads_button=$(this.squad_list_modal.find(".show-all-squads")),this.show_all_squads_button.click((e=this,function(t){if("all"!==e.squad_display_mode)return e.squad_display_mode="all",e.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),e.squad_list_tags.find(".btn").removeClass("btn-inverse"),e.show_all_squads_button.addClass("btn-inverse"),e.squad_list_modal.find(".squad-list li").show()})),this.show_extended_squads_button=$(this.squad_list_modal.find(".show-extended-squads")),this.show_extended_squads_button.click((i=this,function(t){if("extended"!==i.squad_display_mode)return i.squad_display_mode="extended",i.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),i.squad_list_tags.find(".btn").removeClass("btn-inverse"),i.show_extended_squads_button.addClass("btn-inverse"),i.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Zs/))})})),this.show_epic_squads_button=$(this.squad_list_modal.find(".show-epic-squads")),this.show_epic_squads_button.click((n=this,function(t){if("epic"!==n.squad_display_mode)return n.squad_display_mode="epic",n.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),n.squad_list_tags.find(".btn").removeClass("btn-inverse"),n.show_epic_squads_button.addClass("btn-inverse"),n.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Ze/))})})),this.show_standard_squads_button=$(this.squad_list_modal.find(".show-standard-squads")),this.show_standard_squads_button.click((a=this,function(t){if("standard"!==a.squad_display_mode)return a.squad_display_mode="standard",a.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),a.squad_list_tags.find(".btn").removeClass("btn-inverse"),a.show_standard_squads_button.addClass("btn-inverse"),a.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Zh/))})})),this.show_quickbuild_squads_button=$(this.squad_list_modal.find(".show-quickbuild-squads")),this.show_quickbuild_squads_button.click((s=this,function(t){if("quickbuild"!==s.squad_display_mode)return s.squad_display_mode="quickbuild",s.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),s.squad_list_tags.find(".btn").removeClass("btn-inverse"),s.show_quickbuild_squads_button.addClass("btn-inverse"),s.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Zq/))})})),this.show_archived_squads_button=$(this.squad_list_modal.find(".show-archived-squads")),this.show_archived_squads_button.click((o=this,function(t){return o.show_archived=!o.show_archived,o.show_archived?o.show_archived_squads_button.addClass("btn-inverse"):o.show_archived_squads_button.removeClass("btn-inverse"),o.squad_list_tags.find(".btn").removeClass("btn-inverse"),o.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(null!=$(e).data().squad.additional_data.archived===o.show_archived)})})),this.save_as_modal=$(document.createElement("DIV")),this.save_as_modal.addClass("modal fade d-print-none"),this.save_as_modal.tabindex="-1",this.save_as_modal.role="dialog",$(document.body).append(this.save_as_modal),this.save_as_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Save Squad As..."></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <label for="xw-be-squad-save-as">\n                <span class="translated" defaultText="New Squad Name"></span>\n                <input id="xw-be-squad-save-as"></input>\n            </label>\n            <span class="name-availability"></span>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-primary save translated" aria-hidden="true" defaultText="Save"></button>\n        </div>\n    </div>\n</div>')),this.save_as_modal.on("shown",(t=this,function(){return window.setTimeout(function(){return t.save_as_input.focus(),t.save_as_input.select()},100)})),this.save_as_save_button=this.save_as_modal.find("button.save"),this.save_as_save_button.click((r=this,function(t){var e,i;if(t.preventDefault(),!r.save_as_save_button.hasClass("disabled"))return null!=(t=r.save_as_modal.data("timer"))&&window.clearInterval(t),r.save_as_modal.modal("hide"),t={points:(e=r.save_as_modal.data("builder")).total_points,description:e.describeSquad(),cards:e.listCards(),notes:e.getNotes(),obstacles:e.getObstacles(),tag:e.getTag()},e.backend_save_list_as_button.addClass("disabled"),e.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;'+exportObj.translate("ui","Saving squad..."))),e.backend_status.show(),i=$.trim(r.save_as_input.val()),r.save(e.serialize(),null,i,e.faction,t,function(t){return t.success?(e.current_squad.id=t.id,e.current_squad.name=i,e.current_squad.dirty=!1,e.container.trigger("xwing-backend:squadNameChanged"),e.container.trigger("xwing-backend:squadDirtinessChanged"),e.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;'+exportObj.translate("ui","New squad saved successfully.")))):e.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+t.error)),e.backend_save_list_as_button.removeClass("disabled")})})),this.save_as_input=$(this.save_as_modal.find("input")),this.save_as_input.keypress((c=this,function(t){return 13===t.which?(c.save_as_save_button.click(),!1):(c.name_availability_container.text(""),c.name_availability_container.append($.trim('<i class="fa fa-spin fa-spinner"></i> '+exportObj.translate("ui","Checking name availability..."))),null!=(t=c.save_as_modal.data("timer"))&&window.clearInterval(t),c.save_as_modal.data("timer",window.setInterval(c.nameCheck,500)))})),this.name_availability_container=$(this.save_as_modal.find(".name-availability")),exportObj.translateUIElements(this.squad_list_modal),this.delete_modal=$(document.createElement("DIV")),this.delete_modal.addClass("modal fade d-print-none"),this.delete_modal.tabindex="-1",this.delete_modal.role="dialog",$(document.body).append(this.delete_modal),this.delete_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3><span class="translated" defaultText="Really Delete"></span> <span class="squad-name-placeholder"></span>?</h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Sure to delete?"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-danger delete" aria-hidden="true"><span class="translated" defaultText="Yes, Delete"></span> <i class="squad-name-placeholder"></i></button>\n            <button class="btn btn-modal translated" data-dismiss="modal" aria-hidden="true" defaultText="Never Mind"></button>\n        </div>\n    </div>\n</div>')),this.delete_name_container=$(this.delete_modal.find(".squad-name-placeholder")),this.delete_button=$(this.delete_modal.find("button.delete")),this.delete_button.click((m=this,function(t){var e;return t.preventDefault(),(e=m.delete_modal.data("builder")).backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;'+exportObj.translate("ui","Deleting squad..."))),e.backend_status.show(),e.backend_delete_list_button.addClass("disabled"),m.delete_modal.modal("hide"),m.delete(e.current_squad.id,function(t){return t.success?(e.resetCurrentSquad(),e.current_squad.dirty=!0,e.container.trigger("xwing-backend:squadDirtinessChanged"),e.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;'+exportObj.translate("ui","Squad deleted.")))):(e.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+t.error)),e.backend_delete_list_button.removeClass("disabled"))})})),exportObj.translateUIElements(this.delete_modal),this.unsaved_modal=$(document.createElement("DIV")),this.unsaved_modal.addClass("modal fade d-print-none"),this.unsaved_modal.tabindex="-1",this.unsaved_modal.role="dialog",$(document.body).append(this.unsaved_modal),this.unsaved_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Unsaved Changes"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Unsaved Changes Warning"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-modal btn-primary translated" aria-hidden="true" data-dismiss="modal" defaultText="Go Back"></button>\n            <button class="btn btn-danger discard translated" aria-hidden="true" defaultText="Discard Changes"></button>\n        </div>\n    </div>\n</div>')),this.unsaved_discard_button=$(this.unsaved_modal.find("button.discard")),this.unsaved_discard_button.click((_=this,function(t){return t.preventDefault(),_.unsaved_modal.data("builder").current_squad.dirty=!1,_.unsaved_modal.data("callback")(),_.unsaved_modal.modal("hide")})),exportObj.translateUIElements(this.unsaved_modal)},t.prototype.setupHandlers=function(){var n,e,i,a;return $(window).on("xwing-backend:authenticationChanged",(n=this,function(t,e,i){if(n.updateAuthenticationVisibility(),e)return n.loadCollection()})),this.login_logout_button.click((e=this,function(t){return t.preventDefault(),e.authenticated?e.logout():e.login()})),$(window).on("message",(a=this,function(t){var e,i=t.originalEvent;return i.origin===a.server?"auth_successful"!==(null!=(e=i.data)?e.command:void 0)?console.log("Unexpected command "+(null!=(e=i.data)?e.command:void 0)):(a.authenticate(),a.login_modal.modal("hide"),a.login_modal.find(".login-in-progress").hide(),a.login_modal.find("ul.login-providers").show(),i.source.close()):(console.log("Message received from unapproved origin "+i.origin),window.last_ev=t)})).on("xwing-collection:changed",(i=this,function(t,e){return null!=i.collection_save_timer&&clearTimeout(i.collection_save_timer),i.collection_save_timer=setTimeout(function(){return i.saveCollection(e,function(t){if(t)return $(window).trigger("xwing-collection:saved",e)})},1e3)}))},t.prototype.getSettings=function(n){return null==n&&(n=$.noop),$.get(this.server+"/settings").done(function(t,e,i){return n(t.settings)})},t.prototype.set=function(t,e,n){var i;return null==n&&(n=$.noop),(i={_method:"PUT"})[t]=e,$.post(this.server+"/settings",i).done(function(t,e,i){return n(t.set)})},t.prototype.deleteSetting=function(t,n){return null==n&&(n=$.noop),$.post(this.server+"/settings/"+t,{_method:"DELETE"}).done(function(t,e,i){return n(t.deleted)})},t.prototype.getHeaders=function(n){return null==n&&(n=$.noop),$.get(this.server+"/headers").done(function(t,e,i){return n(t.headers)})},t.prototype.getLanguagePreference=function(t,a){var s,l,o,r=__iced_k_noop,e=iced.findDeferral(arguments);if(null==a&&(a=$.noop),null!=(null!=t?t.language:void 0))return r(a(t.language,10));i=this;var i,n=function(){var t,e,i,n;if(null!=(null!=s?s.HTTP_ACCEPT_LANGUAGE:void 0))for(console.log(""+s.HTTP_ACCEPT_LANGUAGE),t=0,e=(i=s.HTTP_ACCEPT_LANGUAGE.split(",")).length;t<e;t++){n=i[t].split(";"),l=n[0],o=n[1],console.log(l+", "+o),"*"===l?a("English",-.5):(o=l.split("-")[0],langc in exportObj.codeToLanguage?a(exportObj.codeToLanguage[o],8):a("English",-1));break}else a("English",-1);return r()};n=new iced.Deferrals(n,{parent:e,funcname:"SquadBuilderBackend.getLanguagePreference"}),i.getHeaders(n.defer({assign_fn:function(){return s=arguments[0]},lineno:959})),n._fulfill()},t.prototype.getCollectionCheck=function(t,e){return null==e&&(e=$.noop),null!=(null!=t?t.collectioncheck:void 0)?e(t.collectioncheck):e(this.collectioncheck=!0)},t.prototype.saveCollection=function(t,n){return null==n&&(n=$.noop),t={expansions:t.expansions,singletons:t.singletons,checks:t.checks},$.post(this.server+"/collection",t).done(function(t,e,i){return n(t.success)})},t.prototype.loadCollection=function(){return $.get(this.server+"/collection").done(function(t,e,i){t=t.collection;return new exportObj.Collection({expansions:t.expansions,singletons:t.singletons,checks:t.checks})})},t}(),exportObj="undefined"!=typeof exports&&null!==exports?exports:this,TYPES=["pilots","upgrades","ships"],byName=function(t,e){t=(t.display_name||t.name).toLowerCase().replace(/[^a-zA-Z0-9]/g,""),e=(e.display_name||e.name).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");return t<e?-1:e<t?1:0},byPoints=function(t,e){return t.data.points<e.data.points?-1:e.data.points<t.data.points?1:byName(t,e)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},exportObj.CardBrowser=function(){function t(t){this.container=$(t.container),this.currently_selected=null,this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.prepareData(),this.setupUI(),this.setupHandlers()}return t.prototype.setupUI=function(){var t,e,c,i,u,h,n,p,f,a,s,l,o,r,d,m,_,b,g,v,x,k;for(e in this.container.append($.trim('<div class="container-fluid xwing-card-browser">\n    <div class="row">\n        <div class="col-md-4">\n            <div class="card card-search-container">\n            <h5 class="card-title translated" defaultText="Card Search"></h5>\n                <div class="advanced-search-container">\n                    <div class = "card search-container general-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="General"></h6>\n                        <label class = "text-search advanced-search-label">\n                        <strong class="translated" defaultText="Textsearch:"></strong>\n                            <input type="search" placeholder="'+exportObj.translate("ui","Placeholder Textsearch Browser")+'" class = "card-search-text">\n                        </label>\n                        <div class= "advanced-search-faction-selection-container">\n                            <label class = "advanced-search-label select-available-slots">\n                                <strong class="translated" defaultText="Factions:"></strong>\n                                <select class="advanced-search-selection faction-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","All factions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-point-selection-container">\n                            <strong class="translated" defaultText="Point costs:"></strong>\n                            <label class = "advanced-search-label set-minimum-points">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-point-cost advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-points">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-point-cost advanced-search-number-input" value="200" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-collection-container">\n                            <strong class="translated" defaultText="Owned copies:"></strong>\n                            <label class = "advanced-search-label set-minimum-owned-copies">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-owned-copies advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-owened-copies">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-owned-copies advanced-search-number-input" value="100" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-misc-container">\n                            <strong class="translated" defaultText="Misc:"></strong>\n                            <label class = "advanced-search-label toggle-unique">\n                                <input type="checkbox" class="unique-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is unique"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-non-unique">\n                                <input type="checkbox" class="non-unique-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is not unique"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-standard">\n                                <input type="checkbox" class="standard-checkbox advanced-search-checkbox" />  <span class="translated" defaultText="Standard legal"></span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class = "card search-container ship-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="Ships and Pilots"></h6>\n                        <div class = "advanced-search-slot-available-container">\n                            <label class = "advanced-search-label select-available-slots">\n                                <strong class="translated" defaultText="Slots:"></strong>\n                                <select class="advanced-search-selection slot-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                            <br />\n                            <label class = "advanced-search-label toggle-unique">\n                                <input type="checkbox" class="duplicate-slots-checkbox advanced-search-checkbox" /> '+exportObj.translate("ui","Has multiple of the chosen slots")+'\n                            </label>\n                        </div>\n                        <div class = "advanced-search-keyword-available-container">\n                            <label class = "advanced-search-label select-available-keywords">\n                                <strong class="translated" defaultText="Keywords:"></strong>\n                                <select class="advanced-search-selection keyword-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","keywords")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-actions-available-container">\n                            <label class = "advanced-search-label select-available-actions">\n                                <strong class="translated" defaultText="Actions:"></strong>\n                                <select class="advanced-search-selection action-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","actions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-linkedactions-available-container">\n                            <label class = "advanced-search-label select-available-linkedactions">\n                                <strong class="translated" defaultText="Linked actions:"></strong>\n                                <select class="advanced-search-selection linkedaction-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","actions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-ini-container">\n                            <strong class="translated" defaultText="Initiative:"></strong>\n                            <label class = "advanced-search-label set-minimum-ini">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-ini advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-ini">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-ini advanced-search-number-input" value="6" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-hull-container">\n                            <strong class="translated" defaultText="Hull:"></strong>\n                            <label class = "advanced-search-label set-minimum-hull">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-hull advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-hull">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-hull advanced-search-number-input" value="12" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-shields-container">\n                            <strong class="translated" defaultText="Shields:"></strong>\n                            <label class = "advanced-search-label set-minimum-shields">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-shields advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-shields">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-shields advanced-search-number-input" value="6" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-agility-container">\n                            <strong class="translated" defaultText="Agility:"></strong>\n                            <label class = "advanced-search-label set-minimum-agility">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-agility advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-agility">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-agility advanced-search-number-input" value="3" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-base-size-container">\n                            <strong class="translated" defaultText="Base size:"></strong>\n                            <label class = "advanced-search-label toggle-small-base">\n                                <input type="checkbox" class="small-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Small"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-medium-base">\n                                <input type="checkbox" class="medium-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Medium"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-large-base">\n                                <input type="checkbox" class="large-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Large"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-large-base">\n                                <input type="checkbox" class="huge-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Huge"></span>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-attack-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-frontarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attack">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attack advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attack">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attack advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackt-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackt">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackt advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackt">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackt advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackdt-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-doubleturretarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackdt">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackdt advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackdt">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackdt advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackf-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-fullfrontarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackf">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackf advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackf">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackf advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackb-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-reararc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackb">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackb advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackb">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackb advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackbull-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackbull">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackbull advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackbull">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackbull advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                    </div>\n                    <div class = "card search-container other-stuff-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="Other Stuff"></h6>\n                        <div class = "advanced-search-slot-used-container">\n                            <label class = "advanced-search-label select-used-slots">\n                                <strong class="translated" defaultText="Used slot:"></strong>\n                                <select class="advanced-search-selection slot-used-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-slot-used-second-slot-container">\n                            <label class = "advanced-search-label select-used-second-slots">\n                                <strong class="translated" defaultText="Used double-slot:"></strong>\n                                <select class="advanced-search-selection slot-used-second-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                            <br />\n                            <label class = "advanced-search-label has-a-second-slot">\n                                <input type="checkbox" class="advanced-search-checkbox has-a-second-slot-checkbox" /> <span class="translated" defaultText="Only upgrades requiring multiple slots"></span>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-charge-container">\n                            <strong class="translated" defaultText="Charges:"></strong>\n                            <label class = "advanced-search-label set-minimum-charge">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-charge advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-charge">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-charge advanced-search-number-input" value="5" /> \n                            </label>\n                            <br />\n                            <label class = "advanced-search-label has-recurring-charge">\n                                <input type="checkbox" class="advanced-search-checkbox has-recurring-charge-checkbox" checked="checked"/> <span class="translated" defaultText="Recurring"></span>\n                            </label>\n                            <label class = "advanced-search-label has-not-recurring-charge">\n                                <input type="checkbox" class="advanced-search-checkbox has-not-recurring-charge-checkbox" checked="checked"/> <span class="translated" defaultText="Not recurring"></span>\n                            </label>\n                        <div class = "advanced-search-force-container">\n                            <strong class="translated" defaultText="Force:"></strong>\n                            <label class = "advanced-search-label set-minimum-force">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-force advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-force">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-force advanced-search-number-input" value="3" /> \n                            </label>\n                        </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="col-md-4 card-selecting-area">\n            <span class="translate sort-cards-by" defaultText="Sort cards by"></span><span class="translated" defaultText="Sort by">:</span> <select class="sort-by">\n                <option value="name" class="translated" defaultText="Name"></option>\n                <option value="source" class="translated" defaultText="Source"></option>\n                <option value="type-by-points" class="translated" defaultText="Type (by Points)"></option>\n                <option value="type-by-name" selected="1" class="translated" defaultText="Type (by Name)" selected="selected">'+exportObj.translate("ui","Type (by Name)")+'</option>\n            </select>\n            <div class="card-selector-container">\n\n            </div>\n            <br>\n            <div class="card-viewer-conditions-container">\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="card-viewer-container">\n            </div>\n        </div>\n    </div>\n</div>')),this.card_selector_container=$(this.container.find(".xwing-card-browser .card-selector-container")),this.card_viewer_container=$(this.container.find(".xwing-card-browser .card-viewer-container")),this.card_viewer_container.append($.trim(exportObj.builders[7].createInfoContainerUI(!1))),this.card_viewer_container.hide(),this.card_viewer_conditions_container=$(this.container.find(".xwing-card-browser .card-viewer-conditions-container")),this.card_viewer_conditions_container.hide(),this.advanced_search_container=$(this.container.find(".xwing-card-browser .advanced-search-container")),this.sort_selector=$(this.container.find("select.sort-by")),this.sort_selector.select2({minimumResultsForSearch:-1}),this.card_search_text=$(this.container.find(".xwing-card-browser .card-search-text"))[0],this.faction_selection=$(this.container.find(".xwing-card-browser select.faction-selection")),v=exportObj.pilotsByFactionXWS)v[e],(a=$(document.createElement("OPTION"))).val(e),a.text(exportObj.translate("faction",e)),this.faction_selection.append(a);for(s in(c=$(document.createElement("OPTION"))).val("Factionless"),c.text(exportObj.translate("faction","Factionless")),this.faction_selection.append(c),this.faction_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.minimum_point_costs=$(this.container.find(".xwing-card-browser .minimum-point-cost"))[0],this.maximum_point_costs=$(this.container.find(".xwing-card-browser .maximum-point-cost"))[0],this.standard_checkbox=$(this.container.find(".xwing-card-browser .standard-checkbox"))[0],this.unique_checkbox=$(this.container.find(".xwing-card-browser .unique-checkbox"))[0],this.non_unique_checkbox=$(this.container.find(".xwing-card-browser .non-unique-checkbox"))[0],this.base_size_checkboxes={huge:$(this.container.find(".xwing-card-browser .huge-base-checkbox"))[0],large:$(this.container.find(".xwing-card-browser .large-base-checkbox"))[0],medium:$(this.container.find(".xwing-card-browser .medium-base-checkbox"))[0],small:$(this.container.find(".xwing-card-browser .small-base-checkbox"))[0]},this.slot_available_selection=$(this.container.find(".xwing-card-browser select.slot-available-selection")),exportObj.upgradesBySlotCanonicalName)(a=$(document.createElement("OPTION"))).val(s),a.text(exportObj.translate("slot",s)),this.slot_available_selection.append(a);for(p in this.slot_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.keyword_available_selection=$(this.container.find(".xwing-card-browser select.keyword-available-selection")),n=[],exportObj.pilotsByKeyword)for(l=0,m=(h=p.split(",")).length;l<m;l++)i=h[l],n.indexOf(i)<0&&"undefined"!==i&&n.push(i);for(n.sort(),o=0,_=n.length;o<_;o++)u=n[o],(a=$(document.createElement("OPTION"))).val(u),a.text(exportObj.translate("keyword",u)),this.keyword_available_selection.append(a);for(this.keyword_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.duplicateslots=$(this.container.find(".xwing-card-browser .duplicate-slots-checkbox"))[0],this.action_available_selection=$(this.container.find(".xwing-card-browser select.action-available-selection")),r=0,b=(x=["Evade","Focus","Lock","Boost","Barrel Roll","Calculate","Reinforce","Rotate Arc","Coordinate","Slam","Reload","Jam"].sort()).length;r<b;r++)t=x[r],(a=$(document.createElement("OPTION"))).text(exportObj.translate("action",t)),a.val(t),this.action_available_selection.append(a);for(this.action_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.linkedaction_available_selection=$(this.container.find(".xwing-card-browser select.linkedaction-available-selection")),d=0,g=(k=["Evade","Focus","Lock","Boost","Barrel Roll","Calculate","Reinforce","Rotate Arc","Coordinate","Slam","Reload","Jam"].sort()).length;d<g;d++)f=k[d],(a=$(document.createElement("OPTION"))).text(exportObj.translate("action",f)),a.val(f),this.linkedaction_available_selection.append(a);for(s in this.linkedaction_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.slot_used_selection=$(this.container.find(".xwing-card-browser select.slot-used-selection")),exportObj.upgradesBySlotCanonicalName)(a=$(document.createElement("OPTION"))).text(exportObj.translate("slot",s)),a.val(s),this.slot_used_selection.append(a);for(s in this.slot_used_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.slot_used_second_selection=$(this.container.find(".xwing-card-browser select.slot-used-second-selection")),exportObj.upgradesBySlotCanonicalName)(a=$(document.createElement("OPTION"))).text(exportObj.translate("slot",s)),a.val(s),this.slot_used_second_selection.append(a);return this.slot_used_second_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.minimum_charge=$(this.container.find(".xwing-card-browser .minimum-charge"))[0],this.maximum_charge=$(this.container.find(".xwing-card-browser .maximum-charge"))[0],this.minimum_ini=$(this.container.find(".xwing-card-browser .minimum-ini"))[0],this.maximum_ini=$(this.container.find(".xwing-card-browser .maximum-ini"))[0],this.minimum_force=$(this.container.find(".xwing-card-browser .minimum-force"))[0],this.maximum_force=$(this.container.find(".xwing-card-browser .maximum-force"))[0],this.minimum_hull=$(this.container.find(".xwing-card-browser .minimum-hull"))[0],this.maximum_hull=$(this.container.find(".xwing-card-browser .maximum-hull"))[0],this.minimum_shields=$(this.container.find(".xwing-card-browser .minimum-shields"))[0],this.maximum_shields=$(this.container.find(".xwing-card-browser .maximum-shields"))[0],this.minimum_agility=$(this.container.find(".xwing-card-browser .minimum-agility"))[0],this.maximum_agility=$(this.container.find(".xwing-card-browser .maximum-agility"))[0],this.minimum_attack=$(this.container.find(".xwing-card-browser .minimum-attack"))[0],this.maximum_attack=$(this.container.find(".xwing-card-browser .maximum-attack"))[0],this.minimum_attackt=$(this.container.find(".xwing-card-browser .minimum-attackt"))[0],this.maximum_attackt=$(this.container.find(".xwing-card-browser .maximum-attackt"))[0],this.minimum_attackdt=$(this.container.find(".xwing-card-browser .minimum-attackdt"))[0],this.maximum_attackdt=$(this.container.find(".xwing-card-browser .maximum-attackdt"))[0],this.minimum_attackf=$(this.container.find(".xwing-card-browser .minimum-attackf"))[0],this.maximum_attackf=$(this.container.find(".xwing-card-browser .maximum-attackf"))[0],this.minimum_attackb=$(this.container.find(".xwing-card-browser .minimum-attackb"))[0],this.maximum_attackb=$(this.container.find(".xwing-card-browser .maximum-attackb"))[0],this.minimum_attackbull=$(this.container.find(".xwing-card-browser .minimum-attackbull"))[0],this.maximum_attackbull=$(this.container.find(".xwing-card-browser .maximum-attackbull"))[0],this.hassecondslot=$(this.container.find(".xwing-card-browser .has-a-second-slot-checkbox"))[0],this.recurring_charge=$(this.container.find(".xwing-card-browser .has-recurring-charge-checkbox"))[0],this.not_recurring_charge=$(this.container.find(".xwing-card-browser .has-not-recurring-charge-checkbox"))[0],this.minimum_owned_copies=$(this.container.find(".xwing-card-browser .minimum-owned-copies"))[0],this.maximum_owned_copies=$(this.container.find(".xwing-card-browser .maximum-owned-copies"))[0],exportObj.translateUIElements(this.container)},t.prototype.setupHandlers=function(){var c,u,e,i,h,p,n,t,a,s,l,o,r,d,f,m,_,b,g,v,x,k,y,w,q,O,S,T,j,C,I,L,A,P,U,E,D,M,B,N,z,R,F,W,G,X,H,Q,V,Y;for(c in this.sort_selector.change((e=this,function(t){return e.renderList(e.sort_selector.val())})),$("#browserTab").on("click",(i=this,function(t){return i.renderList(i.sort_selector.val())})),$(window).on("xwing:afterLanguageLoad",(n=this,function(t,e,i){return null==i&&(i=$.noop),n.language=e,n.prepareData()})).on("xwing-collection:created",(p=this,function(t,e){return p.collection=e})).on("xwing-collection:destroyed",(h=this,function(t,e){return h.collection=null})),this.card_search_text.oninput=(t=this,function(){return t.renderList(t.sort_selector.val())}),this.faction_selection[0].onchange=(a=this,function(){return a.renderList(a.sort_selector.val())}),u=this.base_size_checkboxes)u[c].onclick=function(t){return function(){return t.renderList(t.sort_selector.val())}}(this);return this.minimum_point_costs.oninput=(s=this,function(){return s.renderList(s.sort_selector.val())}),this.maximum_point_costs.oninput=(l=this,function(){return l.renderList(l.sort_selector.val())}),this.standard_checkbox.onclick=(o=this,function(){return o.renderList(o.sort_selector.val())}),this.unique_checkbox.onclick=(r=this,function(){return r.renderList(r.sort_selector.val())}),this.non_unique_checkbox.onclick=(d=this,function(){return d.renderList(d.sort_selector.val())}),this.slot_available_selection[0].onchange=(f=this,function(){return f.renderList(f.sort_selector.val())}),this.keyword_available_selection[0].onchange=(m=this,function(){return m.renderList(m.sort_selector.val())}),this.duplicateslots.onclick=(_=this,function(){return _.renderList(_.sort_selector.val())}),this.action_available_selection[0].onchange=(b=this,function(){return b.renderList(b.sort_selector.val())}),this.linkedaction_available_selection[0].onchange=(g=this,function(){return g.renderList(g.sort_selector.val())}),this.slot_used_selection[0].onchange=(v=this,function(){return v.renderList(v.sort_selector.val())}),this.slot_used_second_selection[0].onchange=(x=this,function(){return x.renderList(x.sort_selector.val())}),this.not_recurring_charge.onclick=(k=this,function(){return k.renderList(k.sort_selector.val())}),this.recurring_charge.onclick=(y=this,function(){return y.renderList(y.sort_selector.val())}),this.hassecondslot.onclick=(w=this,function(){return w.renderList(w.sort_selector.val())}),this.minimum_charge.oninput=(q=this,function(){return q.renderList(q.sort_selector.val())}),this.maximum_charge.oninput=(O=this,function(){return O.renderList(O.sort_selector.val())}),this.minimum_ini.oninput=(S=this,function(){return S.renderList(S.sort_selector.val())}),this.maximum_ini.oninput=(T=this,function(){return T.renderList(T.sort_selector.val())}),this.minimum_hull.oninput=(j=this,function(){return j.renderList(j.sort_selector.val())}),this.maximum_hull.oninput=(C=this,function(){return C.renderList(C.sort_selector.val())}),this.minimum_force.oninput=(I=this,function(){return I.renderList(I.sort_selector.val())}),this.maximum_force.oninput=(L=this,function(){return L.renderList(L.sort_selector.val())}),this.minimum_shields.oninput=(A=this,function(){return A.renderList(A.sort_selector.val())}),this.maximum_shields.oninput=(P=this,function(){return P.renderList(P.sort_selector.val())}),this.minimum_agility.oninput=(U=this,function(){return U.renderList(U.sort_selector.val())}),this.maximum_agility.oninput=(E=this,function(){return E.renderList(E.sort_selector.val())}),this.minimum_attack.oninput=(D=this,function(){return D.renderList(D.sort_selector.val())}),this.maximum_attack.oninput=(M=this,function(){return M.renderList(M.sort_selector.val())}),this.minimum_attackt.oninput=(B=this,function(){return B.renderList(B.sort_selector.val())}),this.maximum_attackt.oninput=(N=this,function(){return N.renderList(N.sort_selector.val())}),this.minimum_attackdt.oninput=(z=this,function(){return z.renderList(z.sort_selector.val())}),this.maximum_attackdt.oninput=(R=this,function(){return R.renderList(R.sort_selector.val())}),this.minimum_attackf.oninput=(F=this,function(){return F.renderList(F.sort_selector.val())}),this.maximum_attackf.oninput=(W=this,function(){return W.renderList(W.sort_selector.val())}),this.minimum_attackb.oninput=(G=this,function(){return G.renderList(G.sort_selector.val())}),this.maximum_attackb.oninput=(X=this,function(){return X.renderList(X.sort_selector.val())}),this.minimum_attackbull.oninput=(H=this,function(){return H.renderList(H.sort_selector.val())}),this.maximum_attackbull.oninput=(Q=this,function(){return Q.renderList(Q.sort_selector.val())}),this.minimum_owned_copies.oninput=(V=this,function(){return V.renderList(V.sort_selector.val())}),this.maximum_owned_copies.oninput=(Y=this,function(){return Y.renderList(Y.sort_selector.val())})},t.prototype.prepareData=function(){var a,i,n,c,t,s,l,u,e,o,r,d,h,p,f,m,_,b,g,v,x,k,y,w;for(this.all_cards=[],e=0,h=TYPES.length;e<h;e++)l=TYPES[e],this.all_cards="upgrades"===l?this.all_cards.concat(function(){var t=exportObj[l],e=[];for(n in t)i=t[n],e.push({name:i.name,display_name:i.display_name,type:exportObj.translate("ui","upgradeHeader",i.slot),data:i,orig_type:i.slot});return e}()):this.all_cards.concat(function(){var t=exportObj[l],e=[];for(n in t)i=t[n],e.push({name:i.name,display_name:i.display_name,type:exportObj.translate("singular",l),data:i,orig_type:exportObj.translateToLang("English","singular",l)});return e}());for(n in this.types=function(){for(var t=["Pilot","Ship"],e=[],i=0,n=t.length;i<n;i++)l=t[i],e.push(exportObj.translate("types",l));return e}(),x=exportObj.upgrades)i=x[n],u=exportObj.translate("ui","upgradeHeader",i.slot),__indexOf.call(this.types,u)<0&&this.types.push(u);for(this.all_cards.sort(byName),this.sources=[],o=0,p=(k=this.all_cards).length;o<p;o++)for(r=0,f=(y=(a=k[o]).data.sources).length;r<f;r++)s=y[r],__indexOf.call(this.sources,s)<0&&this.sources.push(s);for(t=this.types.sort(),c=this.sources.sort(),this.cards_by_type_name={},d=0,m=t.length;d<m;d++)l=t[d],this.cards_by_type_name[l]=function(){for(var t=this.all_cards,e=[],i=0,n=t.length;i<n;i++)(a=t[i]).type===l&&e.push(a);return e}.call(this).sort(byName);for(this.cards_by_type_points={},g=0,_=t.length;g<_;g++)l=t[g],this.cards_by_type_points[l]=function(){for(var t=this.all_cards,e=[],i=0,n=t.length;i<n;i++)(a=t[i]).type===l&&e.push(a);return e}.call(this).sort(byPoints);for(this.cards_by_source={},w=[],v=0,b=c.length;v<b;v++)s=c[v],w.push(this.cards_by_source[s]=function(){for(var t=this.all_cards,e=[],i=0,n=t.length;i<n;i++)a=t[i],0<=__indexOf.call(a.data.sources,s)&&e.push(a);return e}.call(this).sort(byName));return w},t.prototype.renderList=function(c){var t,e,i,u,n,a,s,l,o,h,p,f,m,_,b,g,r,d,v,x,k,y,w,q,O,S,T;switch(null==c&&(c="name"),null!=this.card_selector?this.card_selector.empty():(this.card_selector=$(document.createElement("SELECT")),this.card_selector.addClass("card-selector"),this.card_selector.attr("size",25),this.card_selector_container.append(this.card_selector)),c){case"type-by-name":for(a=0,h=(x=this.types).length;a<h;a++){for(n=x[a],(i=$(document.createElement("OPTGROUP"))).attr("label",n),e=!1,s=0,p=(k=this.cards_by_type_name[n]).length;s<p;s++)t=k[s],this.checkSearchCriteria(t)&&(this.addCardTo(i,t),e=!0);e&&this.card_selector.append(i)}break;case"type-by-points":for(l=0,f=(y=this.types).length;l<f;l++){for(n=y[l],(i=$(document.createElement("OPTGROUP"))).attr("label",n),e=!1,o=0,m=(w=this.cards_by_type_points[n]).length;o<m;o++)t=w[o],this.checkSearchCriteria(t)&&(this.addCardTo(i,t),e=!0);e&&this.card_selector.append(i)}break;case"source":for(r=0,_=(q=this.sources).length;r<_;r++){for(u=q[r],(i=$(document.createElement("OPTGROUP"))).attr("label",exportObj.translate("sources",u)),e=!1,d=0,b=(O=this.cards_by_source[u]).length;d<b;d++)t=O[d],this.checkSearchCriteria(t)&&(this.addCardTo(i,t),e=!0);e&&this.card_selector.append(i)}break;default:for(v=0,g=(S=this.all_cards).length;v<g;v++)t=S[v],this.checkSearchCriteria(t)&&this.addCardTo(this.card_selector,t)}return this.card_selector.change((T=this,function(t){return T.renderCard($(T.card_selector.find(":selected")))}))},t.prototype.renderCard=function(t){t.data("display_name"),t.data("name");var e,i,n,a,s,l,o,r=t.data("card"),t=t.data("orig_type");if("Pilot"!==t&&"Ship"!==t&&"Quickbuild"!==t&&(e={addon_type:t},t="Addon"),"Pilot"===t&&this.card_viewer_container.find("tr.info-faction").show(),this.card_viewer_container.show(),exportObj.builders[7].showTooltip(t,r,null!=e?e:{},this.card_viewer_container),null==(null!=r?r.applies_condition:void 0))return this.card_viewer_conditions_container.hide();if(n=new Set,r.applies_condition instanceof Array)for(a=0,s=(l=r.applies_condition).length;a<s;a++)i=l[a],n.add(exportObj.conditionsByCanonicalName[i]);else n.add(exportObj.conditionsByCanonicalName[r.applies_condition]);return this.card_viewer_conditions_container.text(""),n.forEach((o=this,function(t){var e=$(document.createElement("div"));return e.addClass("conditions-container d-flex flex-wrap"),e.append(conditionToHTML(t)),o.card_viewer_conditions_container.append(e)})),this.card_viewer_conditions_container.show()},t.prototype.addCardTo=function(t,e){var i=$(document.createElement("OPTION"));return i.text((e.display_name||e.name)+" ("+(null!=e.data.points?e.data.points:"*")+(null!=e.data.pointsupg?"/"+e.data.pointsupg:"")+")"),i.data("name",e.name),i.data("display_name",e.display_name),i.data("type",e.type),i.data("card",e.data),i.data("orig_type",e.orig_type),0===this.getCollectionNumber(e)&&i[0].classList.add("result-not-in-collection"),$(t).append(i)},t.prototype.getCollectionNumber=function(t){var e,i;if(null==exportObj.builders[7].collection||null==exportObj.builders[7].collection.counts)return-1;switch(e=0,t.orig_type){case"Pilot":e=null!=(i=null!=(i=exportObj.builders[7].collection.counts.pilot)?i[t.name]:void 0)?i:0;break;case"Ship":e=null!=(i=null!=(i=exportObj.builders[7].collection.counts.ship)?i[t.name]:void 0)?i:0;break;default:e=null!=(i=null!=(i=exportObj.builders[7].collection.counts.upgrade)?i[t.name]:void 0)?i:0}return e},t.prototype.checkSearchCriteria=function(t){var e,i,n,c,u,h,p,a,f,m,_,b,g,v,x,k,s,l,o,r,y,w,q,O,S,$,T,j,C,I,L,A,P,U,E,D,M,B,N,z,R,F,W,G,X,H,Q,V,Y,Z,J,K,tt,et,it,nt,at,st,d,lt,ot,rt,dt,ct,ut,ht=this.card_search_text.value.toLowerCase();if(!(-1<t.name.toLowerCase().indexOf(ht)||-1<(t.data.text&&t.data.text.toLowerCase().indexOf(ht))||t.display_name&&-1<t.display_name.toLowerCase().indexOf(ht))){if(!t.data.ship)return!1;if((l=t.data.ship)instanceof Array){for(q=!1,$=0,I=l.length;$<I;$++)if(-1<(k=l[$]).toLowerCase().indexOf(ht)||exportObj.ships[k].display_name&&-1<exportObj.ships[k].display_name.toLowerCase().indexOf(ht)){q=!0;break}if(!q)return!1}else if(!(-1<l.toLowerCase().indexOf(ht)||exportObj.ships[l].display_name&&-1<exportObj.ships[l].display_name.toLowerCase().indexOf(ht)))return!1}if(o=function(){var t=exportObj.pilotsByFactionXWS,e=[];for(n in t)_=t[n],e.push(n);return e}(),0<(s=this.faction_selection.val()).length){if(0<=__indexOf.call(s,"Factionless")&&s.push(void 0),J=t.data.faction,!(0<=__indexOf.call(s,J)||"Ship"===t.orig_type||t.data.faction instanceof Array))return!1;if(t.data.faction instanceof Array){for(c=!1,T=0,L=(K=t.data.faction).length;T<L;T++)if(n=K[T],0<=__indexOf.call(s,n)){c=!0;break}if(!c)return!1}if("Ship"===t.orig_type){for(c=!1,j=0,M=(at=t.data.factions).length;j<M;j++)if(n=at[j],0<=__indexOf.call(s,n)){c=!0;break}if(!c)return!1}}else s=o;if(this.standard_checkbox.checked){for(C=0,B=(st=null!=t.data.faction?Array.isArray(t.data.faction)?t.data.faction:[t.data.faction]:s).length;C<B;C++)n=st[C],__indexOf.call(s,n)<0||(w=w||exportObj.standardCheckBrowser(t.data,n,t.orig_type));if(!w)return!1}if(0<(x=this.slot_available_selection.val()).length)for(y=t.data.slots,X=0,N=x.length;X<N;X++){if(!(("Torpedo"===(r=x[X])||"Missile"===r||"Cannon"===r)&&null!=y&&0<=__indexOf.call(y,"HardpointShip")||null!=y&&0<=__indexOf.call(y,r)))return!1;if(this.duplicateslots.checked&&0===y.filter(function(t,e,i){return i.indexOf(t)===e&&e!==i.lastIndexOf(t)&&t===r}).length)return!1}if(0<(v=this.keyword_available_selection.val()).length)for(h=t.data.keyword,H=0,z=v.length;H<z;H++)if(u=v[H],!(null!=h&&0<=__indexOf.call(h,u)))return!1;if(J=this.action_available_selection.val(),o=this.linkedaction_available_selection.val(),(0<J.length||0<o.length)&&(i=null!=(d=t.data.actions)?d:[],"Pilot"===t.orig_type&&(i=(i=null!=(d=null!=(d=t.data.ship_override)?d.actions:void 0)?d:exportObj.ships[t.data.ship].actions).concat(null!=(d=null!=(d=t.data.ship_override)?d.actionsred:void 0)?d:exportObj.ships[t.data.ship].actionsred),null!=t.data.keyword&&0<=__indexOf.call(t.data.keyword,"Droid")))){for(m=[],Q=0,R=i.length;Q<R;Q++)null!=(e=i[Q])&&m.push(e.replace("Focus","Calculate"));i=m}for(V=0,F=(lt=null!=J?J:[]).length;V<F;V++)if(e=lt[V],null==i||!(0<=__indexOf.call(i,e)||0<=__indexOf.call(i,"F-"+e)||0<=__indexOf.call(i,"R-"+e)))return!1;for(Y=0,W=(tt=null!=o?o:[]).length;Y<W;Y++)if(e=tt[Y],!(null!=i&&(0<=__indexOf.call(i,"R> "+e)||0<=__indexOf.call(i,"> "+e))))return!1;if(0<this.minimum_point_costs.value||this.maximum_point_costs.value<200){if(!(t.data.points>=this.minimum_point_costs.value&&t.data.points<=this.maximum_point_costs.value||null!=t.data.variablepoints))return!1;if(null!=t.data.variablepoints){for(a=!1,Z=0,G=(et=t.data.pointsarray).length;Z<G;Z++)if((g=et[Z])>=this.minimum_point_costs.value&&g<=this.maximum_point_costs.value){a=!0;break}if(!a)return!1}if("Ship"===t.orig_type){for(a=!1,ot=0,A=s.length;ot<A;ot++){for(f in n=s[ot],it=exportObj.pilotsByFactionCanonicalName[n]){for(rt=0,P=(b=it[f]).length;rt<P;rt++)if((_=b[rt]).ship===t.data.name&&_.points>=this.minimum_point_costs.value&&_.points<=this.maximum_point_costs.value){a=!0;break}if(a)break}if(a)break}if(!a)return!1}}if(0<(S=this.slot_used_selection.val()).length){if(null==t.data.slot)return!1;for(p=!1,dt=0,U=S.length;dt<U;dt++)if(r=S[dt],t.data.slot===r){p=!0;break}if(!p)return!1}if(0<(O=this.slot_used_second_selection.val()).length){if(null==t.data.also_occupies_upgrades)return!1;for(p=!1,ct=0,E=O.length;ct<E;ct++)for(r=O[ct],ut=0,D=(nt=t.data.also_occupies_upgrades).length;ut<D;ut++)if(nt[ut]===r){p=!0;break}if(!p)return!1}if(null==t.data.also_occupies_upgrades&&this.hassecondslot.checked)return!1;if(this.unique_checkbox.checked&&!t.data.unique)return!1;if(this.non_unique_checkbox.checked&&t.data.unique)return!1;if(!(null!=t.data.charge&&t.data.charge<=this.maximum_charge.value&&t.data.charge>=this.minimum_charge.value||this.minimum_charge.value<=0&&null==t.data.charge))return!1;if(t.data.recurring&&!this.recurring_charge.checked)return!1;if(t.data.charge&&!t.data.recurring&&!this.not_recurring_charge.checked)return!1;if(null!=(null!=(d=exportObj.builders[7].collection)?d.counts:void 0)&&!((J=this.getCollectionNumber(t))>=this.minimum_owned_copies.value&&J<=this.maximum_owned_copies.value))return!1;if(null!=t.data.skill){if(!(t.data.skill>=this.minimum_ini.value&&t.data.skill<=this.maximum_ini.value))return!1}else if(!(this.minimum_ini.value<=0&&6<=this.maximum_ini.value))return!1;return!!(this.base_size_checkboxes.small.checked&&this.base_size_checkboxes.medium.checked&&this.base_size_checkboxes.large.checked||(o=!1,"Ship"===t.orig_type?o=null!=t.data.base?o||this.base_size_checkboxes[t.data.base.toLowerCase()].checked:o||this.base_size_checkboxes.small.checked:"Pilot"===t.orig_type&&(o=null!=(l=exportObj.ships[t.data.ship]).base?o||this.base_size_checkboxes[l.base.toLowerCase()].checked:o||this.base_size_checkboxes.small.checked),o))&&(("0"===this.minimum_hull.value&&"12"===this.maximum_hull.value||null!=t.data.hull&&t.data.hull>=this.minimum_hull.value&&t.data.hull<=this.maximum_hull.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].hull>=this.minimum_hull.value&&exportObj.ships[t.data.ship].hull<=this.maximum_hull.value)&&(("0"===this.minimum_shields.value&&"6"===this.maximum_shields.value||null!=t.data.shields&&t.data.shields>=this.minimum_shields.value&&t.data.shields<=this.maximum_shields.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].shields>=this.minimum_shields.value&&exportObj.ships[t.data.ship].shields<=this.maximum_shields.value)&&(("0"===this.minimum_agility.value&&"3"===this.maximum_agility.value||null!=t.data.agility&&t.data.agility>=this.minimum_agility.value&&t.data.agility<=this.maximum_agility.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].agility>=this.minimum_agility.value&&exportObj.ships[t.data.ship].agility<=this.maximum_agility.value)&&(("0"===this.minimum_attack.value&&"5"===this.maximum_attack.value||null!=t.data.attack&&t.data.attack>=this.minimum_attack.value&&t.data.attack<=this.maximum_attack.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attack&&exportObj.ships[t.data.ship].attack>=this.minimum_attack.value&&exportObj.ships[t.data.ship].attack<=this.maximum_attack.value||null==exportObj.ships[t.data.ship].attack&&this.minimum_attack.value<=0)||"Ship"===t.orig_type&&null==t.data.attack&&this.minimum_attack.value<=0)&&(("0"===this.minimum_attackt.value&&"5"===this.maximum_attackt.value||null!=t.data.attackt&&t.data.attackt>=this.minimum_attackt.value&&t.data.attackt<=this.maximum_attackt.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackt&&exportObj.ships[t.data.ship].attackt>=this.minimum_attackt.value&&exportObj.ships[t.data.ship].attackt<=this.maximum_attackt.value||null==exportObj.ships[t.data.ship].attackt&&this.minimum_attackt.value<=0)||"Ship"===t.orig_type&&null==t.data.attackt&&this.minimum_attackt.value<=0)&&(("0"===this.minimum_attackdt.value&&"5"===this.maximum_attackdt.value||null!=t.data.attackdt&&t.data.attackdt>=this.minimum_attackdt.value&&t.data.attackdt<=this.maximum_attackdt.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackdt&&exportObj.ships[t.data.ship].attackdt>=this.minimum_attackdt.value&&exportObj.ships[t.data.ship].attackdt<=this.maximum_attackdt.value||null==exportObj.ships[t.data.ship].attackdt&&this.minimum_attackdt.value<=0)||"Ship"===t.orig_type&&null==t.data.attackdt&&this.minimum_attackdt.value<=0)&&(("0"===this.minimum_attackf.value&&"5"===this.maximum_attackf.value||null!=t.data.attackf&&t.data.attackf>=this.minimum_attackf.value&&t.data.attackf<=this.maximum_attackf.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackf&&exportObj.ships[t.data.ship].attackf>=this.minimum_attackf.value&&exportObj.ships[t.data.ship].attackf<=this.maximum_attackf.value||null==exportObj.ships[t.data.ship].attackf&&this.minimum_attackf.value<=0)||"Ship"===t.orig_type&&null==t.data.attackf&&this.minimum_attackf.value<=0)&&(("0"===this.minimum_attackb.value&&"5"===this.maximum_attackb.value||null!=t.data.attackb&&t.data.attackb>=this.minimum_attackb.value&&t.data.attackb<=this.maximum_attackb.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackb&&exportObj.ships[t.data.ship].attackb>=this.minimum_attackb.value&&exportObj.ships[t.data.ship].attackb<=this.maximum_attackb.value||null==exportObj.ships[t.data.ship].attackb&&this.minimum_attackb.value<=0)||"Ship"===t.orig_type&&null==t.data.attackb&&this.minimum_attackb.value<=0)&&(("0"===this.minimum_attackbull.value&&"5"===this.maximum_attackbull.value||null!=t.data.attackbull&&t.data.attackbull>=this.minimum_attackbull.value&&t.data.attackbull<=this.maximum_attackbull.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackbull&&exportObj.ships[t.data.ship].attackbull>=this.minimum_attackbull.value&&exportObj.ships[t.data.ship].attackbull<=this.maximum_attackbull.value||null==exportObj.ships[t.data.ship].attackbull&&this.minimum_attackbull.value<=0)||"Ship"===t.orig_type&&null==t.data.attackbull&&this.minimum_attackbull.value<=0)&&("0"===this.minimum_force.value&&"3"===this.maximum_force.value||null!=t.data.force&&t.data.force>=this.minimum_force.value&&t.data.force<=this.maximum_force.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].force>=this.minimum_force.value&&exportObj.ships[t.data.ship].force<=this.maximum_force.value||null==t.data.force&&"0"===this.minimum_force.value))))))))))},t}(),(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).RulesBrowser=function(){function t(t){this.container=$(t.container),this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.prepareRulesData(),this.setupRuleUI(),this.setupRulesHandlers()}return t.prototype.setupRuleUI=function(){var t,e;return this.container.append($.trim('<div class="container-fluid xwing-rules-browser">\n    <div class="row">\n        <div class="col-md-4">\n            <div class="card card-search-container">\n                <h5 class="card-title translated" defaultText="Rules Search"></h5>\n                <div class="advanced-search-container">\n                    <h6 class="card-subtitle mb-2 text-muted version"><span class="translated" defaultText="Version"></span>: </h6>\n                    <label class = "text-search advanced-search-label">\n                        <strong class="translated" defaultText="Term:"></strong>\n                        <input type="search" placeholder="'+exportObj.translate("ui","Search for game term or card")+'" class = "rule-search-text">\n                    </label>\n                </div>\n                <div class="rules-container card-selector-container">\n                </div>\n            </div>\n        </div>\n        <div class="col-md-8">\n            <div class="card card-viewer-container card-search-container">\n                <h4 class="card-title info-name"></h4>\n                <br />\n                <p class="info-text" />\n            </div>\n        </div>\n    </div>\n</div>')),this.versionlabel=$(this.container.find(".xwing-rules-browser .version")),this.rule_selector_container=$(this.container.find(".xwing-rules-browser .rules-container")),this.rule_viewer_container=$(this.container.find(".xwing-rules-browser .card-viewer-container")),this.rule_viewer_container.hide(),this.advanced_search_container=$(this.container.find(".xwing-rules-browser .advanced-search-container")),exportObj.translateUIElements(this.container),e=this.all_rules.version.number,t=this.all_rules.version.date,this.versionlabel.append(e+", "+t),this.rule_search_rules_text=$(this.container.find(".xwing-rules-browser .rule-search-text"))[0]},t.prototype.setupRulesHandlers=function(){var n,t;return this.renderRulesList(),$(window).on("xwing:afterLanguageLoad",(n=this,function(t,e,i){return null==i&&(i=$.noop),n.language=e,n.prepareRulesData(),n.renderRulesList()})),this.rule_search_rules_text.oninput=(t=this,function(){return t.renderRulesList()})},t.prototype.prepareRulesData=function(){return this.all_rules=exportObj.rulesEntries(),this.ruletype=["glossary","faq"]},t.prototype.renderRulesList=function(){var t,e,i,n,a,s,l,o,r,d;for(null!=this.rule_selector&&this.rule_selector.remove(),this.rule_selector=$(document.createElement("SELECT")),this.rule_selector.addClass("card-selector"),this.rule_selector.attr("size",25),this.rule_selector_container.append(this.rule_selector),s=0,l=(o=this.ruletype).length;s<l;s++){for(n in a=o[s],(t=$(document.createElement("OPTGROUP"))).attr("label",exportObj.translate("rulestypes",a)),e=!1,r=this.all_rules[a])i=r[n],this.checkRulesSearchCriteria(i)&&(this.addRulesTo(t,i),e=!0);e&&this.rule_selector.append(t)}return this.rule_selector.change((d=this,function(t){return d.renderRules($(d.rule_selector.find(":selected")))}))},t.prototype.renderRules=function(t){t={name:t.data("name"),text:t.data("text")};return this.rule_viewer_container.show(),exportObj.builders[0].showTooltip("Rules",t,"undefined"!=typeof add_opts&&null!==add_opts?add_opts:{},this.rule_viewer_container)},t.prototype.addRulesTo=function(t,e){var i=$(document.createElement("OPTION"));return i.text(""+e.name),i.data("name",e.name),i.data("text",exportObj.fixIcons(e)),$(t).append(i)},t.prototype.checkRulesSearchCriteria=function(t){var e=this.rule_search_rules_text.value.toLowerCase();return-1<t.name.toLowerCase().indexOf(e)||-1<(t.text&&t.text.toLowerCase().indexOf(e))},t}(),SHOW_DEBUG_OUT_MISSING_TRANSLATIONS=!(DFL_LANGUAGE="English"),builders=[],(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).languagePriority=-1;try{!function(){var t,e,i,n,a;if(!(3<exportObj.languagePriority)){for(exportObj.currentLanguage=DFL_LANGUAGE,a=[],i=0,n=(e=[navigator.language].concat(navigator.languages)).length;i<n;i++){if((t=(t=e[i]).split("-")[0])in exportObj.codeToLanguage){exportObj.currentLanguage=exportObj.codeToLanguage[t],exportObj.languagePriority=3;break}a.push(void 0)}}}()}catch(t){all=t,exportObj.currentLanguage=DFL_LANGUAGE}exportObj.loadCards=function(t){return exportObj.cardLoaders[t]()},exportObj.translate=function(){var t=arguments[0],e=arguments[1],i=3<=arguments.length?__slice.call(arguments,2):[];return exportObj.translateToLang.apply(exportObj,[exportObj.currentLanguage,t,e].concat(__slice.call(i)))},exportObj.translateToLang=function(){var e,t=arguments[0],i=arguments[1],n=arguments[2],a=4<=arguments.length?__slice.call(arguments,3):[];try{e=exportObj.translations[t][i][n]}catch(t){all=t,e=void 0}return null!=e?e instanceof Function?e.apply(null,[exportObj.translate].concat(__slice.call(a))):e:t!==DFL_LANGUAGE?(SHOW_DEBUG_OUT_MISSING_TRANSLATIONS&&console.log(t+" translation for "+String(n)+" (category "+String(i)+") missing"),exportObj.translateToLang.apply(exportObj,[DFL_LANGUAGE,i,n].concat(__slice.call(a)))):n},exportObj.setupTranslationSupport=function(){var t,p;return p=builders,$(exportObj).on("xwing:languageChanged",function(c,i,t,e){var n,a,s,l,o,r,d,u=__iced_k_noop,h=iced.findDeferral(arguments);if(null==t&&(t=5),null==e&&(e=$.noop),"reload"!==t){if(t<exportObj.languagePriority)return;exportObj.languagePriority=t,exportObj.currentLanguage=i}if(!(i in exportObj.translations))return u();$(".language-placeholder").text(i),a="",o=(l=p).length,r=0,(d=function(t){var e=function(){return iced.trampoline(function(){return++r,d(t)})};if(!(r<o))return t();n=l[r],a=n.language,s=new iced.Deferrals(e,{parent:h}),n.container.trigger("xwing:beforeLanguageLoad",s.defer({lineno:2139})),s._fulfill()})(function(){var t,e;if(i!==a)exportObj.loadCards(i);for(exportObj.translateUIElements(),t=0,e=p.length;t<e;t++){n=p[t];n.container.trigger("xwing:afterLanguageLoad",i)}return u()})}),t=exportObj.basicCardData(),exportObj.canonicalizeShipNames(t),exportObj.ships=t.ships,exportObj.setupCommonCardData(t),exportObj.loadCards(DFL_LANGUAGE),exportObj.loadCards(exportObj.currentLanguage),$(exportObj).trigger("xwing:languageChanged",[exportObj.currentLanguage,"reload"])},exportObj.translateUIElements=function(t){var e,i,n,a,s;for(null==t&&(t=void 0),s=[],i=0,n=(a=$(".translated",t)).length;i<n;i++)e=a[i],s.push(e.innerHTML=exportObj.translate("ui",e.getAttribute("defaultText")));return s},exportObj.setupTranslationUI=function(t){for(var e,n,i=Object.keys(exportObj.cardLoaders).sort(),a=function(e,i){return n.click(function(t){return null!=i&&i.set("language",e),$(exportObj).trigger("xwing:languageChanged",[e,100])})},s=[],l=0,o=i.length;l<o;l++)e=i[l],(n=$(document.createElement("LI"))).text(e),a(e,t),s.push($(".language-picker .dropdown-menu").append(n));return s},exportObj.registerBuilderForTranslation=function(t){if(__indexOf.call(builders,t)<0)return builders.push(t)},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).sortHelper=function(t,e){var i,n;return t.points===e.points?(i=t.text.replace(/[^a-z0-9]/gi,""))===(n=e.text.replace(/[^a-z0-9]/gi,""))?0:n<i?1:-1:"string"==typeof t.points||t.points>e.points?1:-1},exportObj.toTTS=function(t){return null==t?null:t.replace(/\(.*\)/g,"").replace("",'"').replace("",'"')},exportObj.slotsMatching=function(t,e){return t===e||("HardpointShip"===t||"HardpointShip"===e)&&("Torpedo"===t||"Cannon"===t||"Missile"===t||("Torpedo"===e||"Cannon"===e||"Missile"===e))},$.isMobile=function(){return!!(navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/i)||1<navigator.maxTouchPoints)},$.randomInt=function(t){return Math.floor(Math.random()*t)},$.isElementInView=function(t,e){var i=$(window).scrollTop(),n=i+$(window).height(),a=$(t).offset().top,t=a+$(t).height();return e?i<a&&t<n:a<=n&&i<=t},$.getParameterByName=function(t){return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===(t=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search))?"":decodeURIComponent(t[1].replace(/\+/g," "))},Array.prototype.intersects=function(t){for(var e,i=0,n=this.length;i<n;i++)if(e=this[i],0<=__indexOf.call(t,e))return!0;return!1},Array.prototype.removeItem=function(t){t=this.indexOf(t);return-1!==t&&this.splice(t,1),this},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.getXWSBaseName=function(){return this.split("-")[0]},URL_BASE=window.location.protocol+"//"+window.location.host+window.location.pathname,SQUAD_DISPLAY_NAME_MAX_LENGTH=24,statAndEffectiveStat=function(t,e,i){return null!=t?""+t+(null!=e&&null!=e[i]&&e[i]!==t?" ("+e[i]+")":""):null!=e&&null!=e[i]?"0 ("+e[i]+")":"0"},getPrimaryFaction=function(t){switch(t){case"Rebel Alliance":return"Rebel Alliance";case"Galactic Empire":return"Galactic Empire";default:return t}},conditionToHTML=function(t){return $.trim('<div class="condition">\n    <div class="name">'+(t.unique?"&middot;&nbsp;":"")+(t.display_name||t.name)+'</div>\n    <div class="text">'+t.text+"</div>\n</div>")},exportObj.SquadBuilder=function(){function t(t){this._makeRandomizerLoopFunc=__bind(this._makeRandomizerLoopFunc,this),this._randomizerLoopBody=__bind(this._randomizerLoopBody,this),this.releaseUnique=__bind(this.releaseUnique,this),this.claimUnique=__bind(this.claimUnique,this),this.updatePrintAndExportTexts=__bind(this.updatePrintAndExportTexts,this),this.onSquadNameChanged=__bind(this.onSquadNameChanged,this),this.onSquadDirtinessChanged=__bind(this.onSquadDirtinessChanged,this),this.onSquadLoadRequested=__bind(this.onSquadLoadRequested,this),this.onPointsUpdated=__bind(this.onPointsUpdated,this),this.onGameTypeChanged=__bind(this.onGameTypeChanged,this),this.onNotesUpdated=__bind(this.onNotesUpdated,this),this.updatePermaLink=__bind(this.updatePermaLink,this),this.updateShipOrder=__bind(this.updateShipOrder,this),this.getPermaLink=__bind(this.getPermaLink,this),this.getPermaLinkParams=__bind(this.getPermaLinkParams,this),this.container=$(t.container),this.faction=$.trim(t.faction),this.printable_container=$(t.printable_container),this.tab=$(t.tab),this.show_points_destroyed=!1,this.ships=[],this.uniques_in_use={Pilot:[],Upgrade:[],Slot:[]},this.standard_list={Upgrade:[],Ship:[]},this.suppress_automatic_new_ship=!1,this.tooltip_currently_displaying=null,this.randomizer_options={sources:null,points:20,ship_limit:0,collection_only:!0,fill_zero_pts:!1},this.total_points=0,this.isStandard=null==(t=null!=(t=exportObj.builders[0])?t.isStandard:void 0)||t,this.isEpic=null!=(t=null!=(t=exportObj.builders[0])?t.isEpic:void 0)&&t,this.isQuickbuild=null!=(t=null!=(t=exportObj.builders[0])?t.isQuickbuild:void 0)&&t,this.backend=null,this.current_squad={},this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.collection=null,this.current_obstacles=[],this.setupUI(),this.game_type_selector.val((null!=(t=exportObj.builders[0])?t:this).game_type_selector.val()),this.setupEventHandlers(),window.setInterval(this.updatePermaLink,250),this.isUpdatingPoints=!1,$.getParameterByName("f")===this.faction?(this.resetCurrentSquad(!0),this.loadFromSerialized($.getParameterByName("d"))):(this.resetCurrentSquad(),this.addShip())}return t.prototype.resetCurrentSquad=function(t){var e,i,n;return null==t&&(t=!1),e=this.uitranslation("Unnamed Squadron"),i=$.trim(this.squad_name_input.val())||e,t&&$.trim($.getParameterByName("sn"))&&(i=$.trim($.getParameterByName("sn"))),n=[],t&&$.trim($.getParameterByName("obs"))?(n=$.trim($.getParameterByName("obs")).split(",").slice(0,3),this.current_obstacles=n):this.current_obstacles&&(n=this.current_obstacles),this.current_squad={id:null,name:i,dirty:!1,additional_data:{points:this.total_points,description:"",cards:[],notes:"",obstacles:n,tag:""},faction:this.faction},0<this.total_points&&(i===e&&(this.current_squad.name=this.uitranslation("Unsaved Squadron")),this.current_squad.dirty=!0),this.old_version_container.toggleClass("d-none",!0),this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.newSquadFromScratch=function(t){return null==t&&(t=this.uitranslation("New Squadron")),this.squad_name_input.val(t),this.removeAllShips(),this.suppress_automatic_new_ship||this.addShip(),this.current_obstacles=[],this.resetCurrentSquad(),this.notes.val(""),this.tag.val("")},t.prototype.uitranslation=function(){var t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[];return exportObj.translate("ui",t,e)},t.prototype.setupUI=function(){var t,u,h,p,f,m,_,b,g,e,i,n,a,s,v,x,l,k,y,w,q,O,S,T,o,r,j,C,I,L,d,A,P,c,U,E,D;for(this.status_container=$(document.createElement("DIV")),this.status_container.addClass("container-fluid"),this.status_container.append($.trim('<div class="row squad-name-and-points-row">\n    <div class="col-md-3 squad-name-container">\n        <div class="display-name">\n            <span class="squad-name"></span>\n            <i class="far fa-edit"></i>\n        </div>\n        <div class="input-append">\n            <input type="text" maxlength="64" placeholder="'+this.uitranslation("Name your squad...")+'" />\n            <button class="btn save"><i class="fa fa-pen-square"></i></button>\n        </div>\n        <br />\n        <select class="game-type-selector">\n            <option value="standard" class="translated" defaultText="Standard" selected="selected">'+this.uitranslation("Standard")+'</option>\n            <option value="extended" class="translated" defaultText="Extended"></option>\n            <option value="epic" class="translated" defaultText="Epic"></option>\n            <option value="quickbuild" class="translated" defaultText="Quickbuild"></option>\n        </select>\n    </div>\n    <div class="col-md-4 points-display-container">\n        Points: <span class="total-points">0</span> / <input type="number" class="desired-points" value="20">\n        <span class="points-remaining-container">(<span class="points-remaining"></span>&nbsp;left) <span class="points-destroyed red"></span></span>\n        <span class="content-warning unreleased-content-used d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Unreleased content warning"></span></span>\n        <span class="content-warning loading-failed-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Broken squad link warning"></span></span>\n        <span class="content-warning old-version-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="This squad was created for an older version of X-Wing."></span></span>\n        <span class="content-warning collection-invalid d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Collection warning"></span></span>\n        <span class="content-warning ship-number-invalid-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Ship number warning"></span></span>\n        <span class="content-warning multi-faction-warning-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Multi-Faction warning"></span></span>\n    </div>\n    <div class="col-md-5 float-right button-container">\n        <div class="btn-group float-right">\n\n            <button class="btn btn-info view-as-text"><span class="d-none d-lg-block"><i class="fa fa-print"></i>&nbsp;<span class="translated" defaultText="Print/Export"></span></span><span class="d-lg-none"><i class="fa fa-print"></i></span></button>\n            <a class="btn btn-primary d-none collection"><span class="d-none d-lg-block"><i class="fa fa-folder-open"></i> <span class="translated" defaultText="Your Collection"></span></span><span class="d-lg-none"><i class="fa fa-folder-open"></i></span></a>\n            \x3c!-- Randomize button is marked as danger, since it creates a new squad --\x3e\n            <button class="btn btn-danger randomize"><span class="d-none d-lg-block"><i class="fa fa-random"></i> <span class="translated" defaultText="Randomize!"></span></span><span class="d-lg-none"><i class="fa fa-random"></i></span></button>\n            <button class="btn btn-danger dropdown-toggle" data-toggle="dropdown">\n                <span class="caret"></span>\n            </button>\n            <ul class="dropdown-menu">\n                <li><a class="dropdown-item randomize-options translated" defaultText="Randomizer Options"></a></li>\n                <li><a class="dropdown-item misc-settings translated" defaultText="Misc Settings"></a></li>\n            </ul>\n            \n\n        </div>\n    </div>\n</div>\n\n<div class="row squad-save-buttons">\n    <div class="col-md-12">\n        <button class="show-authenticated btn btn-primary save-list"><i class="far fa-save"></i>&nbsp;<span class="translated" defaultText="Save"></span></button>\n        <button class="show-authenticated btn btn-primary save-list-as"><i class="far fa-file"></i>&nbsp;<span class="translated" defaultText="Save As..."></span></button>\n        <button class="show-authenticated btn btn-primary delete-list disabled"><i class="fa fa-trash"></i>&nbsp;<span class="translated" defaultText="Delete"></span></button>\n        <button class="show-authenticated btn btn-info backend-list-my-squads show-authenticated"><i class="fa fa-download"></i>&nbsp;<span class = "translated" defaultText="Load Squad"></span></button>\n        <button class="btn btn-info import-squad"><i class="fa fa-file-import"></i>&nbsp;<span class="translated" defaultText="Import"></span></button>\n        <button class="btn btn-info show-points-destroyed"><i class="fas fa-bullseye"></i>&nbsp;<span class="show-points-destroyed-span translated" defaultText="'+this.uitranslation("Show Points Destroyed")+'"></span></button>                    \n        <button class="btn btn-danger clear-squad"><i class="fa fa-plus-circle"></i>&nbsp;<span class="translated" defaultText="New Squad"></span></button>\n        <span class="show-authenticated backend-status"></span>\n    </div>\n</div>')),this.container.append(this.status_container),this.xws_import_modal=$(document.createElement("DIV")),this.xws_import_modal.addClass("modal fade import-modal d-print-none"),this.xws_import_modal.tabindex="-1",this.xws_import_modal.role="dialog",this.xws_import_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="XWS Import"></h3>\n            <button type="button" class="close d-print-none" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <span class="translated" defaultText="XWS Import Dialog"></span>\n            <div class="container-fluid">\n                <textarea class="xws-content" placeholder=\''+this.uitranslation("Paste XWS here")+'\'></textarea>\n            </div>\n        </div>\n        <div class="modal-footer d-print-none">\n            <span class="xws-import-status"></span>&nbsp;\n            <button class="btn btn-danger import-xws translated" defaultText="Import"></button>\n        </div>\n    </div>\n</div>')),this.from_xws_button=this.container.find("button.import-squad"),this.from_xws_button.click((_=this,function(t){return t.preventDefault(),_.xws_import_modal.find(".xws-import-status").text(" "),_.xws_import_modal.modal("show")})),this.load_xws_button=$(this.xws_import_modal.find("button.import-xws")),this.load_xws_button.click((b=this,function(t){return t.preventDefault(),exportObj.loadXWSButton(b.xws_import_modal)})),this.container.append(this.xws_import_modal),this.list_modal=$(document.createElement("DIV")),this.list_modal.addClass("modal fade text-list-modal"),this.list_modal.tabindex="-1",this.list_modal.role="dialog",this.container.append(this.list_modal),this.list_modal.append($.trim('<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <div class="d-print-none">\n                <h4 class="modal-title"><span class="squad-name"></span> (<span class="total-points"></span>)</h4>\n            </div>\n            <div class="d-none d-print-block">\n                <div class="fancy-header">\n                    <div class="squad-name"></div>\n                    <div class="squad-faction"></div>\n                    <div class="mask">\n                        <div class="outer-circle">\n                            <div class="inner-circle">\n                                <span class="total-points"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="fancy-under-header"></div>\n            </div>\n            <button type="button" class="close d-print-none" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <div class="fancy-list"></div>\n            <div class="simple-list"></div>\n            <div class="simplecopy-list">\n                <span class="translated" defaultText="Copy below simple text"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="reddit-list">\n                <span class="translated" defaultText="Copy below markdown"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="tts-list">\n                <span class="translated" defaultText="Copy below TTS"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="xws-list">\n                <span class="translated" defaultText="Copy below XWS"></span>\n                <div class="row full-row">\n                    <div class="col d-inline-block d-none d-sm-block"><textarea></textarea><br /><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button></div>\n                    <div class="col d-inline-block d-none d-sm-block qrcode-container" id="xws-qrcode-container"></div>\n                </div>\n            </div>\n        </div>\n        <div class="container-fluid modal-footer d-print-none">\n            <div class="row full-row">\n                <div class="col d-inline-block d-none d-sm-block right-col">\n                    <label class="color-skip-text-checkbox">\n                        <span class="translated" defaultText="Skip Card Text"></span> <input type="checkbox" class="toggle-skip-text-print" />\n                    </label><br />\n                    <label class="vertical-space-checkbox">\n                        <span class="translated" defaultText="Space for Cards"></span> <input type="checkbox" class="toggle-vertical-space" />\n                    </label><br />\n                    <label class="maneuver-print-checkbox">\n                        <span class="translated" defaultText="Include Maneuvers Chart"></span> <input type="checkbox" class="toggle-maneuver-print" />\n                    </label><br />\n                    <label class="expanded-shield-hull-print-checkbox">\n                        <span class="translated" defaultText="Expand Shield and Hull"></span> <input type="checkbox" class="toggle-expanded-shield-hull-print" />\n                    </label>\n                </div>\n                <div class="col d-inline-block d-none d-sm-block right-col">\n                    <label class="color-print-checkbox">\n                        <span class="translated" defaultText="Print Color"></span> <input type="checkbox" class="toggle-color-print" checked="checked" />\n                    </label><br />\n                    <label class="qrcode-checkbox">\n                        <span class="translated" defaultText="Include QR codes"></span> <input type="checkbox" class="toggle-juggler-qrcode" checked="checked" />\n                    </label><br />\n                    <label class="obstacles-checkbox">\n                        <span class="translated" defaultText="Include Obstacle Choices"></span> <input type="checkbox" class="toggle-obstacles" checked="checked" />\n                    </label>\n                </div>\n            </div>\n            <div class="row btn-group list-display-mode">\n                <button class="btn btn-modal select-simple-view translated" defaultText="Simple"></button>\n                <button class="btn btn-modal select-fancy-view d-none d-sm-block translated" defaultText="Fancy"></button>\n                <button class="btn btn-modal select-simplecopy-view translated" defaultText="Text"></button>\n                <button class="btn btn-modal select-reddit-view translated" defaultText="Reddit"></button>\n                <button class="btn btn-modal select-tts-view translated" defaultText="TTS"></button>\n                <button class="btn btn-modal select-xws-view translated" defaultText="XWS"></button>\n            </div>\n            <button class="btn btn-modal print-list d-none d-sm-block"><i class="fa fa-print"></i>&nbsp;<span class="translated" defaultText="Print"></span></button>\n        </div>\n    </div>\n</div>')),this.fancy_container=$(this.list_modal.find(".fancy-list")),this.fancy_total_points_container=$(this.list_modal.find("div.modal-header .total-points")),this.simple_container=$(this.list_modal.find("div.modal-body .simple-list")),this.reddit_container=$(this.list_modal.find("div.modal-body .reddit-list")),this.reddit_textarea=$(this.reddit_container.find("textarea")),this.reddit_textarea.attr("readonly","readonly"),this.simplecopy_container=$(this.list_modal.find("div.modal-body .simplecopy-list")),this.simplecopy_textarea=$(this.simplecopy_container.find("textarea")),this.simplecopy_textarea.attr("readonly","readonly"),this.tts_container=$(this.list_modal.find("div.modal-body .tts-list")),this.tts_textarea=$(this.tts_container.find("textarea")),this.tts_textarea.attr("readonly","readonly"),this.xws_container=$(this.list_modal.find("div.modal-body .xws-list")),this.xws_textarea=$(this.xws_container.find("textarea")),this.xws_textarea.attr("readonly","readonly"),this.toggle_vertical_space_container=$(this.list_modal.find(".vertical-space-checkbox")),this.toggle_color_print_container=$(this.list_modal.find(".color-print-checkbox")),this.toggle_color_skip_text=$(this.list_modal.find(".color-skip-text-checkbox")),this.toggle_maneuver_dial_container=$(this.list_modal.find(".maneuver-print-checkbox")),this.toggle_expanded_shield_hull_container=$(this.list_modal.find(".expanded-shield-hull-print-checkbox")),this.toggle_qrcode_container=$(this.list_modal.find(".qrcode-checkbox")),this.toggle_obstacle_container=$(this.list_modal.find(".obstacles-checkbox")),this.btn_print_list=$(this.list_modal.find(".print-list"))[0],this.list_modal.on("click","button.btn-copy",(g=this,function(t){if(g.self=$(t.currentTarget),g.self.siblings("textarea").select(),g.success=document.execCommand("copy"),g.success)return g.self.addClass("btn-success"),setTimeout(function(){return g.self.removeClass("btn-success")},1e3)})),this.select_simple_view_button=$(this.list_modal.find(".select-simple-view")),this.select_simple_view_button.click((e=this,function(t){if(e.select_simple_view_button.blur(),"simple"!==e.list_display_mode)return e.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),e.select_simple_view_button.addClass("btn-inverse"),e.list_display_mode="simple",e.simple_container.show(),e.fancy_container.hide(),e.simplecopy_container.hide(),e.reddit_container.hide(),e.tts_container.hide(),e.xws_container.hide(),e.toggle_vertical_space_container.hide(),e.toggle_color_print_container.hide(),e.toggle_color_skip_text.hide(),e.toggle_maneuver_dial_container.hide(),e.toggle_expanded_shield_hull_container.hide(),e.toggle_qrcode_container.show(),e.toggle_obstacle_container.show(),e.btn_print_list.disabled=!1})),this.select_fancy_view_button=$(this.list_modal.find(".select-fancy-view")),this.select_fancy_view_button.click((i=this,function(t){if(i.select_fancy_view_button.blur(),"fancy"!==i.list_display_mode)return i.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),i.select_fancy_view_button.addClass("btn-inverse"),i.list_display_mode="fancy",i.fancy_container.show(),i.simple_container.hide(),i.simplecopy_container.hide(),i.reddit_container.hide(),i.tts_container.hide(),i.xws_container.hide(),i.toggle_vertical_space_container.show(),i.toggle_color_print_container.show(),i.toggle_color_skip_text.show(),i.toggle_maneuver_dial_container.show(),i.toggle_expanded_shield_hull_container.show(),i.toggle_qrcode_container.show(),i.toggle_obstacle_container.show(),i.btn_print_list.disabled=!1})),this.select_reddit_view_button=$(this.list_modal.find(".select-reddit-view")),this.select_reddit_view_button.click((n=this,function(t){if(n.select_reddit_view_button.blur(),"reddit"!==n.list_display_mode)return n.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),n.select_reddit_view_button.addClass("btn-inverse"),n.list_display_mode="reddit",n.reddit_container.show(),n.simplecopy_container.hide(),n.tts_container.hide(),n.xws_container.hide(),n.simple_container.hide(),n.fancy_container.hide(),n.reddit_textarea.select(),n.reddit_textarea.focus(),n.toggle_vertical_space_container.hide(),n.toggle_color_print_container.hide(),n.toggle_color_skip_text.hide(),n.toggle_maneuver_dial_container.hide(),n.toggle_expanded_shield_hull_container.hide(),n.toggle_qrcode_container.hide(),n.toggle_obstacle_container.hide(),n.btn_print_list.disabled=!0})),this.select_simplecopy_view_button=$(this.list_modal.find(".select-simplecopy-view")),this.select_simplecopy_view_button.click((a=this,function(t){if(a.select_simplecopy_view_button.blur(),"simplecopy"!==a.list_display_mode)return a.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),a.select_simplecopy_view_button.addClass("btn-inverse"),a.list_display_mode="simplecopy",a.reddit_container.hide(),a.simplecopy_container.show(),a.tts_container.hide(),a.xws_container.hide(),a.simple_container.hide(),a.fancy_container.hide(),a.simplecopy_textarea.select(),a.simplecopy_textarea.focus(),a.toggle_vertical_space_container.hide(),a.toggle_color_print_container.hide(),a.toggle_color_skip_text.hide(),a.toggle_maneuver_dial_container.hide(),a.toggle_expanded_shield_hull_container.hide(),a.toggle_qrcode_container.hide(),a.toggle_obstacle_container.hide(),a.btn_print_list.disabled=!0})),this.select_tts_view_button=$(this.list_modal.find(".select-tts-view")),this.select_tts_view_button.click((s=this,function(t){if(s.select_tts_view_button.blur(),"tts"!==s.list_display_mode)return s.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),s.select_tts_view_button.addClass("btn-inverse"),s.list_display_mode="tts",s.tts_container.show(),s.xws_container.hide(),s.simple_container.hide(),s.simplecopy_container.hide(),s.reddit_container.hide(),s.fancy_container.hide(),s.tts_textarea.select(),s.tts_textarea.focus(),s.toggle_vertical_space_container.hide(),s.toggle_color_print_container.hide(),s.toggle_color_skip_text.hide(),s.toggle_maneuver_dial_container.hide(),s.toggle_expanded_shield_hull_container.hide(),s.toggle_qrcode_container.hide(),s.toggle_obstacle_container.hide(),s.btn_print_list.disabled=!0})),this.select_xws_view_button=$(this.list_modal.find(".select-xws-view")),this.select_xws_view_button.click((v=this,function(t){return v.select_xws_view()})),768<=$(window).width()?(this.simple_container.hide(),this.select_fancy_view_button.click()):this.select_simple_view_button.click(),this.clear_squad_button=$(this.status_container.find(".clear-squad")),this.clear_squad_button.click((x=this,function(t){return x.current_squad.dirty&&null!=x.backend?x.backend.warnUnsaved(x,function(){return x.newSquadFromScratch()}):x.newSquadFromScratch()})),this.show_points_destroyed_button=$(this.status_container.find(".show-points-destroyed")),this.show_points_destroyed_button_span=$(this.status_container.find(".show-points-destroyed-span")),this.show_points_destroyed_button.click((l=this,function(t){var e,i,n,a,s;for(l.show_points_destroyed=!l.show_points_destroyed,!1===l.show_points_destroyed?l.points_destroyed_span.hide():l.points_destroyed_span.show(),s=[],i=0,n=(a=l.ships).length;i<n;i++)null!=(e=a[i]).pilot?!1===l.show_points_destroyed?(l.show_points_destroyed_button_span.text(l.uitranslation("Show Points Destroyed")),s.push(e.points_destroyed_button.hide())):(l.show_points_destroyed_button_span.text(l.uitranslation("Hide Points Destroyed")),s.push(e.points_destroyed_button.show())):s.push(void 0);return s})),this.squad_name_container=$(this.status_container.find("div.squad-name-container")),this.squad_name_display=$(this.container.find(".display-name")),this.squad_name_placeholder=$(this.container.find(".squad-name")),this.squad_name_input=$(this.squad_name_container.find("input")),this.squad_name_save_button=$(this.squad_name_container.find("button.save")),this.squad_name_input.closest("div").hide(),this.points_container=$(this.status_container.find("div.points-display-container")),this.total_points_span=$(this.points_container.find(".total-points")),this.game_type_selector=$(this.status_container.find(".game-type-selector")),this.game_type_selector.select2({minimumResultsForSearch:-1}),this.game_type_selector.change((k=this,function(t){return k.onGameTypeChanged(k.game_type_selector.val())})),this.desired_points_input=$(this.points_container.find(".desired-points")),this.desired_points_input.change((y=this,function(t){return y.onPointsUpdated($.noop)})),this.points_remaining_span=$(this.points_container.find(".points-remaining")),this.points_destroyed_span=$(this.points_container.find(".points-destroyed")),this.points_remaining_container=$(this.points_container.find(".points-remaining-container")),this.unreleased_content_used_container=$(this.points_container.find(".unreleased-content-used")),this.loading_failed_container=$(this.points_container.find(".loading-failed-container")),this.old_version_container=$(this.points_container.find(".old-version-container")),this.ship_number_invalid_container=$(this.points_container.find(".ship-number-invalid-container")),this.multi_faction_warning_container=$(this.points_container.find(".multi-faction-warning-container")),this.collection_invalid_container=$(this.points_container.find(".collection-invalid")),this.view_list_button=$(this.status_container.find("div.button-container button.view-as-text")),this.randomize_button=$(this.status_container.find("div.button-container button.randomize")),this.customize_randomizer=$(this.status_container.find("div.button-container a.randomize-options")),this.misc_settings=$(this.status_container.find("div.button-container a.misc-settings")),this.backend_status=$(this.status_container.find(".backend-status")),this.backend_status.hide(),this.collection_button=$(this.status_container.find("div.button-container a.collection")),this.collection_button.click((w=this,function(t){if(t.preventDefault(),!w.collection_button.prop("disabled"))return w.collection.modal.modal("show")})),this.squad_name_input.keypress((q=this,function(t){if(13===t.which)return q.squad_name_save_button.click(),!1})),this.squad_name_input.change((O=this,function(t){return O.backend_status.fadeOut("slow")})),this.squad_name_input.blur((S=this,function(t){return S.squad_name_input.change(),S.squad_name_save_button.click()})),this.squad_name_display.click((T=this,function(t){return t.preventDefault(),T.squad_name_display.hide(),T.squad_name_input.val($.trim(T.current_squad.name)),window.setTimeout(function(){return T.squad_name_input.focus(),T.squad_name_input.select()},100),T.squad_name_input.closest("div").show()})),this.squad_name_save_button.click((o=this,function(t){if(t.preventDefault(),o.current_squad.dirty=!0,o.container.trigger("xwing-backend:squadDirtinessChanged"),0<(o.current_squad.name=$.trim(o.squad_name_input.val())).length)return o.squad_name_display.show(),o.container.trigger("xwing-backend:squadNameChanged"),o.squad_name_input.closest("div").hide()})),this.randomizer_options_modal=$(document.createElement("DIV")),this.randomizer_options_modal.addClass("modal fade randomizer-modal"),this.randomizer_options_modal.tabindex="-1",this.randomizer_options_modal.role="dialog",$("body").append(this.randomizer_options_modal),this.randomizer_options_modal.append($.trim('<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Random Squad Builder Options"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <form>\n                <label>\n                    <span class="translated" defaultText="Maximum Ship Count"></span>\n                    <input type="number" class="randomizer-ship-limit" value="0" placeholder="0" />\n                </label><br />\n                <label>\n                    <input type="checkbox" class="randomizer-collection-only" checked="checked"/> \n                    <span class="translated" defaultText="Limit to collection"></span>\n                </label><br />\n                <label>\n                    <span class="translated" defaultText="Sets and Expansions"></span>\n                    <select class="randomizer-sources" multiple="1" data-placeholder=\''+this.uitranslation("All sets and expansions")+'\'>\n                    </select>\n                </label><br />\n                <label>\n                    <input type="checkbox" class="randomizer-fill-zero-pts" /> \n                    <span class="translated" defaultText="Always fill 0-point slots"></span>\n                </label><br />\n                <label>\n                    <span class="translated" defaultText="Maximum Seconds to Spend Randomizing"></span>\n                    <input type="number" class="randomizer-timeout" value="4" placeholder="4" />\n                </label>\n            </form>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-primary do-randomize translated" aria-hidden="true" defaultText="Roll!"></button>\n            <button class="btn translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),exportObj.translateUIElements(this.randomizer_options_modal),this.randomizer_source_selector=$(this.randomizer_options_modal.find("select.randomizer-sources")),p=0,f=(m=exportObj.expansions).length;p<f;p++)u=m[p],(h=$(document.createElement("OPTION"))).text(u),this.randomizer_source_selector.append(h);return this.randomizer_source_selector.select2({width:"100%",minimumResultsForSearch:$.isMobile()?-1:0}),this.randomizer_collection_selector=$(this.randomizer_options_modal.find(".randomizer-collection-only"))[0],this.randomizer_fill_zero_pts=$(this.randomizer_options_modal.find(".randomizer-fill-zero-pts"))[0],this.randomize_button.click((r=this,function(t){var e,i;return t.preventDefault(),r.current_squad.dirty&&null!=r.backend?r.backend.warnUnsaved(r,function(){return r.randomize_button.click()}):(t=parseInt(r.desired_points_input.val()),(isNaN(t)||t<=0)&&(t=20),e=parseInt($(r.randomizer_options_modal.find(".randomizer-ship-limit")).val()),(isNaN(e)||e<0)&&(e=0),i=parseInt($(r.randomizer_options_modal.find(".randomizer-timeout")).val()),(isNaN(i)||i<=0)&&(i=4),r.randomSquad(t,r.randomizer_source_selector.val(),1e3*i,e,r.randomizer_collection_selector.checked,r.randomizer_fill_zero_pts.checked))})),this.randomizer_options_modal.find("button.do-randomize").click((j=this,function(t){return t.preventDefault(),j.randomizer_options_modal.modal("hide"),j.randomize_button.click()})),this.customize_randomizer.click((C=this,function(t){return t.preventDefault(),C.randomizer_options_modal.modal()})),this.misc_settings_modal=$(document.createElement("DIV")),this.misc_settings_modal.addClass("modal fade"),this.misc_settings_modal.tabindex="-1",this.misc_settings_modal.role="dialog",$("body").append(this.misc_settings_modal),this.misc_settings_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Miscellaneous Settings"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <label class = "toggle-initiative-prefix-names misc-settings-label">\n                <input type="checkbox" class="initiative-prefix-names-checkbox misc-settings-checkbox" /> <span class="translated" defaultText="Use INI prefix"></span> \n            </label><br />\n        </div>\n        <div class="modal-footer">\n            <span class="misc-settings-infoline"></span>\n            &nbsp;\n            <button class="btn translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.misc_settings_infoline=$(this.misc_settings_modal.find(".misc-settings-infoline")),this.misc_settings_initiative_prefix=$(this.misc_settings_modal.find(".initiative-prefix-names-checkbox")),null!=this.backend?this.backend.getSettings((L=this,function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=null!=t.showInitiativeInFrontOfPilotName,null!=t.showInitiativeInFrontOfPilotName)return L.misc_settings_initiative_prefix.prop("checked",!0)})):(null==this.waiting_for_backend&&(this.waiting_for_backend=[]),this.waiting_for_backend.push((I=this,function(){return I.backend.getSettings(function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=null!=t.showInitiativeInFrontOfPilotName,null!=t.showInitiativeInFrontOfPilotName)return I.misc_settings_initiative_prefix.prop("checked",!0)})}))),this.misc_settings_initiative_prefix.click((d=this,function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=d.misc_settings_initiative_prefix.prop("checked"),null!=d.backend)return d.misc_settings_initiative_prefix.prop("checked")?d.backend.set("showInitiativeInFrontOfPilotName","1",function(t){return d.misc_settings_infoline.text(d.uitranslation("Changes Saved")),d.misc_settings_infoline.fadeIn(100,function(){return d.misc_settings_infoline.fadeOut(3e3)})}):d.backend.deleteSetting("showInitiativeInFrontOfPilotName",function(t){return d.misc_settings_infoline.text(d.uitranslation("Changes Saved")),d.misc_settings_infoline.fadeIn(100,function(){return d.misc_settings_infoline.fadeOut(3e3)})})})),this.misc_settings.click((A=this,function(t){return t.preventDefault(),A.misc_settings_modal.modal(),A.misc_settings_initiative_prefix.prop("checked",null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix)})),exportObj.translateUIElements(this.misc_settings_modal),this.choose_obstacles_modal=$(document.createElement("DIV")),this.choose_obstacles_modal.addClass("modal fade choose-obstacles-modal"),this.choose_obstacles_modal.tabindex="-1",this.choose_obstacles_modal.role="dialog",this.container.append(this.choose_obstacles_modal),this.choose_obstacles_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <label class=\'choose-obstacles-description translated\' defaultText="Choose obstacles dialog"></label>\n        </div>\n        <div class="modal-body">\n            <div class="obstacle-select-container" style="float:left">\n                <select multiple class=\'obstacle-select\' size="18">\n                    <option class="coreasteroid0-select translated" value="coreasteroid0" defaultText="Core Asteroid 0"></option>\n                    <option class="coreasteroid1-select translated" value="coreasteroid1" defaultText="Core Asteroid 1"></option>\n                    <option class="coreasteroid2-select translated" value="coreasteroid2" defaultText="Core Asteroid 2"></option>\n                    <option class="coreasteroid3-select translated" value="coreasteroid3" defaultText="Core Asteroid 3"></option>\n                    <option class="coreasteroid4-select translated" value="coreasteroid4" defaultText="Core Asteroid 4"></option>\n                    <option class="coreasteroid5-select translated" value="coreasteroid5" defaultText="Core Asteroid 5"></option>\n                    <option class="yt2400debris0-select translated" value="yt2400debris0" defaultText="YT2400 Debris 0"></option>\n                    <option class="yt2400debris1-select translated" value="yt2400debris1" defaultText="YT2400 Debris 1"></option>\n                    <option class="yt2400debris2-select translated" value="yt2400debris2" defaultText="YT2400 Debris 2"></option>\n                    <option class="vt49decimatordebris0-select translated" value="vt49decimatordebris0" defaultText="VT49 Debris 0"></option>\n                    <option class="vt49decimatordebris1-select translated" value="vt49decimatordebris1" defaultText="VT49 Debris 1"></option>\n                    <option class="vt49decimatordebris2-select translated" value="vt49decimatordebris2" defaultText="VT49 Debris 2"></option>\n                    <option class="core2asteroid0-select translated" value="core2asteroid0" defaultText="Force Awakens Asteroid 0"></option>\n                    <option class="core2asteroid1-select translated" value="core2asteroid1" defaultText="Force Awakens Asteroid 1"></option>\n                    <option class="core2asteroid2-select translated" value="core2asteroid2" defaultText="Force Awakens Asteroid 2"></option>\n                    <option class="core2asteroid3-select translated" value="core2asteroid3" defaultText="Force Awakens Asteroid 3"></option>\n                    <option class="core2asteroid4-select translated" value="core2asteroid4" defaultText="Force Awakens Asteroid 4"></option>\n                    <option class="core2asteroid5-select translated" value="core2asteroid5" defaultText="Force Awakens Asteroid 5"></option>\n                    <option class="gascloud1-select translated" value="gascloud1" defaultText="Gas Cloud 1"></option>\n                    <option class="gascloud2-select translated" value="gascloud2" defaultText="Gas Cloud 2"></option>\n                    <option class="gascloud3-select translated" value="gascloud3" defaultText="Gas Cloud 3"></option>\n                    <option class="gascloud4-select translated" value="gascloud4" defaultText="Gas Cloud 4"></option>\n                    <option class="gascloud5-select translated" value="gascloud5" defaultText="Gas Cloud 5"></option>\n                    <option class="gascloud6-select translated" value="gascloud6" defaultText="Gas Cloud 6"></option>\n                    <option class="pomasteroid1-select translated" value="pomasteroid1" defaultText="Pride of Mandalore Rock 1"></option>\n                    <option class="pomasteroid2-select translated" value="pomasteroid2" defaultText="Pride of Mandalore Rock 2"></option>\n                    <option class="pomasteroid3-select translated" value="pomasteroid3" defaultText="Pride of Mandalore Rock 3"></option>\n                    <option class="pomdebris1-select translated" value="pomdebris1" defaultText="Pride of Mandalore Debris 1"></option>\n                    <option class="pomdebris2-select translated" value="pomdebris2" defaultText="Pride of Mandalore Debris 2"></option>\n                    <option class="pomdebris3-select translated" value="pomdebris3" defaultText="Pride of Mandalore Debris 3"></option>\n                </select>\n            </div>\n            <div>\n                <div class="obstacle-image-container" style="display:none;">\n                    <img class="obstacle-image" src="images/core2asteroid0.png" />\n                </div>\n                <div class="obstacle-sources-container">\n                    <span class="info-header obstacle-sources translated" defaultText="Sources:"></span> \n                    <span class="info-data obstacle-sources"></span>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer d-print-none">\n            <button class="btn close-print-dialog translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.obstacles_select=this.choose_obstacles_modal.find(".obstacle-select"),this.obstacles_select_image=this.choose_obstacles_modal.find(".obstacle-image-container"),this.obstacles_select_sources=this.choose_obstacles_modal.find(".info-data.obstacle-sources"),this.backend_list_squads_button=$(this.container.find("button.backend-list-my-squads")),this.backend_list_squads_button.click((P=this,function(t){if(t.preventDefault(),null!=P.backend)return P.backend.list(P)})),this.backend_save_list_button=$(this.container.find("button.save-list")),this.backend_save_list_button.click((c=this,function(t){var e,i,n=__iced_k_noop,a=iced.findDeferral(arguments);if(t.preventDefault(),null==c.backend||c.backend_save_list_button.hasClass("disabled"))return n();e={points:c.total_points,description:c.describeSquad(),cards:c.listCards(),notes:c.notes.val().substr(0,1024),obstacles:c.getObstacles(),tag:c.tag.val().substr(0,1024)},c.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;<span class="translated" defaultText="Saving squad..."></span>')),c.backend_status.show(),c.backend_save_list_button.addClass("disabled"),a=new iced.Deferrals(function(){return n(i.success?(c.current_squad.dirty=false,c.current_squad.id!=null?c.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;<span class="translated" defaultText="Squad updated successfully."></span>')):(c.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;<span class="translated" defaultText="New squad saved successfully."></span>')),c.current_squad.id=i.id),c.container.trigger("xwing-backend:squadDirtinessChanged")):(c.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+i.error)),c.backend_save_list_button.removeClass("disabled")))},{parent:a}),c.backend.save(c.serialize(),c.current_squad.id,c.current_squad.name,c.faction,e,a.defer({assign_fn:function(){return i=arguments[0]},lineno:3093})),a._fulfill()})),this.backend_save_list_as_button=$(this.container.find("button.save-list-as")),this.backend_save_list_as_button.addClass("disabled"),this.backend_save_list_as_button.click((U=this,function(t){if(t.preventDefault(),null!=U.backend&&!U.backend_save_list_as_button.hasClass("disabled"))return U.backend.showSaveAsModal(U)})),this.backend_delete_list_button=$(this.container.find("button.delete-list")),this.backend_delete_list_button.click((E=this,function(t){if(t.preventDefault(),null!=E.backend&&!E.backend_delete_list_button.hasClass("disabled"))return E.backend.showDeleteModal(E)})),(t=$(document.createElement("DIV"))).addClass("container-fluid"),this.container.append(t),t.append($.trim('<div class="row">\n    <div class="col-md-9 ship-container">\n        <label class="unsortable notes-container show-authenticated col-md-10">\n            <span class="notes-name translated" defaultText="Squad Notes:"></span>\n            <br />\n            <textarea class="squad-notes"></textarea>\n            <br />\n            <span class="tag-name translated" defaultText="Tag:"></span>\n            <input type="search" class="squad-tag"></input>\n        </label>\n        <div class="unsortable obstacles-container">\n                <button class="btn btn-info choose-obstacles"><i class="fa fa-cloud"></i>&nbsp;<span class="translated" defaultText="Choose Obstacles"</span></button>\n        </div>\n    </div>\n    <div class="col-md-3 info-container" id="info-container">\n    </div>\n</div>')),this.ship_container=$(t.find("div.ship-container")),this.info_container=$(t.find("div.info-container")),this.obstacles_container=t.find(".obstacles-container"),this.notes_container=$(t.find(".notes-container")),this.notes=$(this.notes_container.find("textarea.squad-notes")),this.tag=$(this.notes_container.find("input.squad-tag")),this.ship_container.sortable({cancel:".unsortable"}),this.info_container.append($.trim(this.createInfoContainerUI())),this.info_container.find(".info-well").hide(),this.info_intro=this.info_container.find(".intro"),this.print_list_button=$(this.container.find("button.print-list")),this.container.find("[rel=tooltip]").tooltip(),this.obstacles_button=$(this.container.find("button.choose-obstacles")),this.obstacles_button.click((D=this,function(t){return t.preventDefault(),D.showChooseObstaclesModal()})),this.condition_container=$(document.createElement("div")),this.condition_container.addClass("conditions-container d-flex flex-wrap"),this.container.append(this.condition_container),this.mobile_tooltip_modal=$(document.createElement("DIV")),this.mobile_tooltip_modal.addClass("modal fade choose-obstacles-modal d-print-none"),this.mobile_tooltip_modal.tabindex="-1",this.mobile_tooltip_modal.role="dialog",this.container.append(this.mobile_tooltip_modal),this.mobile_tooltip_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n        </div>\n        <div class="modal-body">'+this.createInfoContainerUI(!1)+'        </div>\n        <div class="modal-footer">\n            <button class="btn btn-danger close-print-dialog translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.mobile_tooltip_modal.find("intro").hide(),exportObj.translateUIElements(this.container)},t.prototype.createInfoContainerUI=function(t){return(!0===(t=null==t?!0:t)?'<div class="card intro">\n    <h2>YASB 2 for X-Wing (Version 2.5) </h2>\n    <p>YASB (Yet Another Squad Builder) is a simple, fast, squad builder for X-Wing Miniatures by <a href="https://www.atomicmassgames.com/">Atomic Mass Games</a>.</p>\n    <h5>Credits</h5>\n    <p>Built upon the amazing original <a href="https://geordanr.github.io/xwing/">Yet Another Squad Builder</a>.</p>\n    <p>YASB is updated and maintained by Stephen Kim.</p>\n    <p>Additional credits to:<br>\n    2.5 Update Data: Devon Monkhouse, Perry Low, Andrew Oehler.<br>\n    2.0 launch data: Evan Cameron, Jonathan Hon, Devon Monkhouse, and Mark Stewart.<br>\n    Translation Team: Patrick Mischke, godgremos, Clment Bourgoin, ManuelWittke<br>\n    Site logo: Thomas Kohler<br>\n    Quick Build Support: Patrick Mischke</p>\n\n    <p>This builder is unofficial and is not affiliated with Atomic Mass Games, Lucasfilm Ltd., or Disney.</p>\n\n    <p>This site will always be free, and always 100% available for all people to use. However, if you want to donate, a button is prepared for you.</p>\n    <p><button class="btn btn-primary paypal" onclick="window.open(\'https://paypal.me/raithos\');">Donate</button></p>\n</div>':"")+'\n<div class="card info-well">\n    <div class="info-name"></div>\n    <div class="info-type"></div>\n    <span class="info-collection"></span>\n    <table class="table-sm">\n        <tbody>\n            <tr class="info-faction">\n                <td class="info-header translated" defaultText="Faction"></td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-ship">\n                <td class="info-header translated" defaultText="Ship"></td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-loadout">\n                <td class="info-header translated" defaultText="Loadout"></td>\n                <td class="info-data info-loadout"></td>\n            </tr>\n            <tr class="info-base">\n                <td class="info-header translated" defaultText="Base"></td>\n                <td class="info-data"></td> \n            </tr>\n            <tr class="info-skill">\n                <td class="info-header translated" defaultText="Initiative"></td>\n                <td class="info-data info-skill"></td>\n            </tr>\n            <tr class="info-points">\n                <td class="info-header translated" defaultText="Points"></td>\n                <td class="info-data info-points"></td>\n            </tr>\n            <tr class="info-engagement">\n                <td class="info-header translated" defaultText="Engagement"></td>\n                <td class="info-data info-engagement"></td>\n            </tr>\n            <tr class="info-attack-bullseye">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-bullseyearc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-frontarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-fullfront">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-fullfrontarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-left">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-leftarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-right">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-rightarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-back">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-reararc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-turret">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-singleturretarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-doubleturret">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-doubleturretarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-agility">\n                <td class="info-header"><i class="xwing-miniatures-font header-agility xwing-miniatures-font-agility"></i></td>\n                <td class="info-data info-agility"></td>\n            </tr>\n            <tr class="info-hull">\n                <td class="info-header"><i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull"></i></td>\n                <td class="info-data info-hull"></td>\n            </tr>\n            <tr class="info-shields">\n                <td class="info-header"><i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield"></i></td>\n                <td class="info-data info-shields"></td>\n            </tr>\n            <tr class="info-force">\n                <td class="info-header"><i class="xwing-miniatures-font header-force xwing-miniatures-font-forcecharge"></i></td>\n                <td class="info-data info-force"></td>\n            </tr>\n            <tr class="info-charge">\n                <td class="info-header"><i class="xwing-miniatures-font header-charge xwing-miniatures-font-charge"></i></td>\n                <td class="info-data info-charge"></td>\n            </tr>\n            <tr class="info-energy">\n                <td class="info-header"><i class="xwing-miniatures-font header-energy xwing-miniatures-font-energy"></i></td>\n                <td class="info-data info-energy"></td>\n            </tr>\n            <tr class="info-range">\n                <td class="info-header translated" defaultText="Range"></td>\n                <td class="info-data info-range"></td><td class="info-rangebonus"><i class="xwing-miniatures-font red header-range xwing-miniatures-font-rangebonusindicator"></i></td>\n            </tr>\n            <tr class="info-actions">\n                <td class="info-header translated" defaultText="Actions"></td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-upgrades">\n                <td class="info-header translated" defaultText="Upgrades"></td>\n                <td class="info-data"></td>\n            </tr>\n        </tbody>\n    </table>\n    <p class="info-restrictions"></p>\n    <p class="info-text"></p>\n    <p class="info-maneuvers"></p>\n    <br />\n    <span class="info-header info-sources translated" defaultText="Sources:"></span> \n    <span class="info-data info-sources"></span>\n</div>'},t.prototype.setupEventHandlers=function(){var o,l,i,e,u,h,n,p,f,a,s,m,_,b,r,g,v,k,d,y,x,c;return this.container.on("xwing:claimUnique",(f=this,function(t,e,i,n){return f.claimUnique(e,i,n)})).on("xwing:releaseUnique",(p=this,function(t,e,i,n){return p.releaseUnique(e,i,n)})).on("xwing:pointsUpdated",(n=this,function(t,e){return null==e&&(e=$.noop),n.isUpdatingPoints?e():(n.isUpdatingPoints=!0,n.onPointsUpdated(function(){return n.isUpdatingPoints=!1,e()}))})).on("xwing-backend:squadLoadRequested",(h=this,function(t,e,i){return null==i&&(i=$.noop),h.onSquadLoadRequested(e),i()})).on("xwing-backend:squadDirtinessChanged",(u=this,function(t){return u.onSquadDirtinessChanged()})).on("xwing-backend:squadNameChanged",(e=this,function(t){return e.onSquadNameChanged()})).on("xwing:beforeLanguageLoad",(i=this,function(t,e){return null==e&&(e=$.noop),i.pretranslation_serialized=i.serialize(),e()})).on("xwing:afterLanguageLoad",(l=this,function(t,e,i){var n,a,s;if(null==i&&(i=$.noop),l.language!==e){for(l.language=e,e=l.current_squad.dirty,null!=l.pretranslation_serialized.length&&l.loadFromSerialized(l.pretranslation_serialized),n=0,a=(s=l.ships).length;n<a;n++)s[n].updateSelections();l.current_squad.dirty=e,l.pretranslation_serialized=void 0}return i()})).on("xwing:shipUpdated",(o=this,function(t,e){var i,n,a,s,l;for(null==e&&(e=$.noop),i=!0,a=0,s=(l=o.ships).length;a<s;a++)(n=l[a]).updateSelections(),""===n.ship_selector.val()&&(i=!1);if(i&&!o.suppress_automatic_new_ship)return o.addShip()})),$(window).on("xwing-backend:authenticationChanged",(g=this,function(t){return g.resetCurrentSquad()})).on("xwing-collection:created",(r=this,function(t,e){return r.collection=e,r.checkCollection(),r.collection_button.removeClass("d-none")})).on("xwing-collection:changed",(b=this,function(t,e){return b.checkCollection()})).on("xwing-collection:destroyed",(_=this,function(t,e){return _.collection=null,_.collection_button.addClass("d-none")})).on("xwing:pingActiveBuilder",(m=this,function(t,e){if(m.container.is(":visible"))return e(m)})).on("xwing:activateBuilder",(s=this,function(t,e,i){if(e===s.faction)return s.tab.tab("show"),i(s)})).on("xwing:gameTypeChanged",(a=this,function(t,e,i){if(null==i&&(i=$.noop),a.onGameTypeChanged(e,i),a.game_type_selector.val()!==e)return a.game_type_selector.val(e).trigger("change")})),this.ship_container.on("sortstart",(k=this,function(t,e){return k.oldIndex=e.item.index()})).on("sortstop",(v=this,function(t,e){return v.updateShipOrder(v.oldIndex,e.item.index())})),this.obstacles_select.change((d=this,function(t){var e,a,i;return 3<d.obstacles_select.val().length?d.obstacles_select.val(d.current_squad.additional_data.obstacles):(i=d.current_squad.additional_data.obstacles,d.current_obstacles=function(){for(var t=this.obstacles_select.val(),e=[],i=0,n=t.length;i<n;i++)a=t[i],e.push(a);return e}.call(d),0<(e=null!=i?d.current_obstacles.filter(function(t){return-1===i.indexOf(t)}):d.current_obstacles).length&&d.showChooseObstaclesSelectInformation(e[0]),d.current_squad.additional_data.obstacles=d.current_obstacles,d.current_squad.dirty=!0,d.container.trigger("xwing-backend:squadDirtinessChanged"),d.container.trigger("xwing:pointsUpdated"))})),this.view_list_button.click((y=this,function(t){return t.preventDefault(),y.showTextListModal()})),this.print_list_button.click((x=this,function(t){var e,i,n,c,a,s,l,o,r,u,h,p,f,m,d,_,b,g,v;if(t.preventDefault(),x.printable_container.find(".printable-header").html(x.list_modal.find(".modal-header").html()),x.printable_container.find(".printable-body").text(""),"simple"===x.list_display_mode)x.printable_container.find(".printable-body").html(x.simple_container.html());else{for(s=0,u=(_=x.ships).length;s<u;s++)null!=(c=_[s]).pilot&&x.printable_container.find(".printable-body").append(c.toHTML());if(x.printable_container.find(".fancy-ship").toggleClass("tall",x.list_modal.find(".toggle-vertical-space").prop("checked")),x.printable_container.find(".printable-body").toggleClass("bw",!x.list_modal.find(".toggle-color-print").prop("checked")),x.list_modal.find(".toggle-skip-text-print").prop("checked"))for(l=0,h=(b=x.printable_container.find(".upgrade-text, .fancy-pilot-text")).length;l<h;l++)(a=b[l]).hidden=!0;for(x.list_modal.find(".toggle-maneuver-print").prop("checked")&&x.printable_container.find(".printable-body").append(x.getSquadDialsAsHTML()),e=x.list_modal.find(".toggle-expanded-shield-hull-print").prop("checked"),o=0,p=(g=x.printable_container.find(".expanded-hull-or-shield")).length;o<p;o++)g[o].hidden=!e;for(r=0,f=(v=x.printable_container.find(".simple-hull-or-shield")).length;r<f;r++)v[r].hidden=e;t=function(){switch(this.faction){case"Rebel Alliance":return"rebel";case"Galactic Empire":return"empire";case"Scum and Villainy":return"scum";case"Resistance":return"rebel-outline";case"First Order":return"firstorder";case"Galactic Republic":return"republic";case"Separatist Alliance":return"separatists";case"All":return"first-player-4"}}.call(x),x.printable_container.find(".squad-faction").html('<i class="xwing-miniatures-font xwing-miniatures-font-'+t+'"></i>')}if(x.isStandard&&x.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i>'),x.isEpic&&x.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-energy"></i>'),x.printable_container.find(".printable-body").append($.trim('<div class="version">Points Version: 2.5.0 03/01/2022</div>')),""!==$.trim(x.notes.val())&&(x.printable_container.find(".printable-body").append($.trim('<h5 class="print-notes translated" defaultText="Notes:"></h5>\n<pre class="print-notes"></pre>')),x.printable_container.find(".printable-body pre.print-notes").text(x.notes.val())),x.printable_container.find(".printable-body").append($.trim('<div class="print-conditions"></div>')),x.printable_container.find(".printable-body .print-conditions").html(x.condition_container.html()),x.list_modal.find(".toggle-obstacles").prop("checked")){for(i="",d=0,m=(n=x.getObstacles()).length;d<m;d++)i+='<img class="obstacle-silhouettes" src="images/'+n[d]+'.png" />';x.printable_container.find(".printable-body").append($.trim('<div class="obstacles">\n    <div>Chosen Obstacles:<br>'+i+"</div>\n</div>"))}return null!=(t=x.getPermaLinkParams(["sn","obs"]))&&x.list_modal.find(".toggle-juggler-qrcode").prop("checked")&&(x.printable_container.find(".printable-body").append($.trim('<div class="qrcode-container">\n    <div class="permalink-container">\n        <div class="qrcode"></div>\n        <div class="qrcode-text translated" defaultText="Scan QR-Code"></div>\n    </div>\n    <div class="juggler-container">\n        <div class="qrcode"></div>\n        <div class="qrcode-text translated" defaultText="List Juggler QR-Code"></div>\n    </div>\n</div>')),a="https://yasb-xws.herokuapp.com/juggler"+t,x.printable_container.find(".juggler-container .qrcode").qrcode({render:"div",ec:"M",size:a.length<144?144:160,text:a}),a="https://yasb.app/"+t,x.printable_container.find(".permalink-container .qrcode").qrcode({render:"div",ec:"M",size:a.length<144?144:160,text:a})),window.print()})),$(window).resize((c=this,function(){var t,e,i,n,a;for($(window).width()<768&&"simple"!==c.list_display_mode&&c.select_simple_view_button.click(),a=[],e=0,i=(n=c.ships).length;e<i;e++)t=n[e],a.push(t.checkPilotSelectorQueryModal());return a})),this.notes.change(this.onNotesUpdated),this.tag.change(this.onNotesUpdated),this.notes.on("keyup",this.onNotesUpdated),this.tag.on("keyup",this.onNotesUpdated)},t.prototype.getPermaLinkParams=function(t){var e,i,n={};return __indexOf.call(t=null==t?[]:t,"f")<0&&(n.f=encodeURI(this.faction)),__indexOf.call(t,"d")<0&&(n.d=encodeURI(this.serialize())),__indexOf.call(t,"sn")<0&&(n.sn=encodeURIComponent(this.current_squad.name)),__indexOf.call(t,"obs")<0&&(n.obs=encodeURI(this.current_squad.additional_data.obstacles||"")),"?"+function(){var t=[];for(e in n)i=n[e],t.push(e+"="+i);return t}().join("&")},t.prototype.getPermaLink=function(t){return null==t&&(t=this.getPermaLinkParams()),""+URL_BASE+t},t.prototype.updateShipOrder=function(t,e){var i=this.ships[t];if(this.ships.splice(t,1),this.ships.splice(e,0,i),this.updatePermaLink,t!==e)return this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.updatePermaLink=function(){var t;if(this.container.is(":visible"))return t=this.getPermaLinkParams(),window.location.search!==t?window.history.replaceState(t,"",this.getPermaLink(t)):void 0},t.prototype.onNotesUpdated=function(){if(0<this.total_points)return this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.onGameTypeChanged=function(t,e){var i,n;switch(null==e&&(e=$.noop),this.isStandard,this.isEpic,i=this.isQuickbuild,this.isStandard=!1,this.isEpic=!1,this.isQuickbuild=!1,t){case"extended":this.desired_points_input.val(20);break;case"epic":this.isEpic=!0,this.desired_points_input.val(50);break;case"quickbuild":this.isQuickbuild=!0,this.desired_points_input.val(8);break;default:this.isStandard=!0,this.desired_points_input.val(20)}return i!==this.isQuickbuild?(n=this.current_squad.id,this.newSquadFromScratch($.trim(this.current_squad.name)),this.current_squad.id=n):(n=this.current_squad.id,this.container.trigger("xwing:pointsUpdated",$.noop),this.container.trigger("xwing:shipUpdated")),e()},t.prototype.addStandardizedToList=function(t){var e,i,n,a,s,l,o;if(null!=(null!=(s=t.data)?s.name:void 0)&&-1<(e=this.standard_list.Ship.indexOf(t.data.name))){for(o=[],n=0,a=(l=t.upgrades).length;n<a;n++){if((i=l[n]).slot===this.standard_list.Upgrade[e].slot){i.setData(this.standard_list.Upgrade[e]);break}o.push(void 0)}return o}},t.prototype.onPointsUpdated=function(t){var e,i,n,a,s,l,c,o,u,r,d,h,p,f,m;for(null==t&&(t=$.noop),a=o=0,u=!1,n=r=p=this.ships.length-1;p<=-1?r<-1:-1<r;n=p<=-1?++r:--r)(l=this.ships[n]).validate(),l&&(this.addStandardizedToList(l),o+=l.getPoints(),1===l.destroystate?a+=Math.floor(l.getPoints()/2):2===l.destroystate&&(a+=l.getPoints()),(c=l.checkUnreleasedContent())&&(u=c));if(this.total_points=o,this.points_destroyed=a,this.total_points_span.text(this.total_points),s=parseInt(this.desired_points_input.val())-this.total_points,parseInt(this.total_points),this.points_remaining_span.text(s),this.points_destroyed_span.html(0!==a?'<i class="xwing-miniatures-font xwing-miniatures-font-hit"></i>'+a:""),this.points_remaining_container.toggleClass("red",s<0),this.unreleased_content_used_container.toggleClass("d-none",!u),this.fancy_total_points_container.text(this.total_points),this.updatePrintAndExportTexts(),this.checkCollection(),"undefined"!=typeof Set&&null!==Set){for(i=new Set,d=0,h=(f=this.ships).length;d<h;d++)(l=f[d]).getConditions().forEach(function(t){return i.add(t)});e=[],i.forEach(function(t){return e.push(t)}),e.sort(function(t,e){return t.name.canonicalize()<e.name.canonicalize()?-1:e.name.canonicalize()>t.name.canonicalize()?1:0}),this.condition_container.text(""),e.forEach((m=this,function(t){return m.condition_container.append(conditionToHTML(t))}))}return t(this.total_points)},t.prototype.onSquadLoadRequested=function(t){var e;return this.current_squad=t,this.backend_delete_list_button.removeClass("disabled"),this.current_obstacles=this.current_squad.additional_data.obstacles,this.updateObstacleSelect(this.current_squad.additional_data.obstacles),null!=t.serialized.length&&this.loadFromSerialized(t.serialized),this.notes.val(null!=(e=t.additional_data.notes)?e:""),this.tag.val(null!=(e=t.additional_data.tag)?e:""),this.backend_status.fadeOut("slow"),this.current_squad.dirty=!1,this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.onSquadDirtinessChanged=function(){return this.backend_save_list_button.toggleClass("disabled",!(this.current_squad.dirty&&0<this.total_points)),this.backend_save_list_as_button.toggleClass("disabled",0===this.total_points),this.backend_delete_list_button.toggleClass("disabled",null==this.current_squad.id),1<this.ships.length?$('meta[property="og:description"]').attr("content",this.uitranslation("X-Wing Squadron by YASB 2: ")+this.current_squad.name+": "+this.describeSquad()):$('meta[property="og:description"]').attr("content",this.uitranslation("YASB advertisment"))},t.prototype.onSquadNameChanged=function(){var t=this.current_squad.name.length>SQUAD_DISPLAY_NAME_MAX_LENGTH?this.current_squad.name.substr(0,SQUAD_DISPLAY_NAME_MAX_LENGTH)+"&hellip;":this.current_squad.name;if(this.squad_name_placeholder.text(""),this.squad_name_placeholder.append(t),this.squad_name_input.val(this.current_squad.name),$.getParameterByName("f")===this.faction)return this.current_squad.name!==this.uitranslation("Unnamed Squadron")&&this.current_squad.name!==this.uitranslation("Unsaved Squadron")?document.title!=="YASB 2 - "+this.current_squad.name&&(document.title="YASB 2 - "+this.current_squad.name):document.title="YASB 2",this.updatePrintAndExportTexts()},t.prototype.updatePrintAndExportTexts=function(){var t,e,i,n,a,s,l,o,r,d,c,u;for(this.fancy_container.text(""),this.simple_container.html('<table class="simple-table"></table>'),a=[],i=[],l=[],o=0,d=(u=this.ships).length;o<d;o++)null!=(n=u[o]).pilot&&(this.fancy_container.append(n.toHTML()),this.simple_container.find("table").append(n.toTableRow()),a.push(n.toSimpleCopy()),i.push(n.toRedditText()),l.push(n.toTTSText()));if(this.reddit_container.find("textarea").val($.trim(i.join("    \n")+"    \n**"+this.uitranslation("Total")+":** *"+this.total_points+"*    \n    \n["+this.uitranslation("View in YASB")+"]("+this.getPermaLink()+")")),this.simplecopy_container.find("textarea").val($.trim(a.join("")+"    \n"+this.uitranslation("Total")+": "+this.total_points+"    \n    \n"+this.uitranslation("View in YASB")+": "+this.getPermaLink())),null!=(e=this.getObstacles())&&0<e.length&&0<l.length){for(l[l.length-1]=l[l.length-1].slice(0,-2),s=" |",r=0,c=e.length;r<c;r++)null!=(t=e[r])&&(s+=" "+t+" /");s=s.slice(0,-1),l.push(s)}return this.tts_textarea.val($.trim(""+l.join(""))),this.xws_textarea.val($.trim(JSON.stringify(this.toXWS()))),$("#xws-qrcode-container").text(""),$("#xws-qrcode-container").qrcode({render:"canvas",text:JSON.stringify(this.toMinimalXWS()),ec:"L",size:128})},t.prototype.removeAllShips=function(){for(;0<this.ships.length;)this.removeShip(this.ships[0]);if(0<this.ships.length)throw new Error(this.uitranslation("Ships not emptied"))},t.prototype.showTextListModal=function(){return this.list_modal.modal("show")},t.prototype.showXWSModal=function(t){return this.select_xws_view(),this.showTextListModal()},t.prototype.showChooseObstaclesModal=function(){return this.obstacles_select.val(this.current_squad.additional_data.obstacles),this.choose_obstacles_modal.modal("show")},t.prototype.showChooseObstaclesSelectInformation=function(t){return this.showChooseObstaclesSelectImage(t),this.showChooseObstaclesSelectSources(t)},t.prototype.showChooseObstaclesSelectSources=function(t){var e,t=null!=(t=null!=(t=exportObj.obstacles[t])?t.sources:void 0)?t:[];return this.obstacles_select_sources.text(1<t.length||(e=exportObj.translate("sources","Loose Ships"),!(0<=__indexOf.call(t,e)))?0<t.length?t.join(", "):exportObj.translate("ui","unreleased"):this.uitranslation("Only available from 1st edition"))},t.prototype.showChooseObstaclesSelectImage=function(t){return this.image_name="images/"+t+".png",this.obstacles_select_image.find(".obstacle-image").attr("src",this.image_name),this.obstacles_select_image.show()},t.prototype.updateObstacleSelect=function(t){return this.current_obstacles=t,this.obstacles_select.val(t)},t.prototype.serialize=function(){var a;return"v9Z"+function(){switch(this.game_type_selector.val()){case"standard":return"h";case"extended":return"s";case"epic":return"e";case"quickbuild":return"q"}}.call(this)+"Z"+$.trim(this.desired_points_input.val())+"Z"+function(){for(var t=this.ships,e=[],i=0,n=t.length;i<n;i++)null==(a=t[i]).pilot||this.isQuickbuild&&!a.primary||e.push(a.toSerialized());return e}.call(this).join("Y")},t.prototype.changeGameTypeOnSquadLoad=function(t){if(this.game_type_selector.val()!==t)return $(window).trigger("xwing:gameTypeChanged",t)},t.prototype.loadFromSerialized=function(t){var e,i,c,u,n,a,h,s,l,o,r,p,f,d,m;if(this.suppress_automatic_new_ship=!0,this.removeAllShips(),null!=(t=(0<=__indexOf.call(t,"Z")?/^v(\d+)Z(.*)/:/^v(\d+)!(.*)/).exec(t))){if(h=7<(l=parseInt(t[1]))?"Y":";",i=(t=7<l?(e=(d=t[2].split("Z"))[0],n=d[1],d=d[2],[e,parseInt(n),d]):(i=(t=t[2].split("!"))[0],d=t[1],n=parseInt(i.split("=")[1])?parseInt(i.split("=")[1]):20,[e=i.split("=")[0],n,d]))[0],e=t[1],n=t[2],l<9)return this.old_version_container.toggleClass("d-none",!1),this.suppress_automatic_new_ship=!1,void this.addShip();if(null==n)return this.loading_failed_container.toggleClass("d-none",!1),this.suppress_automatic_new_ship=!1,void this.addShip();switch(i){case"s":this.changeGameTypeOnSquadLoad("extended");break;case"h":this.changeGameTypeOnSquadLoad("standard");break;case"e":this.changeGameTypeOnSquadLoad("epic");break;case"q":this.changeGameTypeOnSquadLoad("quickbuild")}if(this.desired_points_input.val(e),this.desired_points_input.change(),s=[],null!=n.length){for(o=0,p=(m=n.split(h)).length;o<p;o++)""!==(u=m[o])&&((c=this.addShip()).fromSerialized(l,u)&&c.pilot||s.push([c,u]));for(r=0,f=s.length;r<f;r++)(a=s[r])[0].pilot||(a[0]=this.addShip()),a[0].fromSerialized(l,a[1])}}return this.suppress_automatic_new_ship=!1,this.addShip()},t.prototype.select_xws_view=function(){if(this.select_xws_view_button.blur(),"xws"!==this.list_display_mode)return this.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),this.select_xws_view_button.addClass("btn-inverse"),this.list_display_mode="xws",this.xws_container.show(),this.simple_container.hide(),this.simplecopy_container.hide(),this.reddit_container.hide(),this.fancy_container.hide(),this.tts_container.hide(),this.xws_textarea.select(),this.xws_textarea.focus(),this.toggle_vertical_space_container.hide(),this.toggle_color_print_container.hide(),this.toggle_color_skip_text.hide(),this.toggle_maneuver_dial_container.hide(),this.toggle_expanded_shield_hull_container.hide(),this.toggle_qrcode_container.hide(),this.toggle_obstacle_container.hide(),this.btn_print_list.disabled=!0},t.prototype.uniqueIndex=function(t,e){if(!(e in this.uniques_in_use))throw new Error("Invalid unique type '"+e+"'");return this.uniques_in_use[e].indexOf(t)},t.prototype.claimUnique=function(t,e,c){var i,n,a,s,l,o,r,d;if(!(this.uniqueIndex(t,e)<0))throw new Error("Unique "+e+" '"+t.name+"' already claimed");for(l=0,o=(r=exportObj.pilotsByUniqueName[t.canonical_name.getXWSBaseName()]||[]).length;l<o;l++)if(t!==(a=r[l])){if(!(this.uniqueIndex(a,"Pilot")<0))throw new Error("Unique "+e+" '"+t.name+"' already claimed as pilot");this.uniques_in_use.Pilot.push(a)}for(s in d=exportObj.upgradesBySlotUniqueName)for(n in i=d[s])a=i[n],n.getXWSBaseName()===t.canonical_name.getXWSBaseName()&&t!==a&&this.uniqueIndex(a,"Upgrade")<0&&this.uniques_in_use.Upgrade.push(a);return null!=t.solitary&&this.uniques_in_use.Slot.push(t.slot),this.uniques_in_use[e].push(t),c()},t.prototype.releaseUnique=function(t,e,i){var n,a,s,l,o,r,d;if(!(0<=this.uniqueIndex(t,e)))throw new Error("Unique "+e+" '"+t.name+"' not in use");for(e in d=this.uniques_in_use)if(a=d[e],"Slot"===e){if(null!=t.solitary)for(this.uniques_in_use[e]=[],s=0,o=a.length;s<o;s++)(n=a[s])!==t.slot&&this.uniques_in_use[e].push(n.slot)}else for(this.uniques_in_use[e]=[],l=0,r=a.length;l<r;l++)(n=a[l]).canonical_name.getXWSBaseName()!==t.canonical_name.getXWSBaseName()&&this.uniques_in_use[e].push(n);return i()},t.prototype.addShip=function(){var t=new Ship({builder:this,container:this.ship_container});return this.ships.push(t),this.ship_number_invalid_container.toggleClass("d-none",this.ships.length<10&&3<this.ships.length),this.multi_faction_warning_container.toggleClass("d-none","All"!==this.faction),t},t.prototype.removeShip=function(t,e){__iced_k_noop;var i,n,a=iced.findDeferral(arguments),s=(null==e&&(e=$.noop),n=this,function(){return e()});null!=(null!=t?t.destroy:void 0)?(i=new iced.Deferrals(function(){var t=function(){n.current_squad.dirty=true;n.container.trigger("xwing-backend:squadDirtinessChanged");n.ship_number_invalid_container.toggleClass("d-none",n.ships.length<10&&n.ships.length>3);return s(n.multi_faction_warning_container.toggleClass("d-none",n.faction!=="All"))};i=new iced.Deferrals(t,{parent:a,funcname:"SquadBuilder.removeShip"}),n.container.trigger("xwing:pointsUpdated",i.defer({lineno:4002})),i._fulfill()},{parent:a,funcname:"SquadBuilder.removeShip"}),t.destroy(i.defer({lineno:4001})),i._fulfill()):s()},t.prototype.matcher=function(t,e){return 0<=t.toUpperCase().indexOf(e.toUpperCase())},t.prototype.isOurFaction=function(t,e){var i,n,a,s;if(null==e&&(e=""),i=this.faction,"All"===this.faction){if(""===e)return!0;i=e}if(t instanceof Array){for(a=0,s=t.length;a<s;a++)if(n=t[a],getPrimaryFaction(n)===i)return!0;return!1}return getPrimaryFaction(t)===i},t.prototype.isItemAvailable=function(t,e){return null==e&&(e=!1),!!this.isQuickbuild||(this.isStandard?exportObj.standardCheck(t,this.faction,e):!!this.isEpic||exportObj.epicExclusions(t))},t.prototype.getAvailableShipsMatching=function(t,e,i){var n,a,s,l;for(a in null==t&&(t=""),null==e&&(e=!0),null==i&&(i=!1),s=[],l=exportObj.ships)n=l[a],this.isOurFaction(n.factions)&&(this.matcher(n.name,t)||n.display_name&&this.matcher(n.display_name,t))&&this.isItemAvailable(n,!0)&&(!i||null!=this.collection&&"true"===this.collection.checks.collectioncheck&&this.collection.checkShelf("ship",n.name))&&s.push({id:n.name,text:n.display_name||n.name,name:n.name,display_name:n.display_name,canonical_name:n.canonical_name,xws:n.xws,icon:n.icon||n.xws});return e&&s.sort(exportObj.sortHelper),s},t.prototype.getAvailableShipsMatchingAndCheapEnough=function(t,e,i,n){for(var a,s,l,o=[],r=0,d=(s=this.getAvailableShipsMatching(e=null==e?"":e,i=null==i?!1:i,n=null==n?!1:n)).length;r<d;r++)l=s[r],(a=this.getAvailablePilotsForShipIncluding(l.name,null,"",!0)).length&&a[0].points<=t&&o.push(l);return o},t.prototype.getAvailablePilotsForShipIncluding=function(s,e,i,u,l){var o,h,p,f,m,t,_,a,b,r,g,n,d,v,c,x,k,y,w,q,O,S,$,T,j;if(null==i&&(i=""),null==u&&(u=!0),null==l&&(l=null),n=[],this.isQuickbuild){if(g=function(){var t=exportObj.quickbuildsById,e=[];for(f in t)r=t[f],(null==s||r.ship===s)&&this.isOurFaction(r.faction)&&(this.matcher(r.pilot,i)||null!=exportObj.pilots[r.pilot].display_name&&this.matcher(exportObj.pilots[r.pilot].display_name,i))&&e.push(r);return e}.call(this),d=[],null!=e&&-1!==e){if(m=exportObj.quickbuildsById[e],null!=($=exportObj.pilots[m.pilot]).unique)for(d.push($),x=0,w=(S=exportObj.pilotsByUniqueName[$.canonical_name.getXWSBaseName()]||[]).length;x<w;x++)null!=(_=S[x])&&d.push(_);for(k=0,q=(T=null!=($=m.upgrades)?$:[]).length;k<q;k++){if(t=T[k],null!=(t=exportObj.upgrades[t]).unique)for(d.push(_),y=0,O=(j=exportObj.pilotsByUniqueName[t.canonical_name.getXWSBaseName()]||[]).length;y<O;y++)null!=(_=j[y])&&d.push(_);null!=t.solitary&&d.push(t.slot)}}o=[],function(){var t,e=[];for(f in g)r=g[f],!(null!=(null!=(t=exportObj.pilots[r.pilot])?t.unique:void 0)&&(t=exportObj.pilots[r.pilot],0<=__indexOf.call(this.uniques_in_use.Pilot,t))&&(t=exportObj.pilots[r.pilot],!(0<=__indexOf.call(d,t)))||null!=(null!=(t=exportObj.pilots[r.pilot])?t.max_per_squad:void 0)&&this.countPilots(exportObj.pilots[r.pilot].canonical_name)>=exportObj.pilots[r.pilot].max_per_squad&&(t=exportObj.pilots[r.pilot],!(0<=__indexOf.call(d,t))))?null!=r.upgrades?e.push(function(){for(var t,e,i=r.upgrades,n=[],a=0,s=i.length;a<s;a++)if(v=i[a],null!=(c=exportObj.upgrades[v])){if(null!=c.unique&&0<=__indexOf.call(this.uniques_in_use.Upgrade,c)&&!(0<=__indexOf.call(d,c))&&(null===l||!(0<=__indexOf.call(exportObj.quickbuildsById[l.quickbuildId].upgrades,v)||l.linkedShip&&0<=__indexOf.call(null!=(t=exportObj.quickbuildsById[null!=(t=l.linkedShip)?t.quickbuildId:void 0].upgrades)?t:[],v)))){o.push(r.id);break}if(null!=c.solitary&&(t=c.slot,0<=__indexOf.call(this.uniques_in_use.Slot,t))&&(e=c.slot,!(0<=__indexOf.call(d,e)))){o.push(r.id);break}n.push(void 0)}else console.log("There was an Issue including the upgrade "+v+" in some quickbuild. Please report that Issue!");return n}.call(this)):e.push(void 0):o.push(r.id);return e}.call(this),n=function(){for(var t,e=[],i=0,n=g.length;i<n;i++)r=g[i],e.push({id:r.id,text:(null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?exportObj.pilots[r.pilot].skill+" - ":"")+(exportObj.pilots[r.pilot].display_name||r.pilot)+r.suffix+" ("+r.threat+")",points:r.threat,ship:r.ship,disabled:(t=r.id,0<=__indexOf.call(o,t))});return e}()}else h=function(){var t=exportObj.pilots,e=[];for(b in t)a=t[b],(null==s||a.ship===s)&&this.isOurFaction(a.faction)&&(this.matcher(b,i)||a.display_name&&this.matcher(a.display_name,i))&&this.isItemAvailable(a,!0)&&e.push(a);return e}.call(this),p=function(){var t=[];for(b in h)(null==(a=h[b]).unique||__indexOf.call(this.uniques_in_use.Pilot,a)<0||a.canonical_name.getXWSBaseName()===(null!=e?e.canonical_name.getXWSBaseName():void 0))&&(null==a.max_per_squad||this.countPilots(a.canonical_name)<a.max_per_squad||a.canonical_name.getXWSBaseName()===(null!=e?e.canonical_name.getXWSBaseName():void 0))&&(null==a.restriction_func||a.restriction_func({builder:this},a))&&t.push(a);return t}.call(this),null!=e&&null!=e.unique&&(this.matcher(e.name,i)||e.display_name&&this.matcher(e.display_name,i))&&p.push(e),n=function(){for(var t,e=[],i=0,n=h.length;i<n;i++)a=h[i],e.push({id:a.id,text:(null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?a.skill+" - ":"")+(a.display_name||a.name)+" ("+a.points+"/"+a.pointsupg+")",points:a.points,ship:a.ship,name:a.name,display_name:a.display_name,disabled:__indexOf.call(p,a)<0});return e}();return n=u?n.sort(exportObj.sortHelper):n},t.prototype.countUpgrades=function(t){for(var e,i,n,a,s,l=0,o=this.ships,r=0,d=o.length;r<d;r++)for(i=0,n=(a=o[r].upgrades).length;i<n;i++)(null!=(e=a[i])&&null!=(s=e.data)?s.canonical_name:void 0)===t&&l++;return l},t.prototype.countPilots=function(t){for(var e,i,n=0,a=this.ships,s=0,l=a.length;s<l;s++)(null!=(e=a[s])&&null!=(i=e.pilot)?i.canonical_name.getXWSBaseName():void 0)===t.getXWSBaseName()&&n++;return n},t.prototype.isShip=function(t,e){var i,n;if(t instanceof Array){for(i=0,n=t.length;i<n;i++)if(t[i]===e)return!0;return!1}return t===e},t.prototype.getAvailableUpgradesIncluding=function(u,i,a,n,s,l,e){var o,r,h,p,t,d,c,f,m,_,b,g,v,x;for(null==s&&(s=""),null==l&&(l=this.dfl_filter_func),null==e&&(e=!0),f=function(){for(var t=a.upgrades,e=[],i=0,n=t.length;i<n;i++)d=t[i],e.push(d.data);return e}(),o=function(){var t=exportObj.upgrades,e=[];for(c in t)d=t[c],exportObj.slotsMatching(d.slot,u)&&(this.matcher(c,s)||d.display_name&&this.matcher(d.display_name,s))&&(null==d.ship||this.isShip(d.ship,a.data.name))&&(null==d.faction||this.isOurFaction(d.faction,a.pilot.faction))&&this.isItemAvailable(d)&&e.push(d);return e}.call(this),l!==this.dfl_filter_func&&(o=function(){for(var t=[],e=0,i=o.length;e<i;e++)d=o[e],l(d)&&t.push(d);return t}()),p=a.upgrade_points_total-n.getPoints(i),r=function(){var t,e=[];for(c in o)(null==(d=o[c]).unique||__indexOf.call(this.uniques_in_use.Upgrade,d)<0)&&a.restriction_check(d.restrictions||void 0,n,n.getPoints(d),p)&&__indexOf.call(f,d)<0&&(null==d.max_per_squad||a.builder.countUpgrades(d.canonical_name)<d.max_per_squad)&&(null==d.solitary||(t=d.slot,__indexOf.call(this.uniques_in_use.Slot,t)<0||null!=(null!=i?i.solitary:void 0)))&&e.push(d);return e}.call(this),m=0,b=(v=function(){for(var t=a.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(null!=(d=t[i])?d.data:void 0)&&e.push(d.data);return e}()).length;m<b;m++)h=v[m],r.removeItem(h);if(null!=i&&(this.matcher(i.name,s)||i.display_name&&this.matcher(i.display_name,s))&&r.push(i),t=function(){for(var t=[],e=0,i=o.length;e<i;e++)d=o[e],t.push({id:d.id,text:(d.display_name||d.name)+" ("+n.getPoints(d)+(d.variablepoints?"*":"")+")",points:n.getPoints(d),name:d.name,display_name:d.display_name,disabled:__indexOf.call(r,d)<0});return t}(),e&&(t=t.sort(exportObj.sortHelper)),"function"==typeof n&&n("undefined"!=typeof adjustment_func&&null!==adjustment_func)){for(x=[],_=0,g=t.length;_<g;_++)d=t[_],x.push(n.adjustment_func(d));return x}return t},t.prototype.getSquadDialsAsHTML=function(){for(var t,e,i,n,a="",s={},l=this.ships,o=0,r=l.length;o<r;o++)null!=(i=l[o]).pilot&&(e=i.data.maneuvers,t=i.effectiveStats().maneuvers,null!=s[i.data.name]&&(n=t.toString(),0<=__indexOf.call(s[i.data.name],n))||(s[i.data.name]=(null!=(n=s[i.data.name])?n:[]).concat([t.toString()]),a+='<div class="fancy-dial"><h4 class="ship-name-dial">'+(null!=i.data.display_name?i.data.display_name:i.data.name)+(t.toString()!==e.toString()?" ("+this.uitranslation(modified)+")":"")+"</h4>"+this.getManeuverTableHTML(t,e)+"</div>"));return'<div class="print-dials-container">\n    '+a+"\n</div>"},t.prototype.getManeuverTableHTML=function(i,c){var u,h,p,t,f,m,e,n,_,a,s,b,l,o,r,d,g,v,x,k,y,w,q,O,S,T,j,C;if(null==i||0===i.length)return this.uitranslation("Missing maneuver info.");for(p=function(){C=[];for(var t=0,e=i[0].length;0<=e?t<e:e<t;0<=e?t++:t--)C.push(t);return C}.apply(this),g=0,k=i.length;g<k;g++)for(u=v=0,y=(h=i[g]).length;v<y;u=++v)0<h[u]&&p.removeItem(u);for(s="<table><tbody>",l=x=S=i.length-1;S<=0?x<=0:0<=x;l=S<=0?++x:--x){for(m=!1,q=0,w=(T=i[l]).length;q<w;q++)if(0<T[q]){m=!0;break}if(m){for(s+="<tr><td>"+l+"</td>",d=O=0,j=i[l].length;0<=j?O<j:j<O;d=0<=j?++O:--O)if(!(0<=__indexOf.call(p,d))){if(s+="<td>",0<i[l][d]){if(f=function(){switch(i[l][d]){case 1:return"dodgerblue";case 2:return"white";case 3:return"red";case 4:return"purple"}}(),_=function(){switch(i[l][d]){case 1:return"svg-blue-maneuver";case 2:return"svg-white-maneuver";case 3:return"svg-red-maneuver";case 4:return"svg-purple-maneuver"}}(),s+='<svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 200 200">',b="black",a="svg-base-maneuver",i[l][d]!==c[l][d]&&(b="DarkSlateGrey",a="svg-modified-maneuver"),0===l&&2===d)s+='<rect class="svg-maneuver-stop '+_+" "+a+'" x="50" y="50" width="100" height="100" style="fill:'+f+"; stroke-width:5; stroke:"+b+'" />';else{switch(t=o="",d){case 0:n="M160,180 L160,70 80,70",e="M160,175 L160,70 70,70",r="M80,100 V40 L30,70 Z";break;case 1:n="M150,180 S150,120 80,60",e="M150,175 S150,120 80,60",r="M80,100 V40 L30,70 Z",o="transform='translate(-5 -15) rotate(45 70 90)' ";break;case 2:n="M100,180 L100,100 100,80",e="M100,175 L100,120 100,70",r="M70,80 H130 L100,30 Z";break;case 3:n="M50,180 S50,120 120,60",e="M50,175 S50,120 120,60",r="M120,100 V40 L170,70 Z",o="transform='translate(5 -15) rotate(-45 130 90)' ";break;case 4:n="M40,180 L40,70 120,70",e="M40,175 L40,70 130,70",r="M120,100 V40 L170,70 Z";break;case 5:n="M50,180 L50,100 C50,10 140,10 140,100 L140,120",e="M50,175 L50,100 C50,10 140,10 140,100 L140,130",r="M170,120 H110 L140,180 Z";break;case 6:n="M150,180 S150,120 80,60",e="M150,175 S150,120 85,65",r="M80,100 V40 L30,70 Z",o="transform='translate(0 50)'";break;case 7:n="M50,180 S50,120 120,60",e="M50,175 S50,120 115,65",r="M120,100 V40 L170,70 Z",o="transform='translate(0 50)'";break;case 8:n="M160,180 L160,70 80,70",e="M160,175 L160,70 85,70",r="M60,100 H100 L80,140 Z";break;case 9:n="M40,180 L40,70 120,70",e="M40,175 L40,70 115,70",r="M100,100 H140 L120,140 Z";break;case 10:n="M50,180 S50,120 120,60",e="M50,175 S50,120 120,60",r="M120,100 V40 L170,70 Z",o="transform='translate(5 -15) rotate(-45 130 90)' ",t="backwards";break;case 11:n="M100,180 L100,100 100,80",e="M100,175 L100,100 100,70",r="M70,80 H130 L100,30 Z",t="backwards";break;case 12:n="M150,180 S150,120 80,60",e="M150,175 S150,120 80,60",r="M80,100 V40 L30,70 Z",o="transform='translate(-5 -15) rotate(45 70 90)' ",t="backwards"}s+=$.trim('<g class="maneuver '+t+"\">\n  <path class = 'svg-maneuver-outer "+_+" "+a+"' stroke-width='25' fill='none' stroke='"+b+"' d='"+n+"' />\n  <path class = 'svg-maneuver-triangle "+_+" "+a+"' d='"+r+"' fill='"+f+"' stroke-width='5' stroke='"+b+"' "+o+"/>\n  <path class = 'svg-maneuver-inner "+_+" "+a+"' stroke-width='15' fill='none' stroke='"+f+"' d='"+e+"' />\n</g>")}s+="</svg>"}s+="</td>"}s+="</tr>"}}return s+="</tbody></table>"},t.prototype.formatActions=function(t,e,i){var n,a,s,l,o,r;for(null==i&&(i=[]),a=[],o=0,r=t.length;o<r;o++)n=t[o],s="",l=e,-1!==(n=0<=__indexOf.call(i,"Droid")?n.replace("Focus","Calculate"):n).search("> ")&&(n=n.replace(/> /gi,""),l=' <i class="xwing-miniatures-font xwing-miniatures-font-linked"></i> '),-1!==n.search("F-")&&(s="force ",n=n.replace(/F-/gi,"")),-1!==n.search("W-")?(l="White ",n=n.replace(/W-/gi,"")):-1!==n.search("R-")&&(s="red ",n=n.replace(/R-/gi,"")),n=n.toLowerCase().replace(/[^0-9a-z]/gi,""),a.push(l+'<i class="xwing-miniatures-font '+s+"xwing-miniatures-font-"+n+'"></i>');return a.join("").replace(e,"")},t.prototype.showTooltip=function(c,s,u,t,h){var p,f,e,i,m,_,b,g,v,x,k,y,w,q,O,S,T,n,a,l,j,C,I,L,A,P,U,E,D,M,B,N,z,R,F,W,G,X,o,H,r,d,Q,V;if(null==t&&(t=this.info_container),null==h&&(h=!1),s!==this.tooltip_currently_displaying||h){switch(c){case"Ship":for(l in S=[],O=[],T=[],j={},exportObj.upgradesBySlotCanonicalName)j[l]=-1;for(y in R=exportObj.pilots)if((w=R[y]).ship===s.name&&this.isOurFaction(w.faction))for(l in F=w.skill,0<=__indexOf.call(S,F)||S.push(w.skill),O.push(w.points),T.push(w.pointsupg),j)switch(I=j[l],w.slots.filter(function(t){return t===l}).length){case 1:switch(I){case-1:j[l]=1;break;case 0:j[l]=2;break;case 3:j[l]=4}break;case 0:switch(I){case-1:j[l]=0;break;case 1:j[l]=2;break;case 3:case 4:j[l]=5}break;case 2:switch(I){case-1:j[l]=3;break;case 0:case 2:j[l]=5;break;case 1:j[l]=4}break;case 3:j[l]=6}for(S.sort(),t.find(".info-type").text(c),t.find(".info-name").html(""+(s.display_name||s.name)+(exportObj.isReleased(s)?"":" ("+this.uitranslation("unreleased")+")")),null!=(null!=(r=this.collection)?r.counts:void 0)?(o=null!=(r=null!=(r=this.collection.counts)&&null!=(o=r.ship)?o[s.name]:void 0)?r:0,t.find(".info-collection").text(this.uitranslation("collectionContentShips",o)),t.find(".info-collection").show()):t.find(".info-collection").hide(),_=!0,v=String(S[0]),P=0,E=S.length;P<E;P++)g=S[P],_||(v+=", "+g),_=!1;for(t.find("tr.info-skill td.info-data").text(v),t.find("tr.info-skill").show(),r=Math.min.apply(Math,O)+" - "+Math.max.apply(Math,O),t.find("tr.info-points td.info-data").text(r),r=Math.min.apply(Math,T)+" - "+Math.max.apply(Math,T),t.find("tr.info-loadout td.info-data").text(r),this.isQuickbuild?(t.find("tr.info-points").hide(),t.find("tr.info-loadout").hide()):(t.find("tr.info-points").show(),t.find("tr.info-loadout").show()),t.find("tr.info-engagement").hide(),t.find("tr.info-attack td.info-data").text(s.attack),t.find("tr.info-attack-bullseye td.info-data").text(s.attackbull),t.find("tr.info-attack-fullfront td.info-data").text(s.attackf),t.find("tr.info-attack-left td.info-data").text(s.attackl),t.find("tr.info-attack-right td.info-data").text(s.attackr),t.find("tr.info-attack-back td.info-data").text(s.attackb),t.find("tr.info-attack-turret td.info-data").text(s.attackt),t.find("tr.info-attack-doubleturret td.info-data").text(s.attackdt),t.find("tr.info-attack").toggle(null!=s.attack),t.find("tr.info-attack-bullseye").toggle(null!=s.attackbull),t.find("tr.info-attack-fullfront").toggle(null!=s.attackf),t.find("tr.info-attack-left").toggle(null!=s.attackl),t.find("tr.info-attack-right").toggle(null!=s.attackr),t.find("tr.info-attack-back").toggle(null!=s.attackb),t.find("tr.info-attack-turret").toggle(null!=s.attackt),t.find("tr.info-attack-doubleturret").toggle(null!=s.attackdt),t.find("tr.info-ship").hide(),null!=s.base?t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",s.base)):t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),t.find("tr.info-base").show(),t.find("tr.info-faction td.info-data").text([function(){for(var t=s.factions,e=[],i=0,n=t.length;i<n;i++)m=t[i],e.push(exportObj.translate("faction",m));return e}()]),t.find("tr.info-faction").hide(),t.find("p.info-restrictions").hide(),U=0,D=(G=t.find("tr.info-attack td.info-header i.xwing-miniatures-font")[0].classList).length;U<D;U++)(f=G[U]).startsWith("xwing-miniatures-font-attack")&&t.find("tr.info-attack td.info-header i.xwing-miniatures-font").removeClass(f);if(t.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(r=s.attack_icon)?r:"xwing-miniatures-font-attack"),t.find("tr.info-range").hide(),t.find("tr.info-agility td.info-data").text(s.agility),t.find("tr.info-agility").show(),t.find("tr.info-hull td.info-data").text(s.hull),t.find("tr.info-hull").show(),n="",null!=s.shieldrecurr)for(e=0;e<s.shieldrecurr;)n+='<sup><i class="fas fa-caret-up"></i></sup>',++e;if(t.find("tr.info-shields td.info-data").html(s.shields+n),t.find("tr.info-shields").show(),n="",null!=s.energyrecurr)for(e=0;e<s.energyrecurr;)n+='<sup><i class="fas fa-caret-up"></i></sup>',++e;t.find("tr.info-energy td.info-data").html(s.energy+n),t.find("tr.info-energy").toggle(null!=s.energy),t.find("tr.info-force").hide(),t.find("tr.info-charge").hide(),t.find("tr.info-actions td.info-data").html(this.formatActions(s.actions,", ",null!=(r=s.keyword)?r:[])),t.find("tr.info-actions").show(),t.find("tr.info-upgrades").show(),t.find("tr.info-upgrades td.info-data").html(function(){var t=[];for(l in j)I=j[l],t.push(1===I?exportObj.translate("sloticon",l):2===I?"("+exportObj.translate("sloticon",l)+")":3===I?exportObj.translate("sloticon",l)+exportObj.translate("sloticon",l):4===I?exportObj.translate("sloticon",l)+"("+exportObj.translate("sloticon",l)+")":5===I?"("+exportObj.translate("sloticon",l)+exportObj.translate("sloticon",l)+")":6===I?exportObj.translate("sloticon",l)+exportObj.translate("sloticon",l)+exportObj.translate("sloticon",l):void 0);return t}().join(" ")||"None"),t.find("p.info-text").hide(),t.find("p.info-maneuvers").show(),t.find("p.info-maneuvers").html(this.getManeuverTableHTML(s.maneuvers,s.maneuvers)),r=function(){for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)C=t[i],e.push(exportObj.translate("sources",C));return e}().sort(),t.find(".info-sources.info-data").text(1<r.length||(d=exportObj.translate("sources","Loose Ships"),!(0<=__indexOf.call(r,d)))?0<r.length?r.join(", "):exportObj.translate("ui","unreleased"):this.uitranslation("Only available from 1st edition")),t.find(".info-sources").show();break;case"Pilot":if(t.find(".info-type").text(c),t.find(".info-sources.info-data").text(function(){for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)C=t[i],e.push(exportObj.translate("sources",C));return e}().sort().join(", ")),t.find(".info-sources").show(),null!=(null!=(d=this.collection)?d.counts:void 0)?(r=null!=(d=null!=(r=this.collection.counts)&&null!=(W=r.pilot)?W[s.name]:void 0)?d:0,o=null!=(d=null!=(W=this.collection.counts.ship)?W[s.ship]:void 0)?d:0,t.find(".info-collection").text(this.uitranslation("collectionContentShipsAndPilots",o,r)),t.find(".info-collection").show()):t.find(".info-collection").hide(),null!=(null!=u?u.effectiveStats:void 0)&&(i=u.effectiveStats()),null!=s.unique)L="&middot;&nbsp;";else if(null!=s.max_per_squad){for(e=0,L="";e<s.max_per_squad;)L=L.concat("&middot;"),++e;L=L.concat("&nbsp;")}else L="";if(t.find(".info-name").html(""+L+(s.display_name||s.name)+(exportObj.isReleased(s)?"":" ("+exportObj.translate("ui","unreleased")+")")),""!==(W=this.restriction_text(s)+this.upgrade_effect(s))?(t.find("p.info-restrictions").html(null!=W?W:""),t.find("p.info-restrictions").show()):t.find("p.info-restrictions").hide(),t.find("p.info-text").html(null!=(d=s.text)?d:""),t.find("p.info-text").show(),a=exportObj.ships[s.ship],t.find("tr.info-ship td.info-data").text(s.ship),t.find("tr.info-ship").show(),t.find("tr.info-faction td.info-data").text(exportObj.translate("faction",s.faction)),t.find("tr.info-faction").hide(),null!=a.base?t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",a.base)):t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),t.find("tr.info-base").show(),t.find("tr.info-skill td.info-data").text(s.skill),t.find("tr.info-skill").show(),t.find("tr.info-loadout td.info-data").text(s.pointsupg),t.find("tr.info-loadout").show(),null!=s.engagement?(t.find("tr.info-engagement td.info-data").text(s.engagement),t.find("tr.info-engagement").show()):t.find("tr.info-engagement").hide(),t.find("tr.info-points").hide(),t.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(o=a.attack_icon)?o:"xwing-miniatures-font-attack"),t.find("tr.info-attack td.info-data").text(statAndEffectiveStat(null!=(d=null!=(r=s.ship_override)?r.attack:void 0)?d:a.attack,i,"attack")),t.find("tr.info-attack").toggle(null!=a.attack||null!=(null!=i?i.attack:void 0)),t.find("tr.info-attack-fullfront td.info-data").text(statAndEffectiveStat(null!=(r=null!=(o=s.ship_override)?o.attackf:void 0)?r:a.attackf,i,"attackf")),t.find("tr.info-attack-fullfront").toggle(null!=a.attackf||null!=(null!=i?i.attackf:void 0)),t.find("tr.info-attack-bullseye td.info-data").text(statAndEffectiveStat(null!=(o=null!=(d=s.ship_override)?d.attackbull:void 0)?o:a.attackbull,i,"attackbull")),t.find("tr.info-attack-bullseye").toggle(null!=a.attackbull||null!=(null!=i?i.attackbull:void 0)),t.find("tr.info-attack-left td.info-data").text(statAndEffectiveStat(null!=(d=null!=(r=s.ship_override)?r.attackl:void 0)?d:a.attackl,i,"attackl")),t.find("tr.info-attack-left").toggle(null!=a.attackl||null!=(null!=i?i.attackl:void 0)),t.find("tr.info-attack-right td.info-data").text(statAndEffectiveStat(null!=(r=null!=(o=s.ship_override)?o.attackr:void 0)?r:a.attackr,i,"attackr")),t.find("tr.info-attack-right").toggle(null!=a.attackr||null!=(null!=i?i.attackr:void 0)),t.find("tr.info-attack-back td.info-data").text(statAndEffectiveStat(null!=(o=null!=(d=s.ship_override)?d.attackb:void 0)?o:a.attackb,i,"attackb")),t.find("tr.info-attack-back").toggle(null!=a.attackb||null!=(null!=i?i.attackb:void 0)),t.find("tr.info-attack-turret td.info-data").text(statAndEffectiveStat(null!=(d=null!=(r=s.ship_override)?r.attackt:void 0)?d:a.attackt,i,"attackt")),t.find("tr.info-attack-turret").toggle(null!=a.attackt||null!=(null!=i?i.attackt:void 0)),t.find("tr.info-attack-doubleturret td.info-data").text(statAndEffectiveStat(null!=(r=null!=(o=s.ship_override)?o.attackdt:void 0)?r:a.attackdt,i,"attackdt")),t.find("tr.info-attack-doubleturret").toggle(null!=a.attackdt||null!=(null!=i?i.attackdt:void 0)),t.find("tr.info-range").hide(),t.find("td.info-rangebonus").hide(),t.find("tr.info-agility td.info-data").text(statAndEffectiveStat(null!=(o=null!=(d=s.ship_override)?d.agility:void 0)?o:a.agility,i,"agility")),t.find("tr.info-agility").show(),t.find("tr.info-hull td.info-data").text(statAndEffectiveStat(null!=(d=null!=(r=s.ship_override)?r.hull:void 0)?d:a.hull,i,"hull")),t.find("tr.info-hull").show(),n="",null!=a.shieldrecurr)for(e=0;e<a.shieldrecurr;)n+='<sup><i class="fas fa-caret-up"></i></sup>',++e;if(t.find("tr.info-shields td.info-data").html(statAndEffectiveStat(null!=(r=null!=(o=s.ship_override)?o.shields:void 0)?r:a.shields,i,"shields")+n),t.find("tr.info-shields").show(),n="",null!=a.energyrecurr)for(e=0;e<a.energyrecurr;)n+='<sup><i class="fas fa-caret-up"></i></sup>',++e;if(t.find("tr.info-energy td.info-data").html(statAndEffectiveStat(null!=(o=null!=(d=s.ship_override)?d.energy:void 0)?o:a.energy,i,"energy")+n),t.find("tr.info-energy").toggle(null!=(null!=(r=s.ship_override)?r.energy:void 0)||null!=a.energy),null!=(null!=i?i.force:void 0)&&0<i.force||null!=s.force){if(n="",null!=(null!=i?i.forcerecurring:void 0))for(e=0;e<i.forcerecurring;)n+='<sup><i class="fas fa-caret-up"></i></sup>',++e;else n+='<sup><i class="fas fa-caret-up"></i></sup>';t.find("tr.info-force td.info-data").html(statAndEffectiveStat(null!=(o=null!=(d=s.ship_override)?d.force:void 0)?o:s.force,i,"force")+n),t.find("tr.info-force").show()}else t.find("tr.info-force").hide();if(null!=s.charge){if(n="",null!=s.recurring)if(0<s.recurring)for(e=0;e<s.recurring;)n+='<sup><i class="fas fa-caret-up"></i></sup>',++e;else for(e=s.recurring;e<0;)n+='<sub><i class="fas fa-caret-down"></i></sub>',++e;p=$.trim(""+s.charge+n),t.find("tr.info-charge td.info-data").html(p),t.find("tr.info-charge").show()}else t.find("tr.info-charge").hide();null!=(null!=i?i.actions:void 0)?t.find("tr.info-actions td.info-data").html(this.formatActions(null!=(d=null!=(r=s.ship_override)?r.actions:void 0)?d:i.actions,", ")):t.find("tr.info-actions td.info-data").html(this.formatActions(null!=(r=null!=(o=s.ship_override)?o.actions:void 0)?r:a.actions,", ",null!=(d=s.keyword)?d:[])),t.find("tr.info-actions").show(),this.isQuickbuild?t.find("tr.info-upgrades").hide():(t.find("tr.info-upgrades").show(),t.find("tr.info-upgrades td.info-data").html(function(){for(var t=s.slots,e=[],i=0,n=t.length;i<n;i++)l=t[i],e.push(exportObj.translate("sloticon",l));return e}().join(" ")||"None")),t.find("p.info-maneuvers").show(),t.find("p.info-maneuvers").html(this.getManeuverTableHTML(null!=(o=null!=i?i.maneuvers:void 0)?o:a.maneuvers,a.maneuvers));break;case"Quickbuild":if(t.find(".info-type").text(this.uitranslation("Quickbuild")),t.find(".info-sources").hide(),t.find(".info-collection").hide(),w=exportObj.pilots[s.pilot],a=exportObj.ships[s.ship],null!=w.unique)L="&middot;&nbsp;";else if(null!=w.max_per_squad){for(e=0,L="";e<s.max_per_squad;)L=L.concat("&middot;"),++e;L=L.concat("&nbsp;")}else L="";if(t.find(".info-name").html(""+L+(w.display_name||w.name)+(null!=s.suffix?s.suffix:"")+(exportObj.isReleased(w)?"":" ("+exportObj.translate("ui","unreleased")+")")),""!==(W=this.restriction_text(s)+this.upgrade_effect(s))?(t.find("p.info-restrictions").html(null!=W?W:""),t.find("p.info-restrictions").show()):t.find("p.info-restrictions").hide(),t.find("p.info-text").html(null!=(r=w.text)?r:""),t.find("p.info-text").show(),t.find("tr.info-ship td.info-data").text(s.ship),t.find("tr.info-ship").show(),t.find("tr.info-faction td.info-data").text(exportObj.translate("faction",s.faction)),t.find("tr.info-faction").hide(),null!=a.base?t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",a.base)):t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),t.find("tr.info-base").show(),t.find("tr.info-skill td.info-data").text(w.skill),t.find("tr.info-skill").show(),t.find("tr.info-points").hide(),t.find("tr.info-loadout").hide(),t.find("tr.info-engagement td.info-data").text(w.skill),t.find("tr.info-engagement").show(),t.find("tr.info-attack td.info-data").text(null!=(o=null!=(d=w.ship_override)?d.attack:void 0)?o:a.attack),t.find("tr.info-attack").toggle(null!=(null!=(r=w.ship_override)?r.attack:void 0)||null!=a.attack),t.find("tr.info-attack-fullfront td.info-data").text(a.attackf),t.find("tr.info-attack-fullfront").toggle(null!=a.attackf),t.find("tr.info-attack-bullseye td.info-data").text(a.attackbull),t.find("tr.info-attack-bullseye").toggle(null!=a.attackbull),t.find("tr.info-attack-left td.info-data").text(a.attackl),t.find("tr.info-attack-left").toggle(null!=a.attackl),t.find("tr.info-attack-right td.info-data").text(a.attackr),t.find("tr.info-attack-right").toggle(null!=a.attackr),t.find("tr.info-attack-back td.info-data").text(null!=a.attackb),t.find("tr.info-attack-back").toggle(null!=a.attackb),t.find("tr.info-attack-turret td.info-data").text(null!=a.attackt),t.find("tr.info-attack-turret").toggle(null!=a.attackt),t.find("tr.info-attack-doubleturret td.info-data").text(a.attackdt),t.find("tr.info-attack-doubleturret").toggle(null!=a.attackdt),t.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(d=a.attack_icon)?d:"xwing-miniatures-font-frontarc"),t.find("tr.info-energy td.info-data").text(null!=(r=null!=(o=w.ship_override)?o.energy:void 0)?r:a.energy),t.find("tr.info-energy").toggle(null!=(null!=(d=w.ship_override)?d.energy:void 0)||null!=a.energy),t.find("tr.info-range").hide(),t.find("td.info-rangebonus").hide(),t.find("tr.info-agility td.info-data").text(null!=(r=null!=(o=w.ship_override)?o.agility:void 0)?r:a.agility),t.find("tr.info-agility").show(),t.find("tr.info-hull td.info-data").text(null!=(o=null!=(d=w.ship_override)?d.hull:void 0)?o:a.hull),t.find("tr.info-hull").show(),t.find("tr.info-shields td.info-data").text(null!=(d=null!=(r=w.ship_override)?r.shields:void 0)?d:a.shields),t.find("tr.info-shields").show(),null!=(null!=i?i.force:void 0)||null!=s.force){for(n="",b=1,null!=(null!=i?i.forcerecurring:void 0)&&(b=i.forcerecurring),e=0;e<b;)n+='<sup><i class="fas fa-caret-up"></i></sup>',++e;t.find("tr.info-force td.info-data").html((null!=(r=null!=(o=w.ship_override)?o.force:void 0)?r:w.force)+n),t.find("tr.info-force").show()}else t.find("tr.info-force").hide();if(null!=s.charge){if(n="",null!=s.recurring)if(0<s.recurring)for(e=0;e<s.recurring;)n+='<sup><i class="fas fa-caret-up"></i></sup>',++e;else for(e=s.recurring;e<0;)n+='<sub><i class="fas fa-caret-down"></i></sub>',++e;p=$.trim(""+s.charge+n),t.find("tr.info-charge td.info-data").html(p),t.find("tr.info-charge").show()}else t.find("tr.info-charge").hide();t.find("tr.info-actions td.info-data").html(this.formatActions(null!=(o=null!=(d=w.ship_override)?d.actions:void 0)?o:exportObj.ships[s.ship].actions,", ",null!=(r=w.keyword)?r:[])),t.find("tr.info-actions").show(),t.find("tr.info-upgrades").show(),t.find("tr.info-upgrades td.info-data").html(function(){for(var t,e=null!=(t=s.upgrades)?t:[],i=[],n=0,a=e.length;n<a;n++)A=e[n],i.push(null!=exportObj.upgrades[A].display_name?exportObj.upgrades[A].display_name:A);return i}().join(", ")||"None"),t.find("p.info-maneuvers").show(),t.find("p.info-maneuvers").html(this.getManeuverTableHTML(a.maneuvers,a.maneuvers));break;case"Addon":if(t.find(".info-type").text(u.addon_type),t.find(".info-sources.info-data").text(function(){for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)C=t[i],e.push(exportObj.translate("sources",C));return e}().sort().join(", ")),t.find(".info-sources").show(),null!=s.unique)L="&middot;&nbsp;";else if(null!=s.max_per_squad){for(e=0,L="";e<s.max_per_squad;)L=L.concat("&middot;"),++e;L=L.concat("&nbsp;")}else L="";if(null!=(null!=(d=this.collection)?d.counts:void 0)?(d=null!=(r=null!=(o=this.collection.counts)&&null!=(X=o.upgrade)?X[s.name]:void 0)?r:0,t.find(".info-collection").text(this.uitranslation("collectionContentUpgrades",d)),t.find(".info-collection").show()):t.find(".info-collection").hide(),t.find(".info-name").html(""+L+(s.display_name||s.name)+(exportObj.isReleased(s)?"":" ("+this.uitranslation("unreleased")+")")),null!=s.variablepoints){switch(q="<i>"+this.uitranslation("varPointCostsPoints",s.points),s.variablepoints){case"Agility":q+=this.uitranslation("varPointCostsConditionAgility",function(){Q=[];for(var t=0,e=s.points.length-1;0<=e?t<=e:e<=t;0<=e?t++:t--)Q.push(t);return Q}.apply(this));break;case"Initiative":q+=this.uitranslation("varPointCostsConditionIni",function(){V=[];for(var t=0,e=s.points.length-1;0<=e?t<=e:e<=t;0<=e?t++:t--)V.push(t);return V}.apply(this));break;case"Base":q+=this.uitranslation("varPointCostsConditionBase")}q+="</i>"}if(W=this.restriction_text(s)+this.upgrade_effect(s),null!=q||""!==W?(null!=q&&""!==W&&(q+="<br/>"),t.find("p.info-restrictions").html((null!=q?q:"")+W),t.find("p.info-restrictions").show()):t.find("p.info-restrictions").hide(),t.find("p.info-text").html(null!=(o=s.text)?o:""),t.find("p.info-text").show(),t.find("tr.info-ship").hide(),t.find("tr.info-faction").hide(),t.find("tr.info-base").hide(),t.find("tr.info-skill").hide(),t.find("tr.info-points").hide(),t.find("tr.info-loadout").hide(),t.find("tr.info-engagement").hide(),null!=s.energy?(t.find("tr.info-energy td.info-data").text(s.energy),t.find("tr.info-energy").show()):t.find("tr.info-energy").hide(),null!=s.attack?(t.find("tr.info-attack td.info-data").text(s.attack),t.find("tr.info-attack").show()):t.find("tr.info-attack").hide(),null!=s.attackb?(t.find("tr.info-attack-back td.info-data").text(s.attackb),t.find("tr.info-attack-back").show()):t.find("tr.info-attack-back").hide(),null!=s.attackt?(t.find("tr.info-attack-turret td.info-data").text(s.attackt),t.find("tr.info-attack-turret").show()):t.find("tr.info-attack-turret").hide(),null!=s.attackr?(t.find("tr.info-attack-right td.info-data").text(s.attackr),t.find("tr.info-attack-right").show()):t.find("tr.info-attack-right").hide(),null!=s.attackl?(t.find("tr.info-attack-left td.info-data").text(s.attackl),t.find("tr.info-attack-left").show()):t.find("tr.info-attack-left").hide(),null!=s.attackdt?(t.find("tr.info-attack-doubleturret td.info-data").text(s.attackdt),t.find("tr.info-attack-doubleturret").show()):t.find("tr.info-attack-doubleturret").hide(),null!=s.attackbull?(t.find("tr.info-attack-bullseye td.info-data").text(s.attackbull),t.find("tr.info-attack-bullseye").show()):t.find("tr.info-attack-bullseye").hide(),null!=s.attackf?(t.find("tr.info-attack-fullfront td.info-data").text(s.attackf),t.find("tr.info-attack-fullfront").show()):t.find("tr.info-attack-fullfront").hide(),null!=s.charge){if(n="",null!=s.recurring)if(0<s.recurring)for(e=0;e<s.recurring;)n+='<sup><i class="fas fa-caret-up"></i></sup>',++e;else for(e=s.recurring;e<0;)n+='<sub><i class="fas fa-caret-down"></i></sub>',++e;p=$.trim(""+s.charge+n),t.find("tr.info-charge td.info-data").html(p)}if(t.find("tr.info-charge").toggle(null!=s.charge),null!=s.range?(t.find("tr.info-range td.info-data").text(s.range),t.find("tr.info-range").show()):t.find("tr.info-range").hide(),null!=s.rangebonus?t.find("td.info-rangebonus").show():t.find("td.info-rangebonus").hide(),null!=s.force){for(n="",b=1,null!=s.forcerecurring&&(b=s.forcerecurring),e=0;e<b;)n+='<sup><i class="fas fa-caret-up"></i></sup>',++e;t.find("tr.info-force td.info-data").html(s.force+n)}t.find("tr.info-force").toggle(null!=s.force),t.find("tr.info-agility").hide(),t.find("tr.info-hull").hide(),t.find("tr.info-shields").hide(),t.find("tr.info-actions").hide(),t.find("tr.info-upgrades").hide(),t.find("p.info-maneuvers").hide();break;case"Rules":t.find(".info-type").hide(),t.find(".info-sources").hide(),t.find(".info-collection").hide(),t.find(".info-name").html(s.name),t.find(".info-name").show(),t.find("p.info-restrictions").hide(),t.find("p.info-text").html(s.text),t.find("p.info-text").show(),t.find("tr.info-ship").hide(),t.find("tr.info-faction").hide(),t.find("tr.info-base").hide(),t.find("tr.info-skill").hide(),t.find("tr.info-points").hide(),t.find("tr.info-loadout").hide(),t.find("tr.info-agility").hide(),t.find("tr.info-hull").hide(),t.find("tr.info-shields").hide(),t.find("tr.info-actions").hide(),t.find("tr.info-upgrades").hide(),t.find("p.info-maneuvers").hide(),t.find("tr.info-energy").hide(),t.find("tr.info-attack").hide(),t.find("tr.info-attack-turret").hide(),t.find("tr.info-attack-bullseye").hide(),t.find("tr.info-attack-fullfront").hide(),t.find("tr.info-attack-back").hide(),t.find("tr.info-attack-doubleturret").hide(),t.find("tr.info-charge").hide(),t.find("td.info-rangebonus").hide(),t.find("tr.info-range").hide(),t.find("tr.info-force").hide();break;case"MissingStuff":for(t.find(".info-type").text(this.uitranslation("List of Missing items")),t.find(".info-sources").hide(),t.find(".info-collection").hide(),t.find(".info-name").html(this.uitranslation("Missing items")),t.find(".info-name").show(),k=this.uitranslation("Missing Item List:")+"<ul>",N=0,M=s.length;N<M;N++){for(k+="<li><strong>"+(null!=(x=s[N]).display_name?x.display_name:x.name)+"</strong> (",_=!0,z=0,B=(H=x.sources).length;z<B;z++)_||(k+=", "),k+=C=H[z],_=!1;k+=")</li>"}k+="</ul>",t.find("p.info-restrictions").hide(),t.find("p.info-text").html(k),t.find("p.info-text").show(),t.find("tr.info-ship").hide(),t.find("tr.info-faction").hide(),t.find("tr.info-base").hide(),t.find("tr.info-skill").hide(),t.find("tr.info-points").hide(),t.find("tr.info-loadout").hide(),t.find("tr.info-agility").hide(),t.find("tr.info-hull").hide(),t.find("tr.info-shields").hide(),t.find("tr.info-actions").hide(),t.find("tr.info-upgrades").hide(),t.find("p.info-maneuvers").hide(),t.find("tr.info-energy").hide(),t.find("tr.info-attack").hide(),t.find("tr.info-attack-turret").hide(),t.find("tr.info-attack-bullseye").hide(),t.find("tr.info-attack-fullfront").hide(),t.find("tr.info-attack-back").hide(),t.find("tr.info-attack-doubleturret").hide(),t.find("tr.info-charge").hide(),t.find("td.info-rangebonus").hide(),t.find("tr.info-range").hide(),t.find("tr.info-force").hide()}if(t!==this.mobile_tooltip_modal&&(t.find(".info-well").show(),t.find(".intro").hide()),this.tooltip_currently_displaying=s,768<=$(window).width())return h=t.find(".info-well"),$.isElementInView(h,!0)?h.css("position","fixed"):h.css("position","static")}},t.prototype._randomizerLoopBody=function(a){var s,t,c,l,e,i,o,n,r,d,u,h,p,f,m,_,b,g,v,x,k,y;if(a.keep_running){if(this.total_points===a.max_points){if(a.keep_running=!1,this.isQuickbuild)return void(a.keep_running=!1);for(n=0,h=(g=this.ships).length;n<h;n++)for(l=g[n],c=[];l.upgrade_points_total<l.pilot.pointsupg;){for(i=[],r=0,p=(v=l.upgrades).length;r<p;r++)null!=(o=v[r]).data||null!=o.occupied_by&&null!==o.occupied_by||0<=__indexOf.call(c,o)||i.push(o);if(0===i.length)break;s=i[$.randomInt(i.length)],0<(t=function(){for(var t=this.getAvailableUpgradesIncluding(s.slot,null,l,s,"",this.dfl_filter_func,!1),e=[],i=0,n=t.length;i<n;i++)o=t[i],!exportObj.upgradesById[o.id].sources.intersects(a.allowed_sources)||a.collection_only&&!this.collection.checkShelf("upgrade",o.name)||o.disabled||e.push(o);return e}.call(this)).length?(o=t[$.randomInt(t.length)],s.setById(o.id)):c.push(s)}}else if(this.total_points<a.max_points){if(0<(e=0===(e=this.getAvailableShipsMatchingAndCheapEnough(a.max_points-this.total_points,"",!1,a.collection_only)).length?this.getAvailableShipsMatching("",!1,a.collection_only):e).length&&(this.ships.length<a.ship_limit||0===a.ship_limit)){if(e=e[$.randomInt(e.length)].name,0===(e=this.getAvailablePilotsForShipIncluding(e)).length)return;(e=e[$.randomInt(e.length)]).disabled||!(this.isQuickbuild?exportObj.pilots[exportObj.quickbuildsById[e.id].pilot]:exportObj.pilotsById[e.id]).sources.intersects(a.allowed_sources)||a.collection_only&&!this.collection.checkShelf("pilot",this.isQuickbuild?exportObj.quickbuildsById[e.id]:e.name)||this.addShip().setPilotById(e.id)}}else this.removeShip(this.ships[$.randomInt(this.ships.length)]);return window.setTimeout(this._makeRandomizerLoopFunc(a),0)}for(;this.total_points>a.max_points;)this.removeShip(this.ships[$.randomInt(this.ships.length)]);if(a.fill_zero_pts)for(d=0,f=(x=this.ships).length;d<f;d++)for(u=0,m=(k=(l=x[d]).upgrades).length;u<m;u++)null!=(s=k[u]).data||null!=s.occupied_by&&null!==s.occupied_by||(o=0<(t=function(){for(var t=this.getAvailableUpgradesIncluding(s.slot,null,s.ship,s,"",this.dfl_filter_func,!1),e=[],i=0,n=t.length;i<n;i++)o=t[i],exportObj.upgradesById[o.id].sources.intersects(a.allowed_sources)&&o.points<1&&(!a.collection_only||this.collection.checkShelf("upgrade",o.name))&&e.push(o);return e}.call(this)).length?t[$.randomInt(t.length)]:void 0)&&!o.disabled&&s.setById(o.id);for(window.clearTimeout(a.timer),b=0,_=(y=this.ships).length;b<_;b++)(l=y[b]).updateSelections();return this.suppress_automatic_new_ship=!1,this.addShip()},t.prototype._makeRandomizerLoopFunc=function(t){return e=this,function(){return e._randomizerLoopBody(t)};var e},t.prototype.randomSquad=function(t,e,i,n,a,s){var l;for(null==t&&(t=200),null==e&&(e=null),null==i&&(i=1e3),null==n&&(n=0),null==a&&(a=!0),null==s&&(s=!1),this.backend_status.fadeOut("slow"),this.suppress_automatic_new_ship=!0,e.length<1&&(e=null);0<this.ships.length;)this.removeShip(this.ships[0]);if(0<this.ships.length)throw new Error("Ships not emptied");return(l={max_points:t,ship_limit:n,keep_running:!0,allowed_sources:null!=e?e:exportObj.expansions,collection_only:null!=this.collection&&"true"===this.collection.checks.collectioncheck&&a,fill_zero_pts:s}).timer=window.setTimeout(function(){return l.keep_running=!1},i),window.setTimeout(this._makeRandomizerLoopFunc(l),0),this.resetCurrentSquad(),this.current_squad.name=this.uitranslation("Random Squad"),this.container.trigger("xwing-backend:squadNameChanged")},t.prototype.setBackend=function(t){var e,i,n,a,s;if(this.backend=t,null!=this.waiting_for_backend){for(s=[],i=0,n=(a=this.waiting_for_backend).length;i<n;i++)e=a[i],s.push(e());return s}},t.prototype.upgrade_effect=function(t){var e,i,n,a,s,l,o,r,c,d=n=e="";if(t.modifier_func&&(t.modifier_func(i={attack:0,attackf:0,attackbull:0,attackb:0,attackt:0,attackl:0,attackr:0,attackdt:0,energy:0,agility:0,hull:0,shields:0,force:0,actions:[],maneuvers:[0,0]}),0!==i.attack&&(n+=e+"%FRONTARC% ("+i.attack+")",e=", "),0!==i.attackf&&(n+=e+"%FULLFRONTARC% ("+i.attackf+")",e=", "),0!==i.attackbull&&(n+=e+"%BULLSEYEARC% ("+i.attackbull+")",e=", "),0!==i.attackb&&(n+=e+"%REARARC% ("+i.attackb+")",e=", "),0!==i.attackt&&(n+=e+"%SINGLETURRETARC% ("+i.attackt+")",e=", "),0!==i.attackl&&(n+=e+"%LEFTARC% ("+i.attackl+")",e=", "),0!==i.attackr&&(n+=e+"%RIGHTARC% ("+i.attackr+")",e=", "),0!==i.attackdt&&(n+=e+"%DOUBLETURRETARC% ("+i.attackdt+")",e=", "),0!==i.energy&&(n+=e+"%ENERGY% ("+i.energy+")",e=", "),0!==i.agility&&(n+=e+"%AGILITY% ("+i.agility+")",e=", "),0!==i.hull&&(n+=e+"%HULL% ("+i.hull+")",e=", "),0!==i.shields&&(n+=e+"%SHIELD% ("+i.shields+")",e=", "),0<i.actions.length&&(n+=e+this.formatActions(i.actions,", "),e=", ")),t.confersAddons)for(a=0,l=(r=t.confersAddons).length;a<l;a++)n+=e+("%"+r[a].slot.toUpperCase().replace(/[^a-z0-9]/gi,""))+"%",e=", ";if(t.unequips_upgrades)for(e="",s=0,o=(c=t.unequips_upgrades).length;s<o;s++)d+=e+("%"+c[s].toUpperCase().replace(/[^a-z0-9]/gi,""))+"%",e=", ";return""!==n?(i={text:"</br><b>"+this.uitranslation("adds",n)+"</b>"},""!==d&&(i.text+="</br><b>"+this.uitranslation("removes",d)+"</b>"),exportObj.fixIcons(i)):""},t.prototype.restriction_text=function(t){var e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_=i=a=l="";if(t.restrictions)for(o=0,c=(p=t.restrictions).length;o<c;o++)if("orUnique"!==(s=p[o])[0]){switch(s[0]){case"Base":l+=i+(s[1]+" ")+exportObj.translate("restrictions","Ship");break;case"Action":e=[s[1]],l+=i+this.formatActions(e,"",[]);break;case"Equipped":l+=i+("%"+s[1].toUpperCase().replace(/[^a-z0-9]/gi,""))+"% Equipped";break;case"Slot":l+=i+exportObj.translate("restrictions","Extra")+(" %"+s[1].toUpperCase().replace(/[^a-z0-9]/gi,""))+"%";break;case"Keyword":l+=i+exportObj.translate("restrictions",""+s[1]);break;case"AttackArc":l+=i+"%REARARC%";break;case"ShieldsGreaterThan":l+=i+("%SHIELD% > "+s[1]);break;case"EnergyGreatterThan":l+=i+("%ENERGY% > "+s[1]);break;case"InitiativeGreaterThan":l+=i+exportObj.translate("restrictions","Initiative")+(" > "+s[1]);break;case"InitiativeLessThan":l+=i+exportObj.translate("restrictions","Initiative")+(" < "+s[1]);break;case"AgilityEquals":l+=i+exportObj.translate("restrictions","Agility")+(" = "+s[1]);break;case"isUnique":!0===s[1]?l+=i+exportObj.translate("restrictions","Limited"):l+=i+exportObj.translate("restrictions","Non-Limited");break;case"Format":l+=i+exportObj.translate("restrictions",s[1]+" Ship");break;case"Faction":a+=i+exportObj.translate("faction",""+s[1])}i=", "}else _=exportObj.translate("restrictions"," or Squad Including")+(" "+s[1]);if(!t.skill){if(""===a&&t.faction){if(t.faction instanceof Array)for(r=0,u=(f=t.faction).length;r<u;r++)n=f[r],a+=i+exportObj.translate("faction",""+n),i=" or ";else a+=i+exportObj.translate("faction",""+t.faction);i=", "}if(t.ship){if(t.ship instanceof Array)for(d=0,h=(m=t.ship).length;d<h;d++)a+=i+m[d],i=" or ";else a+=i+t.ship;i=", "}t.solitary&&(a+=i+exportObj.translate("faction","Solitary"),i=", "),t.standardized&&(a+=i+exportObj.translate("faction","Standardized"),i=", ")}return""!==(l+=a+_)?(t={text:"<i><b>"+exportObj.translate("restrictions","Restrictions")+":</b> "+l+"</i>"},exportObj.fixIcons(t)):""},t.prototype.describeSquad=function(){var a;return""===this.getNotes().trim()?function(){for(var t=this.ships,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).pilot&&e.push(a.pilot.name);return e}.call(this).join(", "):this.getNotes()},t.prototype.listCards=function(){for(var t,e,i,n,a,s={},l=this.ships,o=0,r=l.length;o<r;o++)if(null!=(t=l[o]).pilot)for(s[t.pilot.name]=null,i=0,n=(a=t.upgrades).length;i<n;i++)null!=(e=a[i]).data&&(s[e.data.name]=null);return Object.keys(s).sort()},t.prototype.getNotes=function(){return this.notes.val()},t.prototype.getTag=function(){return this.tag.val()},t.prototype.getObstacles=function(){return this.current_obstacles},t.prototype.isSquadPossibleWithCollection=function(){var t,e,i,n,a,s,l,o,r,c,u,d,h,p;if(0===Object.keys(null!=(d=null!=(d=this.collection)?d.expansions:void 0)?d:{}).length)return[!0,[]];if("true"!==(null!=(d=this.collection)?d.checks.collectioncheck:void 0))return[!0,[]];for(this.collection.reset(),l=!0,t=[],o=0,c=(h=this.ships).length;o<c;o++)if(null!=(i=h[o]).pilot)for(n=this.collection.use("ship",i.pilot.ship),e=this.collection.use("pilot",i.pilot.name),n&&e||(l=!1),n||t.push(i.data),e||t.push(i.pilot),r=0,u=(p=i.upgrades).length;r<u;r++)null!=(a=p[r]).data&&((s=this.collection.use("upgrade",a.data.name))||(l=!1),s||t.push(a.data));return[l,t]},t.prototype.checkCollection=function(){var e,t,i,n;if(null!=this.collection)return t=(i=this.isSquadPossibleWithCollection())[0],e=i[1],this.collection_invalid_container.toggleClass("d-none",t),this.collection_invalid_container.on("mouseover",(n=this,function(t){return n.showTooltip("MissingStuff",e)}))},t.prototype.toXWS=function(){for(var t,c,u,e,i,h,a,p,n,s,l,o,f,m,_,b,g,v,r,x,k,d={description:this.getNotes(),faction:exportObj.toXWSFaction[this.faction],name:this.current_squad.name,pilots:[],points:this.total_points,vendor:{yasb:{builder:"YASB 2.5",builder_url:window.location.href.split("?")[0],link:this.getPermaLink()}},version:"2.5.0"},y=this.ships,w=0,q=y.length;w<q;w++)null!=(p=y[w]).pilot&&d.pilots.push(p.toXWS());for(i={},c=0,n=function(){for(var t=d.pilots,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).multisection&&e.push(a);return e}(),l=0,r=Math.pow(n.length,2);(0<=r?l<r:r<l)&&0!==n.length&&(null==(s=n.shift()).multisection_id&&(s.multisection_id=c++),null==i[v=s.multisection_id]&&(i[v]=[s]),0!==n.length);0<=r?++l:--l){for(e=[],o=0,m=n.length;o<m&&(t=n[o],x=s.name,!(0<=__indexOf.call(t.multisection,x)&&(e.push(t),s.multisection.removeItem(t.name),t.multisection.removeItem(s.name),t.multisection_id=s.multisection_id,i[t.multisection_id].push(t),0===s.multisection.length)));o++);for(f=0,_=e.length;f<_;f++)0===(u=e[f]).multisection.length&&n.removeItem(u)}for(g=0,b=(k=d.pilots).length;g<b;g++)null!=(a=k[g]).multisection&&delete a.multisection;return null!=(h=this.getObstacles())&&0<h.length&&(d.obstacles=h),d},t.prototype.toMinimalXWS=function(){var t,e,i=this.toXWS();for(t in i)__hasProp.call(i,t)&&(i[t],"faction"!==t&&"pilots"!==t&&"version"!==t&&delete i[t]);for(t in e=i.pilots)__hasProp.call(e,t)&&(e[t],"id"!==t&&"upgrades"!==t&&"multisection_id"!==t&&delete i[t]);return i},t.prototype.loadFromXWS=function(a,c){var u,t,e,h,i,n,p,s,f,l,o,m,_,b,g,v,x,k,y,r,w,d,q=null,O=null,S=null!=a.version?function(){for(var t=a.version.split("."),e=[],i=0,n=t.length;i<n;i++)f=t[i],e.push(parseInt(f));return e}():[0,2];if(!1==!([0,1]<S)){if(l=exportObj.fromXWSFaction[a.faction],this.faction!==l)throw new Error("Attempted to load XWS for "+a.faction+" but builder is "+this.faction);for(null!=a.name&&(this.current_squad.name=a.name),null!=a.description&&this.notes.val(a.description),null!=a.obstacles&&(this.current_squad.additional_data.obstacles=a.obstacles),this.suppress_automatic_new_ship=!0,this.removeAllShips(),q=!0,O="",i="v9ZhZ20Z",m=0,g=(k=a.pilots).length;m<g;m++){if(r=k[m],this.addShip(),r.id)t=r.id;else{if(!r.name){q=!1,O="Pilot without identifier";break}t=r.name}if(null!=exportObj.pilotsByFactionXWS[l][t])i+=exportObj.pilotsByFactionXWS[l][t][0].id;else if(exportObj.pilotsByUniqueName[t]&&1===exportObj.pilotsByUniqueName[t].length)i+=exportObj.pilotsByUniqueName[t][0].id;else for(u in y=exportObj.pilotsByUniqueName)for(_=0,v=(h=y[u]).length;_<v;_++)if((e=h[_]).xws&&e.xws===t||!e.xws&&u===t){i+=e.id;break}for(s in i+="X",w=null!=(r=r.upgrades)?r:{})for(b=0,x=(p=w[s]).length;b<x;b++)n=p[b],d=null!=(d=exportObj.fromXWSUpgrade[s])?d:s.capitalize(),null!=n&&(null!=(o=null!=(o=exportObj.upgradesBySlotXWSName[d])[n]?o[n]:o[n]=exportObj.upgradesBySlotCanonicalName[d][n])?i=i+o.id+"W":(console.log("Failed to load xws upgrade: "+n),O+="Skipped upgrade "+n,q=!1));i+="XY"}this.loadFromSerialized(i),this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")}return c({success:q,error:O})},t}(),Ship=function(){function t(t){this.builder=t.builder,this.container=t.container,this.pilot=null,this.data=null,this.quickbuildId=-1,this.linkedShip=null,this.primary=!0,this.upgrades=[],this.upgrade_points_total=0,this.wingmates=[],this.destroystate=0,this.uitranslation=this.builder.uitranslation,this.setupUI()}return t.prototype.destroy=function(t){__iced_k_noop;var e,i,n=iced.findDeferral(arguments);if(this.resetPilot(),this.resetAddons(),this.teardownUI(),(a=this.builder.ships.indexOf(this))<0)throw new Error("Ship not registered with builder");this.builder.ships.splice(a,1),0<this.wingmates.length&&this.setWingmates(0);var a=function(){return t()};null!==(e=this).linkedShip?(a=a,0<(null!=(i=e.linkedShip.wingmates)?i.length:void 0)&&0<=__indexOf.call(e.linkedShip.wingmates,e)?a(e.linkedShip.removeFromWing(e)):(e.linkedShip.linkedShip=null,i=new iced.Deferrals(a,{parent:n,funcname:"Ship.destroy"}),e.builder.removeShip(e.linkedShip,i.defer({lineno:5623})),i._fulfill())):a()},t.prototype.copyFrom=function(a){var t,e,c,u,i,n,s,l,o,r,h,p,f,m,_,b,g,v,d,x,k,y,w,q;if(a===this)throw new Error("Cannot copy from self");if(null!=a.pilot&&null!=a.data){if(this.builder.isQuickbuild){if(!(a.pilot.unique||null!=a.pilot.max_per_squad&&this.builder.countPilots(a.pilot.canonical_name)>=a.pilot.max_per_squad)){for(u=!0,o=0,f=(v=a.upgrades).length;o<f;o++)if(null!=(null!=(d=(l=v[o]).data)?d.unique:void 0)&&l.data.unique||null!=(null!=(d=l.data)?d.max_per_squad:void 0)&&this.builder.countUpgrades(l.data.canonical_name)>=l.data.max_per_squad||null!=(null!=(d=l.data)?d.solitary:void 0)){if(u=!1,0<(t=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(a.data.name),e=[],i=0,n=t.length;i<n;i++)(s=t[i]).disabled||e.push(s);return e}.call(this)).length){this.setPilotById(t[0].id,!0);break}return}u&&this.setPilotById(a.quickbuildId)}}else{if(a.pilot.unique||null!=a.pilot.max_per_squad&&this.builder.countPilots(a.pilot.canonical_name)>=a.pilot.max_per_squad){if(!(0<(t=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(a.data.name),e=[],i=0,n=t.length;i<n;i++)(s=t[i]).disabled||e.push(s);return e}.call(this)).length))return;this.setPilotById(t[0].id,!0)}else this.setPilotById(a.pilot.id,!0);for(n={},r=0,m=(x=a.upgrades).length;r<m;r++)null!=(null!=(l=x[r])?l.data:void 0)&&!l.data.unique&&(null==l.data.max_per_squad||this.builder.countUpgrades(l.data.canonical_name)<l.data.max_per_squad)&&(null==n[g=l.slot]&&(n[g]=[]),n[l.slot].push(l));for(e={},h=0,_=(k=this.upgrades).length;h<_;h++)(l=k[h]).isOccupied()||null!=(i=(null!=(y=n[l.slot])?y:[]).shift())&&(l.setById(i.data.id),l.lastSetValid||(e[i.data.id]=l));for(c in e)(l=e[c]).setById(c);for(p=0,b=(w=this.upgrades).length;p<b;p++)(l=w[p]).isOccupied()||null!=(i=(null!=(q=n[l.slot])?q:[]).shift())&&l.setById(i.data.id);this.addStandardizedUpgrades()}return this.updateSelections(),this.builder.container.trigger("xwing:pointsUpdated"),this.builder.current_squad.dirty=!0,this.builder.container.trigger("xwing-backend:squadDirtinessChanged")}},t.prototype.setShipType=function(s){var t,l,e,i,n,a;for(this.pilot_selector.data("select2").container.show(),s!==(null!=(n=this.pilot)?n.ship:void 0)&&(this.builder.isQuickbuild?(n=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(s),e=[],i=0,n=t.length;i<n;i++)(l=t[i]).disabled||e.push(l.id);return e}.call(this)[0],this.setPilotById(n)):(n=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(s),e=[],i=0,n=t.length;i<n;i++)l=t[i],exportObj.pilotsById[l.id].unique||e.push(exportObj.pilotsById[l.id]);return e}.call(this)[0])?this.setPilot(n):this.setPilot(function(){for(var t,e=this.builder.getAvailablePilotsForShipIncluding(s),i=[],n=0,a=e.length;n<a;n++)l=e[n],null!=exportObj.pilotsById[l.id].restriction_func&&!exportObj.pilotsById[l.id].restriction_func(this)||(t=exportObj.pilotsById[l.id],0<=__indexOf.call(this.builder.uniques_in_use.Pilot,t))||i.push(exportObj.pilotsById[l.id]);return i}.call(this)[0])),this.checkPilotSelectorQueryModal(),e=0,i=(a=this.row.attr("class").split(/\s+/)).length;e<i;e++)0===(t=a[e]).indexOf("ship-")&&this.row.removeClass(t);return this.remove_button.fadeIn("fast"),this.copy_button.fadeIn("fast"),!0===this.builder.show_points_destroyed&&this.points_destroyed_button.fadeIn("fast"),this.row.addClass("ship-"+s.toLowerCase().replace(/[^a-z0-9]/gi,"")),this.builder.container.trigger("xwing:shipUpdated")},t.prototype.setPilotById=function(t,e){var o,r,d,c,i=__iced_k_noop,u=iced.findDeferral(arguments);if(null==e&&(e=!1),!this.builder.isQuickbuild)return i(this.setPilot(exportObj.pilotsById[parseInt(t)],e));var h,p,n=i;t!==(p=this).quickbuildId?(p.wingmate_selector.parent().hide(),null!=p.wingmates&&0<p.wingmates.length&&(p.setWingmates(0),p.linkedShip=null),p.quickbuildId=t,p.builder.current_squad.dirty=!0,p.resetPilot(),p.resetAddons(),h=function(){return p.builder.container.trigger("xwing:pointsUpdated"),n(p.builder.container.trigger("xwing-backend:squadDirtinessChanged"))},null!=t&&-1<t?(r=exportObj.quickbuildsById[parseInt(t)],o=exportObj.pilots[r.pilot],p.data=exportObj.ships[r.ship],p.builder.isUpdatingPoints=!0,i=function(){var t,e,i,n,a,s,l;if(p.pilot=o,null!=p.pilot&&p.setupAddons(),p.copy_button.show(),p.setShipType(p.pilot.ship),null!=r.wingmate&&null==p.linkedShip)for(t=0,e=(i=p.builder.ships).length;t<e;t++)if((d=i[t]).quickbuildId===r.linkedId)return d.joinWing(p),p.linkedShip=d,p.primary=!1,p.builder.isUpdatingPoints=!1,p.builder.container.trigger("xwing:pointsUpdated"),void p.builder.container.trigger("xwing-backend:squadDirtinessChanged");n=function(){return p.primary=null==r.wingmate,null!=(null!=r?r.wingleader:void 0)&&(p.wingmate_selector.parent().show(),p.wingmate_selector.val(r.wingmates[0]),p.wingmate_selector.attr("min",r.wingmates[0]),p.wingmate_selector.attr("max",r.wingmates[r.wingmates.length-1]),p.setWingmates(r.wingmates[0])),p.builder.isUpdatingPoints=!1,h(p.builder.container.trigger("xwing:pointsUpdated"))},p.linkedShip?(a=n,null!=r.linkedId?(p.linkedShip.setPilotById(r.linkedId),a(null==r.wingmate?p.linkedShip.primary=!1:void 0)):(s=function(){return a(p.linkedShip=null)},0<(null!=(l=p.linkedShip.wingmates)?l.length:void 0)?s(p.linkedShip.removeFromWing(p)):(p.linkedShip.linkedShip=null,c=new iced.Deferrals(s,{parent:u,funcname:"Ship.setPilotById"}),p.builder.removeShip(p.linkedShip,c.defer({lineno:5776})),c._fulfill()))):n(null!=r.linkedId&&(p.linkedShip=p.builder.ships.slice(-1)[0],null!==p.linkedShip.data?p.linkedShip=p.builder.addShip():p.builder.addShip(),(p.linkedShip.linkedShip=p).linkedShip.setPilotById(r.linkedId),null==r.wingmate&&(p.linkedShip.primary=!1)))},null==(null!=o?o.unique:void 0)?i():(c=new iced.Deferrals(i,{parent:u,funcname:"Ship.setPilotById"}),p.builder.container.trigger("xwing:claimUnique",[o,"Pilot",c.defer({lineno:5743})]),c._fulfill())):h(p.copy_button.hide())):n()},t.prototype.addStandardizedUpgrades=function(){var t,e,i,n,a,s=this.builder.standard_list.Ship.indexOf(this.data.name);if(-1<s){for(a=[],e=0,i=(n=this.upgrades).length;e<i;e++){if(t=n[e],exportObj.slotsMatching(t.slot,this.builder.standard_list.Upgrade[s].slot)){t.setData(this.builder.standard_list.Upgrade[s]);break}a.push(void 0)}return a}},t.prototype.setPilot=function(u,h){var g,v,p,x,k,f,m,_,y,t,n,a,s,l=__iced_k_noop,o=iced.findDeferral(arguments);if(null==h&&(h=!1),u===this.pilot)return l();if(this.builder.current_squad.dirty=!0,m=null!=this.pilot&&(null!=u?u.ship:void 0)===this.pilot.ship,f={},m)for(t=0,n=(s=this.upgrades).length;t<n;t++)null!=(null!=(_=s[t])?_.data:void 0)&&(null==f[a=_.slot]&&(f[a]=[]),f[_.slot].push(_.data.id));this.resetPilot(),this.resetAddons();i=b=this;var e,i,b,w=function(){return i.row.removeClass("unsortable"),i.builder.container.trigger("xwing:pointsUpdated"),l(i.builder.container.trigger("xwing-backend:squadDirtinessChanged"))};null!=u?(b.data=exportObj.ships[null!=u?u.ship:void 0],e=function(){var t,e,i,n,a,s,l,o,r,d,c;if(b.pilot=u,null!=b.pilot&&b.setupAddons(),b.copy_button.show(),b.setShipType(b.pilot.ship),b.addStandardizedUpgrades(),(null!=b.pilot.autoequip||null!=exportObj.ships[b.pilot.ship].autoequip&&!m)&&!h)for(t=0,n=(v=(null!=(o=b.pilot.autoequip)?o:[]).concat(null!=(o=exportObj.ships[b.pilot.ship].autoequip)?o:[])).length;t<n;t++)for(y=v[t],g=exportObj.upgrades[y],e=0,a=(r=b.upgrades).length;e<a;e++)_=r[e],exportObj.slotsMatching(_.slot,g.slot)&&_.setData(g);if(m)for(i=1;i<=2;++i){for(p={},l=0,s=(d=b.upgrades).length;l<s;l++)_=d[l],null!=(k=(null!=(c=f[_.slot])?c:[]).shift())&&(_.setById(k),_.lastSetValid||(p[k]=_));for(x in p)(_=p[x]).setById(x)}return w()},null==(null!=u?u.unique:void 0)?e():(e=new iced.Deferrals(e,{parent:o,funcname:"Ship.setPilot"}),b.builder.container.trigger("xwing:claimUnique",[u,"Pilot",e.defer({lineno:5834})]),e._fulfill())):w(b.copy_button.hide())},t.prototype.resetPilot=function(){__iced_k_noop;var t,e,i,n=iced.findDeferral(arguments),a=(t=e=this,function(){return t.pilot=null});null!=(null!=(i=e.pilot)?i.unique:void 0)?(i=new iced.Deferrals(a,{parent:n,funcname:"Ship.resetPilot"}),e.builder.container.trigger("xwing:releaseUnique",[e.pilot,"Pilot",i.defer({lineno:5870})]),i._fulfill()):a()},t.prototype.setupAddons=function(){var t,e,i,n,a,s,l,c,u,o,h,r,d;if(this.builder.isQuickbuild){for(d=[],s=0,c=(h=null!=(o=exportObj.quickbuildsById[this.quickbuildId].upgrades)?o:[]).length;s<c;s++)n=h[s],null!=(i=exportObj.upgrades[n])?((e=new exportObj.QuickbuildUpgrade({ship:this,container:this.addon_container,slot:i.slot,upgrade:i})).setData(i),d.push(this.upgrades.push(e))):console.log("Unknown Upgrade: "+n);return d}for(r=[],a=0,l=(u=null!=(o=this.pilot.slots)?o:[]).length;a<l;a++)t=u[a],r.push(this.upgrades.push(new exportObj.Upgrade({ship:this,container:this.addon_container,slot:t})));return r},t.prototype.resetAddons=function(){__iced_k_noop;var t,e,i,n,a,s,l,o=iced.findDeferral(arguments),r=(s=l=this,function(){return s.upgrades=[]});for(e=new iced.Deferrals(r,{parent:o,funcname:"Ship.resetAddons"}),i=0,n=(a=l.upgrades).length;i<n;i++)null!=(t=a[i])&&t.destroy(e.defer({lineno:5899}));e._fulfill()},t.prototype.getPoints=function(){var t,e;return this.builder.isQuickbuild?(t=exportObj.quickbuildsById[this.quickbuildId],e=this.primary&&null!=(e=null!=t?t.threat:void 0)?e:0,null!=(null!=t?t.wingleader:void 0)&&(e=t.threat[t.wingmates.indexOf(this.wingmates.length)]),this.points_container.find("span").text(e),0<e?this.points_container.fadeTo("fast",1):this.points_container.fadeTo(0,0),e):(t=null!=(e=null!=(t=this.pilot)?t.points:void 0)?e:0,e=null!=(e=null!=(e=this.pilot)?e.pointsupg:void 0)?e:"N/A",this.points_container.find("div").text(""+t),this.points_container.find(".upgrade-points").text("("+this.upgrade_points_total+"/"+e+")"),0<t?this.points_container.fadeTo("fast",1):this.points_container.fadeTo(0,0),t)},t.prototype.setWingmates=function(n){__iced_k_noop;var a,t,e,s,d=iced.findDeferral(arguments);if((null!=(o=this.wingmates)?o.length:void 0)!==n){for(null!=this.wingmates&&0!==this.wingmates.length||(this.wingmates=[]),e=exportObj.quickbuildsById[this.quickbuildId];this.wingmates.length<n;)null!==(t=this.builder.ships.slice(-1)[0]).data?t=this.builder.addShip():this.builder.addShip(),(t.linkedShip=this).wingmates.push(t),t.setPilotById(e.wingmateId),t.primary=!1,this.primary=!0;i=l=this;var i,l,o=function(){return i.wingmate_selector.val(n)},r=function(t){var e=t,i=function(){return iced.trampoline(function(){return r(t)})};if(!(l.wingmates.length>n))return e();(a=l.wingmates.pop()).linkedShip=null,s=new iced.Deferrals(i,{parent:d,funcname:"Ship.setWingmates"}),l.builder.removeShip(a,s.defer({lineno:5955})),s._fulfill()};r(o)}},t.prototype.removeFromWing=function(t){var e;return this.wingmates.removeItem(t),t=exportObj.quickbuildsById[this.quickbuildId],e=this.wingmates.length,0<=__indexOf.call(t.wingmates,e)||this.destroy($.noop),this.wingmate_selector.val(this.wingmates.length)},t.prototype.joinWing=function(t){var e,i;return this.wingmates.push(t),e=exportObj.quickbuildsById[this.quickbuildId],i=this.wingmates.length,0<=__indexOf.call(e.wingmates,i)||(t.destroy($.noop),this.removeFromWing(t)),this.wingmate_selector.val(this.wingmates.length)},t.prototype.updateSelections=function(){var t,e,i,n,a,s,l;if(null==this.pilot)return this.pilot_selector.select2("data",null);for(this.ship_selector.select2("data",{id:this.pilot.ship,text:exportObj.ships[this.pilot.ship].display_name||this.pilot.ship,xws:exportObj.ships[this.pilot.ship].xws,icon:exportObj.ships[this.pilot.ship].icon||exportObj.ships[this.pilot.ship].xws}),this.pilot_selector.select2("data",{id:this.pilot.id,text:(null!=(null!=(a=exportObj.settings)?a.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?this.pilot.skill+" - ":"")+(this.pilot.display_name||this.pilot.name)+(-1!==this.quickbuildId?exportObj.quickbuildsById[this.quickbuildId].suffix:"")+" ("+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+"/"+(-1!==this.quickbuildId?"":this.pilot.pointsupg)+")"}),this.pilot_selector.data("select2").container.show(),l=[],i=0,n=(s=this.upgrades).length;i<n;i++)t=(e=s[i]).getPoints(),l.push(e.updateSelection(t));return l},t.prototype.checkPilotSelectorQueryModal=function(){return 768<=$(window).width()?this.pilot_query_modal.hide():this.pilot?this.pilot_query_modal.show():void 0},t.prototype.setupUI=function(){var t,e,i,n,u,h,p,f,a,s,l,o,r,d,m,_,c;return this.row=$(document.createElement("DIV")),this.row.addClass("row ship mb-5 mb-sm-0 unsortable"),this.row.insertBefore(this.builder.notes_container),null!=this.pilot&&(exportObj.ships[this.pilot.ship].icon||exportObj.ships[this.pilot.ship].xws),this.row.append($.trim('<div class="col-md-3">\n    <div class="form-group d-flex">\n        <input class="ship-selector-container" type="hidden"></input>\n        <div class="d-block d-md-none input-group-append">\n            <button class="btn btn-secondary ship-query-modal"><i class="fas fa-question"></i></button>\n        </div>\n    <br />\n    </div>\n    <div class="form-group d-flex">\n        <input type="hidden" class="pilot-selector-container"></input>\n        <div class="d-block d-md-none input-group-append">\n            <button class="btn btn-secondary pilot-query-modal"><i class="fas fa-question"></i></button>\n        <br />\n        </div>\n    </div>\n    <label class="wingmate-label">\n    '+this.uitranslation("Wingmates")+': \n        <input type="number" class="wingmate-selector"></input>\n    </label>\n</div>\n<div class="col-md-1 points-display-container">\n     <div></div>\n     <div class="upgrade-points"></div>\n</div>\n<div class="col-md-6 addon-container">  </div>\n<div class="col-md-2 button-container">\n    <button class="btn btn-danger remove-pilot side-button"><span class="d-none d-sm-block" data-toggle="tooltip" title="'+this.uitranslation("Remove Pilot")+'"><i class="fa fa-times"></i></span><span class="d-block d-sm-none"> '+this.uitranslation("Remove Pilot")+'</span></button>\n    <button class="btn btn-light copy-pilot side-button"><span class="d-none d-sm-block" data-toggle="tooltip" title="'+this.uitranslation("Clone Pilot")+'"><i class="far fa-copy"></i></span><span class="d-block d-sm-none"> '+this.uitranslation("Clone Pilot")+'</span></button>\n    <button class="btn btn-light points-destroyed side-button" points-state"><span class="d-none d-sm-block destroyed-type" data-toggle="tooltip" title="'+this.uitranslation("Points Destroyed")+'"><i class="fas fa-circle"></i></i></span><span class="d-block d-sm-none destroyed-type-mobile"> '+this.uitranslation("Undamaged")+"</span></button>\n</div>")),this.row.find(".button-container span").tooltip(),this.ship_selector=$(this.row.find("input.ship-selector-container")),this.pilot_selector=$(this.row.find("input.pilot-selector-container")),this.wingmate_selector=$(this.row.find("input.wingmate-selector")),this.ship_query_modal=$(this.row.find("button.ship-query-modal")),this.pilot_query_modal=$(this.row.find("button.pilot-query-modal")),this.ship_query_modal.click((e=this,function(t){if(e.pilot)return e.builder.showTooltip("Ship",exportObj.ships[e.pilot.ship],null,e.builder.mobile_tooltip_modal,!0),e.builder.mobile_tooltip_modal.modal("show")})),this.pilot_query_modal.click((i=this,function(t){if(i.pilot)return i.builder.showTooltip("Pilot",i.pilot,i.pilot?i:void 0,i.builder.mobile_tooltip_modal,!0),i.builder.mobile_tooltip_modal.modal("show")})),t=function(t,e,i){return'<i class="xwing-miniatures-ship xwing-miniatures-ship-'+t.icon+'"></i> '+t.text},this.ship_selector.select2({width:"100%",placeholder:exportObj.translate("ui","shipSelectorPlaceholder"),query:(u=this,function(t){var e={results:[]};return e.results=u.builder.getAvailableShipsMatching(t.term),t.callback(e)}),minimumResultsForSearch:$.isMobile()?-1:0,formatResultCssClass:(n=this,function(t){var e;return null!=n.builder.collection&&"true"===n.builder.collection.checks.collectioncheck?(e=!1,null!=n.pilot&&t.id===exportObj.ships[n.pilot.ship].id?n.builder.collection.checkShelf("ship",t.name)||n.builder.collection.checkTable("pilot",t.name)||(e=!0):e=!n.builder.collection.checkShelf("ship",t.name),e?"select2-result-not-in-collection":""):""}),formatResult:t,formatSelection:t}),this.ship_selector.on("select2-focus",function(t){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.ship_selector.on("change",(h=this,function(t){return h.setShipType(h.ship_selector.val())})),this.ship_selector.data("select2").results.on("mousemove-filtered",(p=this,function(t){t=$(t.target).closest(".select2-result").data("select2-data");if(null!=(null!=t?t.id:void 0))return p.builder.showTooltip("Ship",exportObj.ships[t.id])})),this.ship_selector.data("select2").container.on("mouseover",(f=this,function(t){if(f.pilot)return f.builder.showTooltip("Ship",exportObj.ships[f.pilot.ship])})),this.pilot_selector.select2({width:"100%",placeholder:exportObj.translate("ui","pilotSelectorPlaceholder"),query:(s=this,function(t){var e={results:[]};return e.results=s.builder.getAvailablePilotsForShipIncluding(s.ship_selector.val(),s.builder.isQuickbuild?s.quickbuildId:s.pilot,t.term,!0,s),t.callback(e)}),minimumResultsForSearch:$.isMobile()?-1:0,formatResultCssClass:(a=this,function(t){var e,i,n;return null!=a.builder.collection&&"true"===a.builder.collection.checks.collectioncheck?(i=!1,e="",e=a.builder.isQuickbuild?null!=(n=null!=(n=exportObj.quickbuildsById[t.id])?n.pilot:void 0)?n:"unknown pilot":t.name,t.id===(null!=(n=a.pilot)?n.id:void 0)?a.builder.collection.checkShelf("pilot",e)||a.builder.collection.checkTable("pilot",e)||(i=!0):i=!a.builder.collection.checkShelf("pilot",e),i?"select2-result-not-in-collection":""):""})}),this.pilot_selector.on("select2-focus",function(t){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.pilot_selector.on("change",(l=this,function(t){return l.setPilotById(l.pilot_selector.select2("val")),l.builder.current_squad.dirty=!0,l.builder.container.trigger("xwing-backend:squadDirtinessChanged"),l.builder.backend_status.fadeOut("slow")})),this.pilot_selector.data("select2").results.on("mousemove-filtered",(o=this,function(t){var e,t=$(t.target).closest(".select2-result").data("select2-data");if(o.builder.isQuickbuild){if(null!=(null!=t?t.id:void 0))return o.builder.showTooltip("Quickbuild",exportObj.quickbuildsById[t.id],{ship:null!=(e=o.data)?e.name:void 0})}else if(null!=(null!=t?t.id:void 0))return o.builder.showTooltip("Pilot",exportObj.pilotsById[t.id])})),this.pilot_selector.data("select2").container.on("mouseover",(r=this,function(t){if(r.pilot)return r.builder.showTooltip("Pilot",r.pilot,r)})),this.pilot_selector.data("select2").container.hide(),this.builder.isQuickbuild&&(this.wingmate_selector.on("change",(d=this,function(t){return d.setWingmates(parseInt(d.wingmate_selector.val())),d.builder.current_squad.dirty=!0,d.builder.container.trigger("xwing-backend:squadDirtinessChanged"),d.builder.backend_status.fadeOut("slow")})),this.wingmate_selector.on("mousemove-filtered",function(t){})),this.wingmate_selector.parent().hide(),this.points_container=$(this.row.find(".points-display-container")),this.points_container.fadeTo(0,0),this.addon_container=$(this.row.find("div.addon-container")),this.remove_button=$(this.row.find("button.remove-pilot")),this.remove_button.click((m=this,function(t){return t.preventDefault(),m.row.slideUp("fast",function(){var t;return m.builder.removeShip(m),null!=(t=m.backend_status)?t.fadeOut("slow"):void 0})})),this.remove_button.hide(),this.copy_button=$(this.row.find("button.copy-pilot")),this.copy_button.click((_=this,function(t){for(var e,i=_.builder.ships,n=[],a=0,s=i.length;a<s;a++){if((e=i[a]).row.hasClass("unsortable")){e.copyFrom(_);break}n.push(void 0)}return n})),this.copy_button.hide(),this.checkPilotSelectorQueryModal(),this.points_destroyed_button_span=$(this.row.find(".destroyed-type")),this.points_destroyed_button_span_mobile=$(this.row.find(".destroyed-type-mobile")),this.points_destroyed_button=$(this.row.find("button.points-destroyed")),this.points_destroyed_button.click((c=this,function(t){switch(c.destroystate){case 0:c.destroystate++,c.points_destroyed_button.addClass("btn-warning"),c.points_destroyed_button.removeClass("btn-light"),c.points_destroyed_button_span_mobile.text(c.uitranslation("Half Damaged")),c.points_destroyed_button_span.html('<i class="fas fa-adjust"></i>');break;case 1:c.destroystate++,c.points_destroyed_button.addClass("btn-danger"),c.points_destroyed_button.removeClass("btn-warning"),c.points_destroyed_button_span_mobile.text(c.uitranslation("Fully Destroyed")),c.points_destroyed_button_span.html('<i class="far fa-circle"></i>');break;case 2:c.destroystate=0,c.points_destroyed_button.addClass("btn-light"),c.points_destroyed_button.removeClass("btn-danger"),c.points_destroyed_button_span_mobile.text(c.uitranslation("Undamaged")),c.points_destroyed_button_span.html('<i class="fas fa-circle"></i>')}return c.builder.onPointsUpdated()})),this.points_destroyed_button.hide()},t.prototype.teardownUI=function(){return this.row.text(""),this.row.remove()},t.prototype.toString=function(){return null!=this.pilot?this.uitranslation("PilotFlyingShip",this.pilot.display_name||this.pilot.name,this.data.display_name||this.data.name):this.data.display_name||this.data.name},t.prototype.toHTML=function(){var t,c,u,h,p,f,m,_,b,g,v,x,e,k,i,n=this.effectiveStats(),y=this.builder.formatActions(n.actions,"&nbsp;&nbsp;",null!=(y=this.pilot.keyword)?y:[]),a=null!=(a=this.data.attack_icon)?a:"xwing-miniatures-font-frontarc",w=null!=this.pilot.engagement?$.trim('<span class="info-data info-skill">ENG '+this.pilot.engagement+"</span>"):"",a=null!=n.attack?$.trim('<i class="xwing-miniatures-font header-attack '+a+'"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(a=null!=(a=this.pilot.ship_override)?a.attack:void 0)?a:this.data.attack,n,"attack")+"</span>"):"",s=null!=n.attackbull?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-bullseyearc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(s=null!=(s=this.pilot.ship_override)?s.attackbull:void 0)?s:this.data.attackbull,n,"attackbull")+"</span>"):"",l=null!=n.attackb?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-reararc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(l=null!=(l=this.pilot.ship_override)?l.attackb:void 0)?l:this.data.attackb,n,"attackb")+"</span>"):"",o=null!=n.attackf?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-fullfrontarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(o=null!=(o=this.pilot.ship_override)?o.attackf:void 0)?o:this.data.attackf,n,"attackf")+"</span>"):"",r=null!=n.attackt?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-singleturretarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(r=null!=(r=this.pilot.ship_override)?r.attackt:void 0)?r:this.data.attackt,n,"attackt")+"</span>"):"",q=null!=n.attackl?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-leftarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(q=null!=(q=this.pilot.ship_override)?q.attackl:void 0)?q:this.data.attackl,n,"attackl")+"</span>"):"",O=null!=n.attackr?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-rightarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(O=null!=(O=this.pilot.ship_override)?O.attackr:void 0)?O:this.data.attackr,n,"attackr")+"</span>"):"",S=null!=n.attackdt?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-doubleturretarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(S=null!=(S=this.pilot.ship_override)?S.attackdt:void 0)?S:this.data.attackdt,n,"attackdt")+"</span>"):"",d="";if(null!=this.data.energyrecurr)for(t=0;t<this.data.energyrecurr;)d+='<sup><i class="fas fa-caret-up"></i></sup>',++t;if(e=null!=(null!=(e=this.pilot.ship_override)?e.energy:void 0)||null!=this.data.energy?$.trim('<i class="xwing-miniatures-font header-energy xwing-miniatures-font-energy"></i>\n<span class="info-data info-energy">'+statAndEffectiveStat(null!=(e=null!=(e=this.pilot.ship_override)?e.energy:void 0)?e:this.data.energy,n,"energy")+d+"</span>"):"",null!=n.force)if(d="",null!=n.forcerecurring)for(t=0;t<n.forcerecurring;)d+='<sup><i class="fas fa-caret-up"></i></sup>',++t;else d+='<sup><i class="fas fa-caret-up"></i></sup>';if(k=null!=this.pilot.force?$.trim('<i class="xwing-miniatures-font header-force xwing-miniatures-font-forcecharge"></i>\n<span class="info-data info-force">'+statAndEffectiveStat(null!=(k=null!=(k=this.pilot.ship_override)?k.force:void 0)?k:this.pilot.force,n,"force")+d+"</span>"):"",null!=this.pilot.charge){if(d="",null!=this.pilot.recurring)if(0<this.pilot.recurring)for(t=0;t<this.pilot.recurring;)d+='<sup><i class="fas fa-caret-up"></i></sup>',++t;else for(t=this.pilot.recurring;t<0;)d+='<sub><i class="fas fa-caret-down"></i></sub>',++t;i=$.trim('<i class="xwing-miniatures-font header-charge xwing-miniatures-font-charge"></i><span class="info-data info-charge">'+statAndEffectiveStat(null!=(i=null!=(i=this.pilot.ship_override)?i.charge:void 0)?i:this.pilot.charge,n,"charge")+d+"</span>")}else i="";if(f="",null!=this.data.shieldrecurr)for(t=0;t<this.data.shieldrecurr;)f+='<sup><i class="fas fa-caret-up"></i></sup>',++t;if(p="",n.shields){for(b=n.shields;2<=b;b+=-1)p+='<i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield expanded-hull-or-shield"></i>';p+='<i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield"></i>'}if(u="",n.hull){for(g=n.hull;2<=g;g+=-1)u+='<i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull expanded-hull-or-shield"></i>';u+='<i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull"></i>'}if(c=$.trim('<div class="fancy-pilot-header">\n    <div class="pilot-header-text">'+(this.pilot.display_name||this.pilot.name)+' <i class="xwing-miniatures-ship xwing-miniatures-ship-'+this.data.xws+'"></i><span class="fancy-ship-type"> '+(this.data.display_name||this.data.name)+'</span></div>\n    <div class="mask">\n        <div class="outer-circle">\n            <div class="inner-circle pilot-points">'+(-1!==this.quickbuildId?this.primary?this.getPoints():"*":this.pilot.points)+'</div>\n        </div>\n    </div>\n</div>\n<div class="fancy-pilot-stats">\n    <div class="pilot-stats-content">\n        <span class="info-data info-skill">INI '+statAndEffectiveStat(this.pilot.skill,n,"skill")+"</span>\n        "+w+"\n        "+s+"\n        "+a+"\n        "+l+"\n        "+o+"\n        "+r+"\n        "+q+"\n        "+O+"\n        "+S+'\n        <i class="xwing-miniatures-font header-agility xwing-miniatures-font-agility"></i>\n        <span class="info-data info-agility">'+statAndEffectiveStat(null!=(s=null!=(w=this.pilot.ship_override)?w.agility:void 0)?s:this.data.agility,n,"agility")+"</span>                    \n        "+u+'\n        <span class="info-data info-hull">'+statAndEffectiveStat(null!=(l=null!=(a=this.pilot.ship_override)?a.hull:void 0)?l:this.data.hull,n,"hull")+"</span>\n        "+p+'\n        <span class="info-data info-shields">'+statAndEffectiveStat(null!=(r=null!=(o=this.pilot.ship_override)?o.shields:void 0)?r:this.data.shields,n,"shields")+f+"</span>\n        "+e+"\n        "+k+"\n        "+i+"\n        <br />\n        "+y+"\n    </div>\n</div>"),this.pilot.text&&(c+=$.trim('<div class="fancy-pilot-text">'+this.pilot.text+"</div>")),0<(m=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(_=t[i]).data&&e.push(_);return e}.call(this)).length){for(c+=$.trim('<div class="fancy-upgrade-container">'),v=0,x=m.length;v<x;v++)h=(_=m[v]).getPoints(),c+=_.toHTML(h);c+=$.trim("</div>")}return q=Math.floor(this.getPoints()/2),O=Math.floor((n.hull+n.shields)/2),'<div class="fancy-ship">'+(c+=$.trim('<div class="ship-points-total">\n    <strong>'+this.uitranslation("Ship Cost")+": "+this.getPoints()+", "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+"/"+this.pilot.pointsupg+"), "+this.uitranslation("Half Points")+": "+q+", "+this.uitranslation("Damage Threshold")+": "+O+"</strong> \n</div>"))+"</div>"},t.prototype.toTableRow=function(){var t,e,i,a,n,s,l=$.trim('<tr class="simple-pilot">\n    <td class="name">'+(this.pilot.display_name||this.pilot.name)+" &mdash; "+(this.data.display_name||this.data.name)+'</td>\n    <td class="points">'+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+"</td>\n</tr>"),o=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<o.length)for(n=0,s=o.length;n<s;n++)e=(a=o[n]).getPoints(),l+=a.toTableRow(e);return l+='<tr class="simple-ship-total"><td colspan="2">'+this.uitranslation("Ship Cost")+": "+this.getPoints()+"</td></tr>",t=Math.floor(this.getPoints()/2),i=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),l=l+('<tr class="simple-ship-half-points"><td colspan="2">'+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+"/"+this.pilot.pointsupg+") "+this.uitranslation("Half Points")+": "+t+" "+this.uitranslation("Damage Threshold")+": "+i+"</td></tr>")+"<tr><td>&nbsp;</td><td></td></tr>"},t.prototype.toSimpleCopy=function(){var t,e,i,a,n,s,l,o=this.pilot.name+" ("+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+")    \n",r=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<r.length){for(o+="    ",e=[],s=0,l=r.length;s<l;s++)n=(a=r[s]).getPoints(),null!=(n=a.toSimpleCopy(n))&&e.push(n);o=o+e.join("    ")+"    \n"}return t=Math.floor(this.getPoints()/2),i=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),o+=this.uitranslation("Ship Cost")+": "+this.getPoints()+"  "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+"/"+this.pilot.pointsupg+")  "+this.uitranslation("Half Points")+": "+t+"  "+this.uitranslation("Damage Threshold")+": "+i+"    \n    \n"},t.prototype.toRedditText=function(){var t,e,i,a,n,s,l,o="**"+this.pilot.name+" ("+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+")**    \n",r=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<r.length){for(t=Math.floor(this.getPoints()/2),i=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),o+="    ",e=[],s=0,l=r.length;s<l;s++)n=(a=r[s]).getPoints(),null!=(n=a.toRedditText(n))&&e.push(n);o=(o+=e.join("    "))+("&nbsp;*"+this.uitranslation("Ship Cost")+": "+this.getPoints()+"  "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+"/"+this.pilot.pointsupg+")  "+this.uitranslation("Half Points")+": "+t+"  "+this.uitranslation("Damage Threshold")+": "+i+"*    \n")}return o},t.prototype.toTTSText=function(){var a,t,e,i,n=""+exportObj.toTTS(this.pilot.name),s=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<s.length)for(e=0,i=s.length;e<i;e++)null!=(t=(a=s[e]).toTTSText())&&(n+=" + "+t);return n+" / "},t.prototype.toSerialized=function(){var l,o,t;return this.builder.isQuickbuild?null==this.wingmates||0===this.wingmates.length?this.quickbuildId+"X":this.quickbuildId+"X"+this.wingmates.length:(t=(""+function(){var t,e,i,n,a=this.upgrades,s=[];for(l=t=0,e=a.length;t<e;l=++t)o=a[l],s.push(null!=(i=null!=o&&null!=(n=o.data)?n.id:void 0)?i:"");return s}.call(this)).replace(/,/g,"W"),[this.pilot.id,t].join("X"))},t.prototype.fromSerialized=function(c,u){var t,h,p,e,i,n,a,s,l,f,o,r,m,d=!0;switch(c){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:console.log("Incorrect Version!"),this.old_version_container.toggleClass("d-none",!1);break;case 9:if(h=(o=u.split("X"))[0],i=o[1],o[2],i=i.split("W"),this.setPilotById(parseInt(h),!0),!this.validate)return!1;if(this.builder.isQuickbuild)0<i.length&&0<this.wingmates.length&&this.setWingmates(i[0]);else for(a=1;a<3;++a)for(t=s=r=i.length-1;r<=-1?s<-1:-1<s;t=r<=-1?++s:--s)if(e=i[t],null!=(p=exportObj.upgradesById[e])){for(l=0,f=(m=this.upgrades).length;l<f;l++)if(n=m[l],exportObj.slotsMatching(p.slot,n.slot)&&!n.isOccupied()){n.setById(e),n.lastSetValid&&i.splice(t,1);break}}else i.splice(t,1),""!==e&&(console.log("Unknown upgrade id "+e+" could not be added. Please report that error"),d=!1);d&=0===i.length}return this.updateSelections(),d},t.prototype.effectiveStats=function(){for(var t,e,i,n,a,s,c,u,h,p,f,l,o={attack:null!=(l=null!=(l=this.pilot.ship_override)?l.attack:void 0)?l:this.data.attack,attackf:null!=(l=null!=(l=this.pilot.ship_override)?l.attackf:void 0)?l:this.data.attackf,attackbull:null!=(l=null!=(l=this.pilot.ship_override)?l.attackbull:void 0)?l:this.data.attackbull,attackb:null!=(l=null!=(l=this.pilot.ship_override)?l.attackb:void 0)?l:this.data.attackb,attackt:null!=(l=null!=(l=this.pilot.ship_override)?l.attackt:void 0)?l:this.data.attackt,attackl:null!=(l=null!=(l=this.pilot.ship_override)?l.attackl:void 0)?l:this.data.attackl,attackr:null!=(l=null!=(l=this.pilot.ship_override)?l.attackr:void 0)?l:this.data.attackr,attackdt:null!=(l=null!=(l=this.pilot.ship_override)?l.attackdt:void 0)?l:this.data.attackdt,energy:null!=(l=null!=(l=this.pilot.ship_override)?l.energy:void 0)?l:this.data.energy,agility:null!=(l=null!=(l=this.pilot.ship_override)?l.agility:void 0)?l:this.data.agility,hull:null!=(l=null!=(l=this.pilot.ship_override)?l.hull:void 0)?l:this.data.hull,shields:null!=(l=null!=(l=this.pilot.ship_override)?l.shields:void 0)?l:this.data.shields,force:null!=(l=null!=(l=null!=(l=this.pilot.ship_override)?l.force:void 0)?l:this.pilot.force)?l:0,forcerecurring:1,charge:null!=(l=null!=(l=this.pilot.ship_override)?l.charge:void 0)?l:this.pilot.charge,actions:(null!=(l=null!=(l=this.pilot.ship_override)?l.actions:void 0)?l:this.data.actions).slice(0),maneuvers:[]},r=n=0,d=(null!=(l=this.data.maneuvers)?l:[]).length;0<=d?n<d:d<n;r=0<=d?++n:--n)o.maneuvers[r]=this.data.maneuvers[r].slice(0);if(null!=this.pilot.keyword&&0<=__indexOf.call(this.pilot.keyword,"Droid")&&null!=o.actions){for(t=[],a=0,c=(h=o.actions).length;a<c;a++)e=h[a],t.push(e.replace("Focus","Calculate"));o.actions=t}for(s=0,u=(p=this.upgrades).length;s<u;s++)null!=(null!=(i=p[s])&&null!=(f=i.data)?f.modifier_func:void 0)&&i.data.modifier_func(o);return null!=(null!=(l=this.pilot)?l.modifier_func:void 0)&&this.pilot.modifier_func(o),o},t.prototype.validate=function(){var t,e,i,n,c,a,u,s,l,h,o,p,f,m,_,b,r,g,d,v,x;if(null==this.pilot)return!0;if(c=!0,this.builder.isEpic){if(!(0<=__indexOf.call(this.pilot.slots,"Command"))){for(t=!0,s=0,p=(m=this.upgrades).length;s<p;s++)"Command"===(a=m[s]).slot&&this===a.ship&&(t=!1);!0===t&&this.upgrades.push(new exportObj.Upgrade({ship:this,container:this.addon_container,slot:"Command"}))}}else if(!this.builder.isQuickbuild)for(i=l=_=this.upgrades.length-1;_<=-1?l<-1:-1<l;i=_<=-1?++l:--l)"Command"===(a=this.upgrades[i]).slot&&(a.destroy($.noop),this.upgrades.splice(i,1));for(i=h=0;h<32;i=++h){if(u=!0,null!=(r=null!=(r=null!=(r=null!=(r=this.pilot)?r.validation_func:void 0)?r:null!=(r=this.pilot)?r.restriction_func:void 0)?r:void 0)&&!r(this,this.pilot)||!this.builder.isItemAvailable(this.pilot,!0))return this.builder.removeShip(this),!1;for(e=[],o=this.upgrade_points_total=0,f=(g=this.upgrades).length;o<f;o++){if(n=!0,null!=(null!=(d=null!=(a=g[o])&&null!=(v=a.data)?v.validation_func:void 0)?d:void 0)&&(n=n&&(null!=a&&null!=(x=a.data)?x.validation_func(this,a):void 0)),d=null!=(d=null!=a&&null!=(b=a.data)?b.restrictions:void 0)?d:void 0,(!(n=n&&this.restriction_check(d,a,a.getPoints(),this.upgrade_points_total))||null!=(null!=a?a.data:void 0)&&(d=a.data,0<=__indexOf.call(e,d)||null!=a.data.faction&&!this.builder.isOurFaction(a.data.faction,this.pilot.faction)||!this.builder.isItemAvailable(a.data)))&&!this.builder.isQuickbuild){a.setById(null),c=u=!1;break}null!=(null!=a?a.data:void 0)&&a.data&&e.push(null!=a?a.data:void 0),this.upgrade_points_total+=a.getPoints()}if(u)break}return this.updateSelections(),c},t.prototype.checkUnreleasedContent=function(){var t,e,i,n;if(null!=this.pilot&&!exportObj.isReleased(this.pilot))return!0;for(e=0,i=(n=this.upgrades).length;e<i;e++)if(null!=(null!=(t=n[e])?t.data:void 0)&&!exportObj.isReleased(t.data))return!0;return!1},t.prototype.hasAnotherUnoccupiedSlotLike=function(t,e){for(var i,n=this.upgrades,a=0,s=n.length;a<s;a++)if((i=n[a])!==t&&exportObj.slotsMatching(i.slot,e)&&!i.isOccupied())return!0;return!1},t.prototype.hasFilledSlotLike=function(t,e){for(var i,n=this.upgrades,a=0,s=n.length;a<s;a++)if((i=n[a])!==t&&exportObj.slotsMatching(i.slot,e)&&i.isOccupied())return!0;return!1},t.prototype.restriction_check=function(t,e,c,u){var i,n,a,s,l,o,h,p,f,r,d=this.effectiveStats();if(null!=this.pilot.pointsupg&&c+u>this.pilot.pointsupg)return!1;if(null!=t)for(l=0,h=t.length;l<h;l++){if("orUnique"===(a=t[l])[0]&&this.checkListForUnique(a[1].toLowerCase().replace(/[^0-9a-z]/gi,"").replace(/\s+/g,"-")))return!0;switch(a[0]){case"Base":switch(a[1]){case"Small":if(null!=this.data.base)return!1;break;case"Non-Small":if(null==this.data.base)return!1;break;case"Small or Medium":if((null==this.data.base||"Medium"!==this.data.base)&&null!=this.data.base)return!1;break;case"Medium or Large":if(null==this.data.base||"Medium"!==this.data.base&&"Large"!==this.data.base)return!1;break;case"Large or Huge":if(null==this.data.base||"Large"!==this.data.base&&"Huge"!==this.data.base)return!1;break;case"Standard":if(null!=this.data.base&&"Huge"===this.data.base)return!1;break;default:if(null==this.data.base||this.data.base!==a[1])return!1}break;case"Action":if(a[1].startsWith("W-")){if(s=a[1].substring(2),__indexOf.call(d.actions,s)<0)return!1}else{for(n=!1,o=0,p=(f=d.actions).length;o<p;o++)(i=f[o]).includes(a[1])&&!i.includes(">")&&(n=!0);if(!1===n)return!1}break;case"Keyword":if(!this.checkKeyword(a[1]))return!1;break;case"Equipped":if(!this.doesSlotExist(a[1])||!this.hasFilledSlotLike(e,a[1]))return!1;break;case"Slot":if(!this.hasAnotherUnoccupiedSlotLike(e,a[1])&&!e.occupiesAnUpgradeSlot(a[1]))return!1;break;case"AttackArc":if(null==this.data.attackb)return!1;break;case"ShieldsGreaterThan":if(!(this.data.shields>a[1]))return!1;break;case"EnergyGreatterThan":if(!(d.energy>a[1]))return!1;break;case"InitiativeGreaterThan":if(!(this.pilot.skill>a[1]))return!1;break;case"InitiativeLessThan":if(!(this.pilot.skill<a[1]))return!1;break;case"AgilityEquals":if(d.agility!==a[1])return!1;break;case"isUnique":if(a[1]!==(null!=this.pilot.unique))return!1;break;case"Format":switch(a[1]){case"Epic":if(r=this.data.name,!(0<=__indexOf.call(exportObj.epicExclusionsList,r)))return!1;break;case"Standard":if(r=this.data.name,0<=__indexOf.call(exportObj.epicExclusionsList,r))return!1}break;case"Faction":if(this.pilot.faction!==a[1])return!1}}return!0},t.prototype.doesSlotExist=function(t){for(var e,i=this.upgrades,n=0,a=i.length;n<a;n++)if(e=i[n],exportObj.slotsMatching(t,e.slot))return!0;return!1},t.prototype.isSlotOccupied=function(t){for(var e,i=this.upgrades,n=0,a=i.length;n<a;n++)if(e=i[n],exportObj.slotsMatching(e.slot,t)&&!e.isOccupied())return!0;return!1},t.prototype.checkKeyword=function(t){var e,i,n,a,s,l,o,c,u,r,h,p,d,f,m;if(null!=(r=this.data.name)&&r.includes(t))return!0;for(e=0,s=(u=null!=(r=this.data.keyword)?r:[]).length;e<s;e++)if(u[e]===t)return!0;for(i=0,l=(h=null!=(r=this.pilot.keyword)?r:[]).length;i<l;i++)if(h[i]===t)return!0;for(n=0,o=(p=this.upgrades).length;n<o;n++)for(a=0,c=(m=null!=(d=null!=(d=p[n])&&null!=(f=d.data)?f.keyword:void 0)?d:[]).length;a<c;a++)if(m[a]===t)return!0;return!1},t.prototype.checkListForUnique=function(t){var e,n,a,i=this.builder.uniques_in_use;for(e in i)if(a=i[e],"Slot"!==e&&0<=__indexOf.call(function(){for(var t=[],e=0,i=a.length;e<i;e++)n=a[e],t.push(n.canonical_name.getXWSBaseName());return t}(),t))return!0;return!1},t.prototype.toXWS=function(){var t,e,i,n,a,s={id:null!=(s=this.pilot.xws)?s:this.pilot.canonical_name,name:null!=(s=this.pilot.xws)?s:this.pilot.canonical_name,points:this.getPoints(),ship:this.data.xws.canonicalize()};for(this.data.multisection&&(s.multisection=this.data.multisection.slice(0)),e={},i=0,n=(a=this.upgrades).length;i<n;i++)null!=(null!=(t=a[i])?t.data:void 0)&&t.toXWS(e);return 0<Object.keys(e).length&&(s.upgrades=e),s},t.prototype.getConditions=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p;if("undefined"==typeof Set||null===Set)return console.warn("Set not supported in this JS implementation, not implementing conditions"),[];if(e=new Set,null!=(null!=(d=this.pilot)?d.applies_condition:void 0))if(this.pilot.applies_condition instanceof Array)for(n=0,l=(c=this.pilot.applies_condition).length;n<l;n++)t=c[n],e.add(exportObj.conditionsByCanonicalName[t]);else e.add(exportObj.conditionsByCanonicalName[this.pilot.applies_condition]);for(a=0,o=(u=this.upgrades).length;a<o;a++)if(null!=(null!=(i=u[a])&&null!=(h=i.data)?h.applies_condition:void 0))if(i.data.applies_condition instanceof Array)for(s=0,r=(p=i.data.applies_condition).length;s<r;s++)t=p[s],e.add(exportObj.conditionsByCanonicalName[t]);else e.add(exportObj.conditionsByCanonicalName[i.data.applies_condition]);return e},t}(),GenericAddon=function(){function t(t){this.ship=t.ship,this.container=$(t.container),this.data=null,this.unadjusted_data=null,this.conferredAddons=[],this.serialization_code="X",this.occupied_by=null,this.occupying=[],this.destroyed=!1,this.type=null,this.dataByName=null,(this.dataById=null)!=t.adjustment_func&&(this.adjustment_func=t.adjustment_func),null!=t.filter_func&&(this.filter_func=t.filter_func),this.placeholderMod_func=null!=t.placeholderMod_func?t.placeholderMod_func:function(t){return t}}return t.prototype.destroy=function(){__iced_k_noop;var a,s,l,t,e,i=iced.findDeferral(arguments),o=arguments[0],r=2<=arguments.length?__slice.call(arguments,1):[];if(this.destroyed)return o(r);l=t=this;var n=function(){var t,e,i,n;if(null!=(null!=(i=l.data)?i.standardized:void 0)){for(a=!0,t=0,e=(n=l.ship.builder.ships).length;t<e;t++)null!=(s=n[t]).data&&l.ship.data.name===s.data.name&&l.ship!==s&&(a=!1);!0===a&&l.removeStandardized()}return l.destroyed=!0,l.rescindAddons(),l.deoccupyOtherUpgrades(),l.selector.select2("destroy"),l.selectorwrap.remove(),o(r)};null!=(null!=(e=t.data)?e.unique:void 0)?(e=new iced.Deferrals(n,{parent:i,funcname:"GenericAddon.destroy"}),t.ship.builder.container.trigger("xwing:releaseUnique",[t.data,t.type,e.defer({lineno:6853})]),e._fulfill()):n()},t.prototype.setupSelector=function(t){var n,a,e,i,s,l;return this.selectorwrap=$(document.createElement("div")),this.selectorwrap.addClass("form-group d-flex upgrade-box"),this.selector=$(document.createElement("INPUT")),this.selector.attr("type","hidden"),this.selectorwrap.append(this.selector),this.selectorwrap.append($.trim('<div class="input-group-addon">\n    <button class="btn btn-secondary d-block d-md-none upgrade-query-modal"><i class="fas fa-question"></i></button>\n</div>')),this.upgrade_query_modal=$(this.selectorwrap.find("button.upgrade-query-modal")),this.container.append(this.selectorwrap),$.isMobile()&&(t.minimumResultsForSearch=-1),t.formatResultCssClass=(n=this,function(t){var e,i;return null!=n.ship.builder.collection?(e=!1,t.id===(null!=(i=n.data)?i.id:void 0)?n.ship.builder.collection.checkShelf(n.type.toLowerCase(),t.name)||n.ship.builder.collection.checkTable(n.type.toLowerCase(),t.name)||(e=!0):e=!n.ship.builder.collection.checkShelf(n.type.toLowerCase(),t.name),e?"select2-result-not-in-collection":""):""}),t.formatSelection=(a=this,function(t,e){var i=function(){return("Upgrade"!==this.type?this.type:this.slot).toLowerCase().replace(/[^0-9a-z]/gi,"")}.call(a);i=i.replace("configuration","config").replace("force","forcepower"),$(e).append('<i class="xwing-miniatures-font xwing-miniatures-font-'+i+'"></i> '+t.text)}),this.selector.select2(t),this.upgrade_query_modal.click((e=this,function(t){if(e.data)return console.log(""+e.data.name),e.ship.builder.showTooltip("Addon",e.data,null!=e.data?{addon_type:e.type}:void 0,e.ship.builder.mobile_tooltip_modal,!0),e.ship.builder.mobile_tooltip_modal.modal("show")})),this.selector.on("select2-focus",function(t){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.selector.on("change",(i=this,function(t){return i.setById(i.selector.select2("val")),i.ship.builder.current_squad.dirty=!0,i.ship.builder.container.trigger("xwing-backend:squadDirtinessChanged"),i.ship.builder.backend_status.fadeOut("slow")})),this.selector.data("select2").results.on("mousemove-filtered",(s=this,function(t){t=$(t.target).closest(".select2-result").data("select2-data");if(null!=(null!=t?t.id:void 0))return s.ship.builder.showTooltip("Addon",s.dataById[t.id],{addon_type:s.type})})),this.selector.data("select2").container.on("mouseover",(l=this,function(t){if(null!=l.data)return l.ship.builder.showTooltip("Addon",l.data,{addon_type:l.type})}))},t.prototype.setById=function(t){return this.setData(this.dataById[parseInt(t)])},t.prototype.setByName=function(t){return this.setData(this.dataByName[$.trim(t)])},t.prototype.setData=function(e){var i,n=__iced_k_noop,a=iced.findDeferral(arguments);if((null!=e?e.id:void 0)===(null!=(l=this.data)?l.id:void 0))return n();s=l=this;var t,s,l,o=function(){null!=(null!=(t=s.data)?t.standardized:void 0)&&s.removeStandardized(),s.rescindAddons(),s.deoccupyOtherUpgrades();var t=function(){if(s.data=s.unadjusted_data=e,null!=s.data){if(s.data.superseded_by_id)return s.setById(s.data.superseded_by_id);null!=s.adjustment_func&&(s.data=s.adjustment_func(s.data)),s.unequipOtherUpgrades(),s.occupyOtherUpgrades(),s.conferAddons(),null!=s.data.standardized&&s.addToStandardizedList()}else s.deoccupyOtherUpgrades();return s.lastSetValid=s.ship.validate(),n(s.ship.builder.container.trigger("xwing:pointsUpdated"))};if(null!=(null!=e?e.unique:void 0)||null!=(null!=e?e.solitary:void 0))try{i=new iced.Deferrals(t,{parent:a,funcname:"GenericAddon.setData"}),s.ship.builder.container.trigger("xwing:claimUnique",[e,s.type,i.defer({lineno:6954})]),i._fulfill()}catch(t){return void(s.ship.builder.container.trigger("xwing:pointsUpdated"),s.lastSetValid=!1)}else t()};null!=(null!=(t=l.data)?t.unique:void 0)||null!=(null!=(t=l.data)?t.solitary:void 0)?(i=new iced.Deferrals(o,{parent:a,funcname:"GenericAddon.setData"}),l.ship.builder.container.trigger("xwing:releaseUnique",[l.unadjusted_data,l.type,i.defer({lineno:6947})]),i._fulfill()):o()},t.prototype.addToStandardizedList=function(){var t=this.ship.builder.standard_list.Ship.indexOf(this.ship.data.name);if(!(-1<t&&(null!=(t=this.ship.builder.standard_list.Upgrade[t])?t.name:void 0)===this.data.name))return this.ship.builder.standard_list.Upgrade.push(this.data),this.ship.builder.standard_list.Ship.push(this.ship.data.name)},t.prototype.removeStandardized=function(){var s,l,o,t,e,i,n,a,r,d=this.ship.builder.standard_list.Ship.indexOf(this.ship.data.name);if(-1<d&&(null!=(i=this.ship.builder.standard_list.Upgrade[d])?i.name:void 0)===this.data.name){for(this.ship.builder.standard_list.Upgrade.splice(d,1),this.ship.builder.standard_list.Ship.splice(d,1),s=this.data.name,r=[],t=0,e=(n=this.ship.builder.ships).length;t<e;t++)(null!=(a=(l=n[t]).data)?a.name:void 0)===this.ship.data.name?r.push(function(){for(var t,e=l.upgrades,i=[],n=0,a=e.length;n<a;n++){if((null!=(t=(o=e[n]).data)?t.name:void 0)===s){o.setData(null);break}i.push(void 0)}return i}()):r.push(void 0);return r}},t.prototype.conferAddons=function(){var t,e,i,n,a,s,l;if(null!=this.data.confersAddons&&!this.ship.builder.isQuickbuild&&0<this.data.confersAddons.length){for(l=[],n=0,a=(s=this.data.confersAddons).length;n<a;n++){if(i=(t=s[n]).type,e={ship:this.ship,container:this.container},null!=t.slot&&(e.slot=t.slot),null!=t.adjustment_func&&(e.adjustment_func=t.adjustment_func),null!=t.filter_func&&(e.filter_func=t.filter_func),null!=t.auto_equip&&(e.auto_equip=t.auto_equip),null!=t.placeholderMod_func&&(e.placeholderMod_func=t.placeholderMod_func),!((t=new i(e))instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+t);this.ship.upgrades.push(t),l.push(this.conferredAddons.push(t))}return l}},t.prototype.rescindAddons=function(){__iced_k_noop;var n,t,e,i,a,s,l,o=iced.findDeferral(arguments),r=(s=l=this,function(){for(var t=s.conferredAddons,e=0,i=t.length;e<i;e++){if(!((n=t[e])instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+n);s.ship.upgrades.removeItem(n)}return s.conferredAddons=[]});for(t=new iced.Deferrals(r,{parent:o,funcname:"GenericAddon.rescindAddons"}),e=0,i=(a=l.conferredAddons).length;e<i;e++)(n=a[e]).destroy(t.defer({lineno:7029}));t._fulfill()},t.prototype.getPoints=function(t,e){var i;if(null==t&&(t=this.data),null==e&&(e=this.ship),null==(null!=t?t.variablepoints:void 0))return null!=(i=null!=t?t.points:void 0)?i:0;switch(t.variablepoints){case"Agility":return null!=t?t.points[e.data.agility]:void 0;case"Base":if(null==(null!=e?e.data.base:void 0))return null!=t?t.points[0]:void 0;switch(e.data.base){case"Medium":return null!=t?t.points[1]:void 0;case"Large":return null!=t?t.points[2]:void 0;case"Huge":return null!=t?t.points[3]:void 0}break;case"Initiative":return null!=t?t.points[e.pilot.skill]:void 0}},t.prototype.updateSelection=function(t){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:(this.data.display_name||this.data.name)+" ("+t+(this.data.variablepoints?"*":"")+")"}):this.selector.select2("data",null)},t.prototype.toString=function(){return null!=this.data?(this.data.display_name||this.data.name)+" ("+this.getPoints()+")":"No "+this.type},t.prototype.toHTML=function(c){var t,u,e,i,n,a,s,l,o,r,d;if(null==this.data)return"";if(d=null!=this.data.slot&&"HardpointShip"===this.data.slot?"hardpoint":(null!=(d=this.data.slot)?d:this.type).toLowerCase().replace(/[^0-9a-z]/gi,""),r=(r="function"==typeof(r=this.data).text?r.text(match(/(<span.*<\/span>)<br \/><br \/>(.*)/)):void 0)?(o='<div class="card-restriction-container">'+r[1]+"</div>",r[2]):(o="",this.data.text),t="",null!=this.data.range&&(e=null!=this.data.rangebonus?'<span class="upgrade-attack-rangebonus"><i class="xwing-miniatures-font xwing-miniatures-font-rangebonusindicator"></i></span>':"",e=$.trim('<span class="upgrade-attack-range">'+this.data.range+"</span>\n"+e),u=null!=this.data.attack?$.trim('<span class="info-data info-attack">'+this.data.attack+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-frontarc"></i>'):null!=this.data.attackf?$.trim('<span class="info-data info-attack">'+this.data.attackf+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-fullfrontarc"></i>'):null!=this.data.attackb?$.trim('<span class="info-data info-attack">'+this.data.attackb+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-backarc"></i>'):null!=this.data.attackt?$.trim('<span class="info-data info-attack">'+this.data.attackt+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc"></i>'):null!=this.data.attackdt?$.trim('<span class="info-data info-attack">'+this.data.attackdt+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-doubleturretarc"></i>'):null!=this.data.attackl?$.trim('<span class="info-data info-attack">'+this.data.attackl+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-leftarc"></i>'):null!=this.data.attackr?$.trim('<span class="info-data info-attack">'+this.data.attackr+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-rightarc"></i>'):null!=this.data.attackbull?$.trim('<span class="info-data info-attack">'+this.data.attackbull+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc"></i>'):"",t=$.trim('<div class="upgrade-attack">\n    '+e+"\n    "+u+"\n</div>")),null!=this.data.charge){if(l="",null!=this.data.recurring)if(0<this.data.recurring)for(n=0;n<this.data.recurring;)l+='<sup><i class="fas fa-caret-up"></i></sup>',++n;else for(n=this.data.recurring;n<0;)l+='<sub><i class="fas fa-caret-down"></i></sub>',++n;i=$.trim('<div class="upgrade-charge">\n    <span class="info-data info-charge">'+this.data.charge+'</span>\n    <i class="xwing-miniatures-font xwing-miniatures-font-charge"></i>'+l+"\n</div>")}else i=$.trim("");if(null!=this.data.force){for(s=1,null!=this.data.forcerecurring&&(s=this.data.forcerecurring),n=0;n<s;)l+='<sup><i class="fas fa-caret-up"></i></sup>',++n;a=$.trim('<div class="upgrade-force">\n    <span class="info-data info-force">'+this.data.force+'</span>\n    <i class="xwing-miniatures-font xwing-miniatures-font-forcecharge"></i>'+l+"\n</div>")}else a=$.trim("");return $.trim('<div class="upgrade-container">\n    <div class="upgrade-stats">\n        <div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-'+d+'"></i>'+(this.data.display_name||this.data.name)+'</div>\n        <div class="mask">\n            <div class="outer-circle">\n                <div class="inner-circle upgrade-points">'+c+"</div>\n            </div>\n        </div>\n        "+o+"\n    </div>\n    "+t+"\n    "+i+"\n    "+a+'\n    <div class="upgrade-text">'+r+'</div>\n    <div style="clear: both;"></div>\n</div>')},t.prototype.toTableRow=function(t){return null!=this.data?$.trim('<tr class="simple-addon">\n    <td class="name">'+(this.data.display_name||this.data.name)+'</td>\n    <td class="points">'+t+"</td>\n</tr>"):""},t.prototype.toSimpleCopy=function(t){return null!=this.data?this.data.name+" ("+t+")    \n":null},t.prototype.toRedditText=function(t){return null!=this.data?"*&nbsp;"+this.data.name+" ("+t+")*    \n":null},t.prototype.toTTSText=function(){return null!=this.data?""+exportObj.toTTS(this.data.name):null},t.prototype.toSerialized=function(){var t;return this.serialization_code+"."+(null!=(t=null!=(t=this.data)?t.id:void 0)?t:-1)},t.prototype.unequipOtherUpgrades=function(){for(var a,s,t,e=null!=(t=null!=(t=this.data)?t.unequips_upgrades:void 0)?t:[],i=[],n=0,l=e.length;n<l;n++)a=e[n],i.push(function(){for(var t=this.ship.upgrades,e=[],i=0,n=t.length;i<n;i++)if(s=t[i],exportObj.slotsMatching(s.slot,a)&&s!==this&&s.isOccupied()){s.setData(null);break}return e}.call(this));return i},t.prototype.isOccupied=function(){return null!=this.data||null!=this.occupied_by},t.prototype.occupyOtherUpgrades=function(){for(var a,s,t,e=null!=(t=null!=(t=this.data)?t.also_occupies_upgrades:void 0)?t:[],i=[],n=0,l=e.length;n<l;n++)a=e[n],i.push(function(){for(var t=this.ship.upgrades,e=[],i=0,n=t.length;i<n;i++)if(s=t[i],exportObj.slotsMatching(s.slot,a)&&s!==this&&!s.isOccupied()){this.occupy(s);break}return e}.call(this));return i},t.prototype.deoccupyOtherUpgrades=function(){for(var t,e=this.occupying,i=[],n=0,a=e.length;n<a;n++)t=e[n],i.push(this.deoccupy(t));return i},t.prototype.occupy=function(t){return t.occupied_by=this,t.selector.select2("enable",!1),this.occupying.push(t)},t.prototype.deoccupy=function(t){return t.occupied_by=null,t.selector.select2("enable",!0)},t.prototype.occupiesAnUpgradeSlot=function(t){for(var e,i=this.ship.upgrades,n=0,a=i.length;n<a;n++)if(e=i[n],exportObj.slotsMatching(e.slot,t)&&e!==this&&null==e.data&&null!=e.occupied_by&&e.occupied_by===this)return!0;return!1},t.prototype.toXWS=function(t){var e;return(null!=t[e=null!=(e=exportObj.toXWSUpgrade[this.data.slot])?e:this.data.slot.canonicalize()]?t[e]:t[e]=[]).push(null!=(t=this.data.xws)?t:this.data.canonical_name)},t}(),exportObj.Upgrade=function(){function e(t){e.__super__.constructor.call(this,t),this.slot=t.slot,this.type="Upgrade",this.dataById=exportObj.upgradesById,this.dataByName=exportObj.upgrades,this.serialization_code="U",this.setupSelector()}return __extends(e,GenericAddon),e.prototype.setupSelector=function(){return e.__super__.setupSelector.call(this,{width:"100%",placeholder:this.placeholderMod_func(exportObj.translate("ui","upgradePlaceholder",this.slot)),allowClear:!0,query:(i=this,function(t){var e={results:[]};return e.results=i.ship.builder.getAvailableUpgradesIncluding(i.slot,i.data,i.ship,i,t.term,i.filter_func),t.callback(e)})});var i},e}(),exportObj.RestrictedUpgrade=function(t){function e(t){this.filter_func=t.filter_func,e.__super__.constructor.call(this,t),this.serialization_code="u",null!=t.auto_equip&&this.setById(t.auto_equip)}return __extends(e,t),e}(exportObj.Upgrade),exportObj.QuickbuildUpgrade=function(){function e(t){e.__super__.constructor.call(this,t),this.slot=t.slot,this.type="Upgrade",this.dataById=exportObj.upgradesById,this.dataByName=exportObj.upgrades,this.serialization_code="U",this.upgrade=t.upgrade,this.setupSelector()}return __extends(e,GenericAddon),e.prototype.setupSelector=function(){return e.__super__.setupSelector.call(this,{width:"100%",allowClear:!1,query:(i=this,function(t){var e={results:[{id:i.upgrade.id,text:i.upgrade.display_name||i.upgrade.name,points:0,name:i.upgrade.name,display_name:i.upgrade.display_name}]};return t.callback(e)})});var i},e.prototype.getPoints=function(t){return 0},e.prototype.updateSelection=function(t){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:""+(this.data.display_name||this.data.name)}):this.selector.select2("data",null)},e}(),SERIALIZATION_CODE_TO_CLASS={U:exportObj.Upgrade,u:exportObj.RestrictedUpgrade},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).fromXWSFaction={rebelalliance:"Rebel Alliance",rebels:"Rebel Alliance",rebel:"Rebel Alliance",galacticempire:"Galactic Empire",imperial:"Galactic Empire",scumandvillainy:"Scum and Villainy",firstorder:"First Order",resistance:"Resistance",galacticrepublic:"Galactic Republic",separatistalliance:"Separatist Alliance"},exportObj.toXWSFaction={"Rebel Alliance":"rebelalliance","Galactic Empire":"galacticempire","Scum and Villainy":"scumandvillainy","First Order":"firstorder",Resistance:"resistance","Galactic Republic":"galacticrepublic","Separatist Alliance":"separatistalliance"},exportObj.toXWSUpgrade={Modification:"modification",Force:"force-power","Tactical Relay":"tactical-relay"},exportObj.fromXWSUpgrade={amd:"Astromech",astromechdroid:"Astromech",ept:"Talent",elitepilottalent:"Talent",system:"Sensor",mod:"Modification","force-power":"Force","tactical-relay":"Tactical Relay"},SPEC_URL="https://github.com/elistevens/xws-spec",SQUAD_TO_XWS_URL="https://squad2xws.herokuapp.com/translate/",exportObj.loadXWSButton=function(i){var e=$(i.find(".xws-import-status")),n=(e.text(exportObj.translate("ui","Loading...")),e),e=function(e){return $(window).trigger("xwing:activateBuilder",[exportObj.fromXWSFaction[e.faction],function(t){return t.current_squad.dirty&&null!=t.backend?(i.modal("hide"),t.backend.warnUnsaved(t,function(){return t.loadFromXWS(e,function(t){if(!t.success)return i.modal("show"),n.text(t.error)})})):t.loadFromXWS(e,function(t){return t.success?i.modal("hide"):n.text(t.error)})}])},a=i.find(".xws-content").val();try{return e(JSON.parse(a))}catch(t){return a=a.split("/").pop(),a=SQUAD_TO_XWS_URL+a,$.getJSON(a,e).catch(function(t){return n.text("Invalid Input")})}};
//# sourceMappingURL=xwing.min.js.map